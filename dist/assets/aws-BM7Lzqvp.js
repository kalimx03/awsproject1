const Wt="Logging",Gt="NoHubcallbackProvidedException";var w;(function(t){t.DEBUG="DEBUG",t.ERROR="ERROR",t.INFO="INFO",t.WARN="WARN",t.VERBOSE="VERBOSE",t.NONE="NONE"})(w||(w={}));const ve={VERBOSE:1,DEBUG:2,INFO:3,WARN:4,ERROR:5,NONE:6};class _{constructor(e,n=w.WARN){this.name=e,this.level=n,this._pluggables=[]}_padding(e){return e<10?"0"+e:""+e}_ts(){const e=new Date;return[this._padding(e.getMinutes()),this._padding(e.getSeconds())].join(":")+"."+e.getMilliseconds()}configure(e){return e?(this._config=e,this._config):this._config}_log(e,...n){let o=this.level;_.LOG_LEVEL&&(o=_.LOG_LEVEL),typeof window<"u"&&window.LOG_LEVEL&&(o=window.LOG_LEVEL);const i=ve[o];if(!(ve[e]>=i))return;let r=console.log.bind(console);e===w.ERROR&&console.error&&(r=console.error.bind(console)),e===w.WARN&&console.warn&&(r=console.warn.bind(console)),_.BIND_ALL_LOG_LEVELS&&(e===w.INFO&&console.info&&(r=console.info.bind(console)),e===w.DEBUG&&console.debug&&(r=console.debug.bind(console)));const a=`[${e}] ${this._ts()} ${this.name}`;let c="";if(n.length===1&&typeof n[0]=="string")c=`${a} - ${n[0]}`,r(c);else if(n.length===1)c=`${a} ${n[0]}`,r(a,n[0]);else if(typeof n[0]=="string"){let d=n.slice(1);d.length===1&&(d=d[0]),c=`${a} - ${n[0]} ${d}`,r(`${a} - ${n[0]}`,d)}else c=`${a} ${n}`,r(a,n);for(const d of this._pluggables){const u={message:c,timestamp:Date.now()};d.pushLogs([u])}}log(...e){this._log(w.INFO,...e)}info(...e){this._log(w.INFO,...e)}warn(...e){this._log(w.WARN,...e)}error(...e){this._log(w.ERROR,...e)}debug(...e){this._log(w.DEBUG,...e)}verbose(...e){this._log(w.VERBOSE,...e)}addPluggable(e){e&&e.getCategoryName()===Wt&&(this._pluggables.push(e),e.configure(this._config))}listPluggables(){return this._pluggables}}_.LOG_LEVEL=null;_.BIND_ALL_LOG_LEVELS=!1;class v extends Error{constructor({message:e,name:n,recoverySuggestion:o,underlyingError:i,metadata:s}){if(super(e),this.name=n,this.underlyingError=i,this.recoverySuggestion=o,s){const{extendedRequestId:r,httpStatusCode:a,requestId:c}=s;this.metadata={extendedRequestId:r,httpStatusCode:a,requestId:c}}this.constructor=v,Object.setPrototypeOf(this,v.prototype)}}var b;(function(t){t.NoEndpointId="NoEndpointId",t.PlatformNotSupported="PlatformNotSupported",t.Unknown="Unknown",t.NetworkError="NetworkError"})(b||(b={}));const nt=(t,e=v)=>(n,o,i)=>{const{message:s,recoverySuggestion:r}=t[o];if(!n)throw new e({name:o,message:i?`${s} ${i}`:s,recoverySuggestion:r})},z=typeof Symbol<"u"?Symbol("amplify_default"):"@@amplify_default",M=new _("Hub");class Ft{constructor(e){this.listeners=new Map,this.protectedChannels=["core","auth","api","analytics","interactions","pubsub","storage","ui","xr"],this.name=e}_remove(e,n){const o=this.listeners.get(e);if(!o){M.warn(`No listeners for ${e}`);return}this.listeners.set(e,[...o.filter(({callback:i})=>i!==n)])}dispatch(e,n,o,i){typeof e=="string"&&this.protectedChannels.indexOf(e)>-1&&(i===z||M.warn(`WARNING: ${e} is protected and dispatching on it can have unintended consequences`));const s={channel:e,payload:{...n},source:o,patternInfo:[]};try{this._toListeners(s)}catch(r){M.error(r)}}listen(e,n,o="noname"){let i;if(typeof n!="function")throw new v({name:Gt,message:"No callback supplied to Hub"});i=n;let s=this.listeners.get(e);return s||(s=[],this.listeners.set(e,s)),s.push({name:o,callback:i}),()=>{this._remove(e,i)}}_toListeners(e){const{channel:n,payload:o}=e,i=this.listeners.get(n);i&&i.forEach(s=>{M.debug(`Dispatching to ${n} with `,o);try{s.callback(e)}catch(r){M.error(r)}})}}const ie=new Ft("__default__"),zt=()=>{if(typeof window<"u"&&typeof window.atob=="function")return window.atob;if(typeof atob=="function")return atob;throw new v({name:"Base64EncoderError",message:"Cannot resolve the `atob` function from the environment."})},Bt={convert(t,e){let n=t;return e?.urlSafe&&(n=n.replace(/-/g,"+").replace(/_/g,"/")),zt()(n)}};var A;(function(t){t.AuthTokenConfigException="AuthTokenConfigException",t.AuthUserPoolAndIdentityPoolException="AuthUserPoolAndIdentityPoolException",t.AuthUserPoolException="AuthUserPoolException",t.InvalidIdentityPoolIdException="InvalidIdentityPoolIdException",t.OAuthNotConfigureException="OAuthNotConfigureException"})(A||(A={}));const jt={[A.AuthTokenConfigException]:{message:"Auth Token Provider not configured.",recoverySuggestion:"Make sure to call Amplify.configure in your app."},[A.AuthUserPoolAndIdentityPoolException]:{message:"Auth UserPool or IdentityPool not configured.",recoverySuggestion:"Make sure to call Amplify.configure in your app with UserPoolId and IdentityPoolId."},[A.AuthUserPoolException]:{message:"Auth UserPool not configured.",recoverySuggestion:"Make sure to call Amplify.configure in your app with userPoolId and userPoolClientId."},[A.InvalidIdentityPoolIdException]:{message:"Invalid identity pool id provided.",recoverySuggestion:"Make sure a valid identityPoolId is given in the config."},[A.OAuthNotConfigureException]:{message:"oauth param not configured.",recoverySuggestion:"Make sure to call Amplify.configure with oauth parameter in your app."}},ot=nt(jt);function S(t){let e=!0;t?e=!!t.userPoolId&&!!t.userPoolClientId:e=!1,ot(e,A.AuthUserPoolException)}function F(t){const e=!!t?.identityPoolId;ot(e,A.InvalidIdentityPoolIdException)}function U(t){const e=t.split(".");if(e.length!==3)throw new Error("Invalid token");try{const o=e[1].replace(/-/g,"+").replace(/_/g,"/"),i=decodeURIComponent(Bt.convert(o).split("").map(r=>`%${`00${r.charCodeAt(0).toString(16)}`.slice(-2)}`).join("")),s=JSON.parse(i);return{toString:()=>t,payload:s}}catch{throw new Error("Invalid token payload")}}const it=t=>{const e=Reflect.ownKeys(t);for(const n of e){const o=t[n];(o&&typeof o=="object"||typeof o=="function")&&it(o)}return Object.freeze(t)},Ht=new _("parseAWSExports"),qt={API_KEY:"apiKey",AWS_IAM:"iam",AMAZON_COGNITO_USER_POOLS:"userPool",OPENID_CONNECT:"oidc",NONE:"none",AWS_LAMBDA:"lambda",LAMBDA:"lambda"},Jt=(t={})=>{if(!Object.prototype.hasOwnProperty.call(t,"aws_project_region"))throw new v({name:"InvalidParameterException",message:"Invalid config parameter.",recoverySuggestion:"Ensure passing the config object imported from  `amplifyconfiguration.json`."});const{aws_appsync_apiKey:e,aws_appsync_authenticationType:n,aws_appsync_graphqlEndpoint:o,aws_appsync_region:i,aws_bots_config:s,aws_cognito_identity_pool_id:r,aws_cognito_sign_up_verification_method:a,aws_cognito_mfa_configuration:c,aws_cognito_mfa_types:d,aws_cognito_password_protection_settings:u,aws_cognito_verification_mechanisms:m,aws_cognito_signup_attributes:I,aws_cognito_social_providers:f,aws_cognito_username_attributes:T,aws_mandatory_sign_in:Q,aws_mobile_analytics_app_id:fe,aws_mobile_analytics_app_region:Rt,aws_user_files_s3_bucket:pe,aws_user_files_s3_bucket_region:bt,aws_user_files_s3_dangerously_connect_to_http_endpoint_for_testing:Ot,aws_user_pools_id:ye,aws_user_pools_web_client_id:Mt,geo:Ie,oauth:X,predictions:R,aws_cloud_logic_custom:me,Notifications:Dt,modelIntrospection:Se}=t,p={};fe&&(p.Analytics={Pinpoint:{appId:fe,region:Rt}});const{InAppMessaging:Z,Push:ee}=Dt??{};if(Z?.AWSPinpoint||ee?.AWSPinpoint){if(Z?.AWSPinpoint){const{appId:h,region:P}=Z.AWSPinpoint;p.Notifications={InAppMessaging:{Pinpoint:{appId:h,region:P}}}}if(ee?.AWSPinpoint){const{appId:h,region:P}=ee.AWSPinpoint;p.Notifications={...p.Notifications,PushNotification:{Pinpoint:{appId:h,region:P}}}}}if(Array.isArray(s)&&(p.Interactions={LexV1:Object.fromEntries(s.map(h=>[h.name,h]))}),o){const h=qt[n];h||Ht.debug(`Invalid authentication type ${n}. Falling back to IAM.`),p.API={GraphQL:{endpoint:o,apiKey:e,region:i,defaultAuthMode:h??"iam"}},Se&&(p.API.GraphQL.modelIntrospection=Se)}const xt=c?{status:c&&c.toLowerCase(),totpEnabled:d?.includes("TOTP")??!1,smsEnabled:d?.includes("SMS")??!1}:void 0,Kt=u?{minLength:u.passwordPolicyMinLength,requireLowercase:u.passwordPolicyCharacters?.includes("REQUIRES_LOWERCASE")??!1,requireUppercase:u.passwordPolicyCharacters?.includes("REQUIRES_UPPERCASE")??!1,requireNumbers:u.passwordPolicyCharacters?.includes("REQUIRES_NUMBERS")??!1,requireSpecialCharacters:u.passwordPolicyCharacters?.includes("REQUIRES_SYMBOLS")??!1}:void 0,Ut=Array.from(new Set([...m??[],...I??[]])).reduce((h,P)=>({...h,[P.toLowerCase()]:{required:!0}}),{}),we=T?.includes("EMAIL")??!1,_e=T?.includes("PHONE_NUMBER")??!1;(r||ye)&&(p.Auth={Cognito:{identityPoolId:r,allowGuestAccess:Q!=="enable",signUpVerificationMethod:a,userAttributes:Ut,userPoolClientId:Mt,userPoolId:ye,mfa:xt,passwordFormat:Kt,loginWith:{username:!(we||_e),email:we,phone:_e}}});const Nt=X?Object.keys(X).length>0:!1,Lt=f?f.length>0:!1;if(p.Auth&&Nt&&(p.Auth.Cognito.loginWith={...p.Auth.Cognito.loginWith,oauth:{...Yt(X),...Lt&&{providers:Qt(f)}}}),pe&&(p.Storage={S3:{bucket:pe,region:bt,dangerouslyConnectToHttpEndpointForTesting:Ot}}),Ie){const{amazon_location_service:h}=Ie;p.Geo={LocationService:{maps:h.maps,geofenceCollections:h.geofenceCollections,searchIndices:h.search_indices,region:h.region}}}if(me&&(p.API={...p.API,REST:me.reduce((h,P)=>{const{name:Vt,endpoint:$t,region:Ee,service:Ce}=P;return{...h,[Vt]:{endpoint:$t,...Ce?{service:Ce}:void 0,...Ee?{region:Ee}:void 0}}},{})}),R){const{VoiceId:h}=R?.convert?.speechGenerator?.defaults??{};p.Predictions=h?{...R,convert:{...R.convert,speechGenerator:{...R.convert.speechGenerator,defaults:{voiceId:h}}}}:R}return p},Ae=t=>t?.split(",")??[],Yt=({domain:t,scope:e,redirectSignIn:n,redirectSignOut:o,responseType:i})=>({domain:t,scopes:e,redirectSignIn:Ae(n),redirectSignOut:Ae(o),responseType:i}),Qt=t=>t.map(e=>{const n=e.toLowerCase();return n.charAt(0).toUpperCase()+n.slice(1)}),Xt=Symbol("oauth-listener"),y=[];for(let t=0;t<256;++t)y.push((t+256).toString(16).slice(1));function Zt(t,e=0){return(y[t[e+0]]+y[t[e+1]]+y[t[e+2]]+y[t[e+3]]+"-"+y[t[e+4]]+y[t[e+5]]+"-"+y[t[e+6]]+y[t[e+7]]+"-"+y[t[e+8]]+y[t[e+9]]+"-"+y[t[e+10]]+y[t[e+11]]+y[t[e+12]]+y[t[e+13]]+y[t[e+14]]+y[t[e+15]]).toLowerCase()}let te;const en=new Uint8Array(16);function tn(){if(!te){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");te=crypto.getRandomValues.bind(crypto)}return te(en)}const nn=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Te={randomUUID:nn};function on(t,e,n){if(Te.randomUUID&&!e&&!t)return Te.randomUUID();t=t||{};const o=t.random??t.rng?.()??tn();if(o.length<16)throw new Error("Random bytes length must be >= 16");if(o[6]=o[6]&15|64,o[8]=o[8]&63|128,e){if(n=n||0,n<0||n+16>e.length)throw new RangeError(`UUID byte range ${n}:${n+15} is out of buffer bounds`);for(let i=0;i<16;++i)e[n+i]=o[i];return e}return Zt(o)}function sn(t){const{version:e}=t;return e?e.startsWith("1"):!1}function rn(t){if(!t)return;const{bucket_name:e,aws_region:n,buckets:o}=t;return{S3:{bucket:e,region:n,buckets:o&&In(o)}}}function an(t){if(!t)return;const{user_pool_id:e,user_pool_client_id:n,identity_pool_id:o,password_policy:i,mfa_configuration:s,mfa_methods:r,unauthenticated_identities_enabled:a,oauth:c,username_attributes:d,standard_required_attributes:u,groups:m,passwordless:I}=t,f={Cognito:{userPoolId:e,userPoolClientId:n,groups:m}};return o&&(f.Cognito={...f.Cognito,identityPoolId:o}),i&&(f.Cognito.passwordFormat={requireLowercase:i.require_lowercase,requireNumbers:i.require_numbers,requireUppercase:i.require_uppercase,requireSpecialCharacters:i.require_symbols,minLength:i.min_length??6}),s&&(f.Cognito.mfa={status:yn(s),smsEnabled:r?.includes("SMS"),totpEnabled:r?.includes("TOTP")}),a&&(f.Cognito.allowGuestAccess=a),c&&(f.Cognito.loginWith={oauth:{domain:c.domain,redirectSignIn:c.redirect_sign_in_uri,redirectSignOut:c.redirect_sign_out_uri,responseType:c.response_type==="token"?"token":"code",scopes:c.scopes,providers:pn(c.identity_providers)}}),d&&(f.Cognito.loginWith={...f.Cognito.loginWith,email:d.includes("email"),phone:d.includes("phone_number"),username:d.includes("username")}),u&&(f.Cognito.userAttributes=u.reduce((T,Q)=>({...T,[Q]:{required:!0}}),{})),I&&(f.Cognito.passwordless={emailOtpEnabled:I.email_otp_enabled,smsOtpEnabled:I.sms_otp_enabled,webAuthn:I.web_authn?{relyingPartyId:I.web_authn.relying_party_id,userVerification:I.web_authn.user_verification}:void 0,preferredChallenge:I.preferred_challenge}),f}function cn(t){if(!t?.amazon_pinpoint)return;const{amazon_pinpoint:e}=t;return{Pinpoint:{appId:e.app_id,region:e.aws_region}}}function dn(t){if(!t)return;const{aws_region:e,geofence_collections:n,maps:o,search_indices:i}=t;return{LocationService:{region:e,searchIndices:i,geofenceCollections:n,maps:o}}}function un(t){if(!t)return;const{aws_region:e,default_authorization_type:n,url:o,api_key:i,model_introspection:s}=t;return{GraphQL:{endpoint:o,defaultAuthMode:st(n),region:e,apiKey:i,modelIntrospection:s}}}function ln(t){if(!t?.events)return;const{url:e,aws_region:n,api_key:o,default_authorization_type:i}=t.events;return{Events:{endpoint:e,defaultAuthMode:st(i),region:n,apiKey:o}}}function hn(t){if(!t)return;const{aws_region:e,channels:n,amazon_pinpoint_app_id:o}=t,i=n.includes("IN_APP_MESSAGING"),s=n.includes("APNS")||n.includes("FCM");if(!(i||s))return;const r={};return i&&(r.InAppMessaging={Pinpoint:{appId:o,region:e}}),s&&(r.PushNotification={Pinpoint:{appId:o,region:e}}),r}function gn(t){const e={};if(t.storage&&(e.Storage=rn(t.storage)),t.auth&&(e.Auth=an(t.auth)),t.analytics&&(e.Analytics=cn(t.analytics)),t.geo&&(e.Geo=dn(t.geo)),t.data&&(e.API=un(t.data)),t.custom){const n=ln(t.custom);n&&"Events"in n&&(e.API={...e.API,...n})}return t.notifications&&(e.Notifications=hn(t.notifications)),e}const fn={AMAZON_COGNITO_USER_POOLS:"userPool",API_KEY:"apiKey",AWS_IAM:"iam",AWS_LAMBDA:"lambda",OPENID_CONNECT:"oidc"};function st(t){return fn[t]}const ke={GOOGLE:"Google",LOGIN_WITH_AMAZON:"Amazon",FACEBOOK:"Facebook",SIGN_IN_WITH_APPLE:"Apple"};function pn(t=[]){return t.reduce((e,n)=>(ke[n]!==void 0&&e.push(ke[n]),e),[])}function yn(t){return t==="OPTIONAL"?"optional":t==="REQUIRED"?"on":"off"}function In(t){const e={};return t.forEach(({name:n,bucket_name:o,aws_region:i,paths:s})=>{if(n in e)throw new Error(`Duplicate friendly name found: ${n}. Name must be unique.`);const r=s?Object.entries(s).reduce((a,[c,d])=>(d!==void 0&&(a[c]=d),a),{}):void 0;e[n]={bucketName:o,region:i,paths:r}}),e}const rt=t=>Object.keys(t).some(e=>e.startsWith("aws_"))?Jt(t):sn(t)?gn(t):t,mn=t=>new TextEncoder().encode(t);typeof Buffer<"u"&&Buffer.from;for(let t=0;t<256;t++){let e=t.toString(16).toLowerCase();e.length===1&&(e=`0${e}`)}var g;(function(t){t.WebUnknown="0",t.React="1",t.NextJs="2",t.Angular="3",t.VueJs="4",t.Nuxt="5",t.Svelte="6",t.ServerSideUnknown="100",t.ReactSSR="101",t.NextJsSSR="102",t.AngularSSR="103",t.VueJsSSR="104",t.NuxtSSR="105",t.SvelteSSR="106",t.ReactNative="201",t.Expo="202"})(g||(g={}));var Pe;(function(t){t.AI="ai",t.API="api",t.Auth="auth",t.Analytics="analytics",t.DataStore="datastore",t.Geo="geo",t.InAppMessaging="inappmessaging",t.Interactions="interactions",t.Predictions="predictions",t.PubSub="pubsub",t.PushNotification="pushnotification",t.Storage="storage"})(Pe||(Pe={}));var Re;(function(t){t.CreateConversation="1",t.GetConversation="2",t.ListConversations="3",t.DeleteConversation="4",t.SendMessage="5",t.ListMessages="6",t.OnMessage="7",t.Generation="8",t.UpdateConversation="9"})(Re||(Re={}));var be;(function(t){t.Record="1",t.IdentifyUser="2"})(be||(be={}));var Oe;(function(t){t.GraphQl="1",t.Get="2",t.Post="3",t.Put="4",t.Patch="5",t.Del="6",t.Head="7"})(Oe||(Oe={}));var Me;(function(t){t.SignUp="1",t.ConfirmSignUp="2",t.ResendSignUpCode="3",t.SignIn="4",t.FetchMFAPreference="6",t.UpdateMFAPreference="7",t.SetUpTOTP="10",t.VerifyTOTPSetup="11",t.ConfirmSignIn="12",t.DeleteUserAttributes="15",t.DeleteUser="16",t.UpdateUserAttributes="17",t.FetchUserAttributes="18",t.ConfirmUserAttribute="22",t.SignOut="26",t.UpdatePassword="27",t.ResetPassword="28",t.ConfirmResetPassword="29",t.FederatedSignIn="30",t.RememberDevice="32",t.ForgetDevice="33",t.FetchDevices="34",t.SendUserAttributeVerificationCode="35",t.SignInWithRedirect="36",t.StartWebAuthnRegistration="37",t.CompleteWebAuthnRegistration="38",t.ListWebAuthnCredentials="39",t.DeleteWebAuthnCredential="40"})(Me||(Me={}));var De;(function(t){t.Subscribe="1",t.GraphQl="2"})(De||(De={}));var xe;(function(t){t.SearchByText="0",t.SearchByCoordinates="1",t.SearchForSuggestions="2",t.SearchByPlaceId="3",t.SaveGeofences="4",t.GetGeofence="5",t.ListGeofences="6",t.DeleteGeofences="7"})(xe||(xe={}));var Ke;(function(t){t.SyncMessages="1",t.IdentifyUser="2",t.NotifyMessageInteraction="3"})(Ke||(Ke={}));var Ue;(function(t){t.None="0"})(Ue||(Ue={}));var Ne;(function(t){t.Convert="1",t.Identify="2",t.Interpret="3"})(Ne||(Ne={}));var Le;(function(t){t.Subscribe="1"})(Le||(Le={}));var Ve;(function(t){t.InitializePushNotifications="1",t.IdentifyUser="2"})(Ve||(Ve={}));var $e;(function(t){t.UploadData="1",t.DownloadData="2",t.List="3",t.Copy="4",t.Remove="5",t.GetProperties="6",t.GetUrl="7",t.GetDataAccess="8",t.ListCallerAccessGrants="9"})($e||($e={}));const Sn="6.16.2",j=()=>typeof global<"u",O=()=>typeof window<"u",at=()=>typeof document<"u",de=()=>typeof process<"u",N=(t,e)=>!!Object.keys(t).find(n=>n.startsWith(e));var We={};function wn(){const t=o=>o.startsWith("_react")||o.startsWith("__react"),e=o=>Object.keys(o).find(t),n=()=>Array.from(document.querySelectorAll("[id]"));return at()&&n().some(e)}function _n(){return de()&&typeof We<"u"&&!!Object.keys(We).find(t=>t.includes("react"))}function En(){return O()&&N(window,"__VUE")}function Cn(){return j()&&N(global,"__VUE")}var Ge={};function vn(){return O()&&N(window,"__SVELTE")}function An(){return de()&&typeof Ge<"u"&&!!Object.keys(Ge).find(t=>t.includes("svelte"))}function Tn(){return O()&&window.next&&typeof window.next=="object"}function kn(){return j()&&(N(global,"__next")||N(global,"__NEXT"))}function Pn(){return O()&&(window.__NUXT__!==void 0||window.$nuxt!==void 0)}function Rn(){return j()&&typeof global.__NUXT_PATHS__<"u"}var Fe={};function bn(){const t=!!(at()&&document.querySelector("[ng-version]")),e=!!(O()&&typeof window.ng<"u");return t||e}function On(){return de()&&typeof Fe=="object"&&Fe.npm_lifecycle_script?.startsWith("ng ")||!1}function Mn(){return typeof navigator<"u"&&typeof navigator.product<"u"&&navigator.product==="ReactNative"}function Dn(){return j()&&typeof global.expo<"u"}function xn(){return O()}const Kn=[{platform:g.Expo,detectionMethod:Dn},{platform:g.ReactNative,detectionMethod:Mn},{platform:g.NextJs,detectionMethod:Tn},{platform:g.Nuxt,detectionMethod:Pn},{platform:g.Angular,detectionMethod:bn},{platform:g.React,detectionMethod:wn},{platform:g.VueJs,detectionMethod:En},{platform:g.Svelte,detectionMethod:vn},{platform:g.WebUnknown,detectionMethod:xn},{platform:g.NextJsSSR,detectionMethod:kn},{platform:g.NuxtSSR,detectionMethod:Rn},{platform:g.ReactSSR,detectionMethod:_n},{platform:g.VueJsSSR,detectionMethod:Cn},{platform:g.AngularSSR,detectionMethod:On},{platform:g.SvelteSSR,detectionMethod:An}];function Un(){return Kn.find(t=>t.detectionMethod())?.platform||g.ServerSideUnknown}let K;const ne=[];let se=!1;const Nn=10,Ln=10,Vn=1e3,ct=()=>{if(!K){if(K=Un(),se)for(;ne.length;)ne.pop()?.();else ne.forEach(t=>{t()});ze(g.ServerSideUnknown,Nn),ze(g.WebUnknown,Ln)}return K};function $n(){K=void 0}function ze(t,e){K===t&&!se&&setTimeout(()=>{$n(),se=!0,setTimeout(ct,Vn)},e)}const Wn={},Gn=(t,e)=>Wn[t]?.[e]?.additionalDetails,Fn="aws-amplify",zn=t=>t.replace(/\+.*/,""),Bn=({category:t,action:e}={})=>{const n=[[Fn,zn(Sn)]];if(t&&n.push([t,e]),n.push(["framework",ct()]),t&&e){const o=Gn(t,e);o&&o.forEach(i=>{n.push(i)})}return n},ue=t=>Bn(t).map(([o,i])=>o&&i?`${o}/${i}`:o).join(" "),jn=()=>typeof window<"u"&&typeof window.document<"u",Be=new _("Auth");class Hn{configure(e,n){this.authConfig=e,this.authOptions=n,e&&e.Cognito?.userPoolEndpoint&&Be.warn(je("Amazon Cognito User Pool")),e&&e.Cognito?.identityPoolEndpoint&&Be.warn(je("Amazon Cognito Identity Pool"))}async fetchAuthSession(e={}){let n,o;const i=await this.getTokens(e);return i?(o=i.accessToken?.payload?.sub,n=await this.authOptions?.credentialsProvider?.getCredentialsAndIdentityId({authConfig:this.authConfig,tokens:i,authenticated:!0,forceRefresh:e.forceRefresh})):n=await this.authOptions?.credentialsProvider?.getCredentialsAndIdentityId({authConfig:this.authConfig,authenticated:!1,forceRefresh:e.forceRefresh}),{tokens:i,credentials:n?.credentials,identityId:n?.identityId,userSub:o}}async clearCredentials(){await this.authOptions?.credentialsProvider?.clearCredentialsAndIdentityId()}async getTokens(e){return await this.authOptions?.tokenProvider?.getTokens(e)??void 0}}const je=t=>`You are using a custom Amazon ${t} endpoint, ensure the endpoint is correct.`;class qn{constructor(){this.oAuthListener=void 0,this.isConfigured=!1,this.resourcesConfig={},this.libraryOptions={},this.Auth=new Hn}configure(e,n){const o=rt(e);this.resourcesConfig=o,n&&(this.libraryOptions=n),this.resourcesConfig=it(this.resourcesConfig),this.Auth.configure(this.resourcesConfig.Auth,this.libraryOptions.Auth),(this.resourcesConfig.Analytics?.Pinpoint||this.resourcesConfig.Notifications?.InAppMessaging?.Pinpoint||this.resourcesConfig.Notifications?.PushNotification?.Pinpoint)&&console.warn("AWS will end support for Amazon Pinpoint on October 30, 2026. The guidance is to use AWS End User Messaging for push notifications and SMS, Amazon Simple Email Service for sending emails, Amazon Connect for campaigns, journeys, endpoints, and engagement analytics. Pinpoint recommends Amazon Kinesis for event collection and mobile analytics."),ie.dispatch("core",{event:"configure",data:this.resourcesConfig},"Configure",z),this.notifyOAuthListener(),this.isConfigured=!0}getConfig(){return this.isConfigured||console.warn("Amplify has not been configured. Please call Amplify.configure() before using this service."),this.resourcesConfig}[Xt](e){this.resourcesConfig.Auth?.Cognito.loginWith?.oauth?e(this.resourcesConfig.Auth?.Cognito):this.oAuthListener=e}notifyOAuthListener(){!this.resourcesConfig.Auth?.Cognito.loginWith?.oauth||!this.oAuthListener||(this.oAuthListener(this.resourcesConfig.Auth?.Cognito),this.oAuthListener=void 0)}}const k=new qn,H=t=>{const{headers:e,statusCode:n}=t;return{...Jn(t)?t.$metadata:{},httpStatusCode:n,requestId:e["x-amzn-requestid"]??e["x-amzn-request-id"]??e["x-amz-request-id"],extendedRequestId:e["x-amz-id-2"],cfId:e["x-amz-cf-id"]}},Jn=t=>typeof t?.$metadata=="object",V=async t=>{if(!t||t.statusCode<300)return;const e=await q(t),o=(r=>{const[a]=r.toString().split(/[,:]+/);return a.includes("#")?a.split("#")[1]:a})(t.headers["x-amzn-errortype"]??e.code??e.__type??"UnknownError"),i=e.message??e.Message??"Unknown error",s=new Error(i);return Object.assign(s,{name:o,$metadata:H(t)})},q=async t=>{if(!t.body)throw new Error("Missing response payload");const e=await t.body.json();return Object.assign(e,{$metadata:H(t)})},le=(t,e,n,o)=>async(i,s)=>{const r={...o,...i},a=await r.endpointResolver(r,s),c=await e(s,a),d=await t(c,{...r});return n(d)},Yn=300*1e3;function Qn(t=Yn){return o=>{const i=2**o*100+100*Math.random();return i>t?!1:i}}const dt=3,He="amz-sdk-invocation-id",Xn="amz-sdk-request",qe=300*1e3,ut=t=>{const n=Qn(qe)(t);return n===!1?qe:n},Zn=["AuthFailure","InvalidSignatureException","RequestExpired","RequestInTheFuture","RequestTimeTooSkewed","SignatureDoesNotMatch","BadRequestException"],eo=t=>!!t&&Zn.includes(t),lt=t=>async(e,n)=>{const o=n??await t(e)??void 0,i=o?.code||o?.name,s=e?.statusCode;return{retryable:io(n)||oo(s,i)||eo(i)||so(s,i)}},to=["BandwidthLimitExceeded","EC2ThrottledException","LimitExceededException","PriorRequestNotComplete","ProvisionedThroughputExceededException","RequestLimitExceeded","RequestThrottled","RequestThrottledException","SlowDown","ThrottledException","Throttling","ThrottlingException","TooManyRequestsException"],no=["TimeoutError","RequestTimeout","RequestTimeoutException"],oo=(t,e)=>t===429||!!e&&to.includes(e),io=t=>[b.NetworkError,"ERR_NETWORK"].includes(t?.name),so=(t,e)=>!!t&&[500,502,503,504].includes(t)||!!e&&no.includes(e),ht="cognito-identity",gt={service:ht,retryDecider:lt(V),computeDelay:ut,cache:"no-store"},ro=({maxAttempts:t=dt,retryDecider:e,computeDelay:n,abortSignal:o})=>{if(t<1)throw new Error("maxAttempts must be greater than 0");return(i,s)=>async function(a){let c,d=s.attemptsCount??0,u;const m=()=>{if(u)return Je(u,d),u;throw Je(c,d),c};for(;!o?.aborted&&d<t;){try{u=await i(a),c=void 0}catch(T){c=T,u=void 0}d=(s.attemptsCount??0)>d?s.attemptsCount??0:d+1,s.attemptsCount=d;const{isCredentialsExpiredError:I,retryable:f}=await e(u,c,s);if(f){if(s.isCredentialsExpired=!!I,!o?.aborted&&d<t){const T=n(d);await ao(T,o)}continue}else return m()}if(o?.aborted)throw new Error("Request aborted.");return m()}},ao=(t,e)=>{if(e?.aborted)return Promise.resolve();let n,o;const i=new Promise(s=>{o=s,n=setTimeout(s,t)});return e?.addEventListener("abort",function s(r){clearTimeout(n),e?.removeEventListener("abort",s),o()}),i},Je=(t,e)=>{Object.prototype.toString.call(t)==="[object Object]"&&(t.$metadata={...t.$metadata??{},attempts:e})},co=on,uo=()=>t=>async function(n){return n.headers[He]||(n.headers[He]=co()),t(n)},lo=({maxAttempts:t=dt})=>(e,n)=>async function(i){const s=n.attemptsCount??0;return i.headers[Xn]=`attempt=${s+1}; max=${t}`,e(i)},ho=({userAgentHeader:t="x-amz-user-agent",userAgentValue:e=""})=>n=>async function(i){if(e.trim().length===0)return await n(i);{const s=t.toLowerCase();return i.headers[s]=i.headers[s]?`${i.headers[s]} ${e}`:e,await n(i)}},he=(t,e)=>(n,o)=>{const i={};let s=r=>t(r,o);for(let r=e.length-1;r>=0;r--){const a=e[r];s=a(o)(s,i)}return s(n)},oe=t=>{let e;return()=>(e||(e=t()),e)},go=t=>!["HEAD","GET"].includes(t.toUpperCase()),fo=async({url:t,method:e,headers:n,body:o},{abortSignal:i,cache:s,withCrossDomainCredentials:r})=>{let a;try{a=await fetch(t,{method:e,headers:n,body:go(e)?o:void 0,signal:i,cache:s,credentials:r?"include":"same-origin"})}catch(m){throw m instanceof TypeError?new v({name:b.NetworkError,message:"A network error has occurred.",underlyingError:m}):m}const c={};a.headers?.forEach((m,I)=>{c[I.toLowerCase()]=m});const d={statusCode:a.status,headers:c,body:null},u=Object.assign(a.body??{},{text:oe(()=>a.text()),blob:oe(()=>a.blob()),json:oe(()=>a.json())});return{...d,body:u}},ft=he(fo,[ho,uo,ro,lo]),po=()=>t=>async function(n){return n.headers["cache-control"]="no-store",t(n)},pt=he(ft,[po]),yt=t=>(e,n)=>{const o=yo(t),i=JSON.stringify(e);return Io(n,o,i)},yo=t=>({"content-type":"application/x-amz-json-1.1","x-amz-target":`AWSCognitoIdentityService.${t}`}),Io=({url:t},e,n)=>({headers:e,url:t,body:n,method:"POST"}),Ye=t=>le(pt,yt("GetCredentialsForIdentity"),mo,{...gt,...t,userAgentValue:ue()}),mo=async t=>{if(t.statusCode>=300)throw await V(t);const e=await q(t);return{IdentityId:e.IdentityId,Credentials:So(e.Credentials),$metadata:H(t)}},So=({Expiration:t,...e}={})=>({...e,Expiration:t&&new Date(t*1e3)}),wo=t=>le(pt,yt("GetId"),_o,{...gt,...t,userAgentValue:ue()}),_o=async t=>{if(t.statusCode>=300)throw await V(t);return{IdentityId:(await q(t)).IdentityId,$metadata:H(t)}},It={id:"aws",outputs:{dnsSuffix:"amazonaws.com"},regionRegex:"^(us|eu|ap|sa|ca|me|af)\\-\\w+\\-\\d+$",regions:["aws-global"]},Eo={partitions:[It,{id:"aws-cn",outputs:{dnsSuffix:"amazonaws.com.cn"},regionRegex:"^cn\\-\\w+\\-\\d+$",regions:["aws-cn-global"]}]},mt=t=>{const{partitions:e}=Eo;for(const{regions:n,outputs:o,regionRegex:i}of e){const s=new RegExp(i);if(n.includes(t)||s.test(t))return o.dnsSuffix}return It.outputs.dnsSuffix},J=URL,Co=({region:t})=>({url:new J(`https://${ht}.${t}.${mt(t)}`)});class D extends v{constructor(){super({name:b.PlatformNotSupported,message:"Function not supported on current platform"})}}class St{constructor(e){this.storage=e}async setItem(e,n){if(!this.storage)throw new D;this.storage.setItem(e,n)}async getItem(e){if(!this.storage)throw new D;return this.storage.getItem(e)}async removeItem(e){if(!this.storage)throw new D;this.storage.removeItem(e)}async clear(){if(!this.storage)throw new D;this.storage.clear()}}class wt{constructor(){this.storage=new Map}get length(){return this.storage.size}key(e){return e>this.length-1?null:Array.from(this.storage.keys())[e]}setItem(e,n){this.storage.set(e,n)}getItem(e){return this.storage.get(e)??null}removeItem(e){this.storage.delete(e)}clear(){this.storage.clear()}}const _t=new _("CoreStorageUtils"),vo=()=>{try{if(typeof window<"u"&&window.localStorage)return window.localStorage}catch{_t.info("localStorage not found. InMemoryStorage is used as a fallback.")}return new wt},Et=()=>{try{if(typeof window<"u"&&window.sessionStorage)return window.sessionStorage.getItem("test"),window.sessionStorage;throw new Error("sessionStorage is not defined")}catch{return _t.info("sessionStorage not found. InMemoryStorage is used as a fallback."),new wt}};class Ao extends St{constructor(){super(vo())}}class To extends St{constructor(){super(Et())}}class ko{constructor(e){this._storage=e}get storage(){if(!this._storage)throw new D;return this._storage}setItem(e,n){this.storage.setItem(e,n)}getItem(e){return this.storage.getItem(e)}removeItem(e){this.storage.removeItem(e)}clear(){this.storage.clear()}}class Po extends ko{constructor(){super(Et())}}function $(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var o in n)t[o]=n[o]}return t}var Ro={read:function(t){return t[0]==='"'&&(t=t.slice(1,-1)),t.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(t){return encodeURIComponent(t).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}};function re(t,e){function n(i,s,r){if(!(typeof document>"u")){r=$({},e,r),typeof r.expires=="number"&&(r.expires=new Date(Date.now()+r.expires*864e5)),r.expires&&(r.expires=r.expires.toUTCString()),i=encodeURIComponent(i).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var a="";for(var c in r)r[c]&&(a+="; "+c,r[c]!==!0&&(a+="="+r[c].split(";")[0]));return document.cookie=i+"="+t.write(s,i)+a}}function o(i){if(!(typeof document>"u"||arguments.length&&!i)){for(var s=document.cookie?document.cookie.split("; "):[],r={},a=0;a<s.length;a++){var c=s[a].split("="),d=c.slice(1).join("=");try{var u=decodeURIComponent(c[0]);if(r[u]=t.read(d,u),i===u)break}catch{}}return i?r[i]:r}}return Object.create({set:n,get:o,remove:function(i,s){n(i,"",$({},s,{expires:-1}))},withAttributes:function(i){return re(this.converter,$({},this.attributes,i))},withConverter:function(i){return re($({},this.converter,i),this.attributes)}},{attributes:{value:Object.freeze(e)},converter:{value:Object.freeze(t)}})}var W=re(Ro,{path:"/"});class bo{constructor(e={}){const{path:n,domain:o,expires:i,sameSite:s,secure:r}=e;if(this.domain=o,this.path=n||"/",this.expires=Object.prototype.hasOwnProperty.call(e,"expires")?i:365,this.secure=Object.prototype.hasOwnProperty.call(e,"secure")?r:!0,Object.prototype.hasOwnProperty.call(e,"sameSite")){if(!s||!["strict","lax","none"].includes(s))throw new Error('The sameSite value of cookieStorage must be "lax", "strict" or "none".');if(s==="none"&&!this.secure)throw new Error("sameSite = None requires the Secure attribute in latest browser versions.");this.sameSite=s}}async setItem(e,n){W.set(e,n,this.getData())}async getItem(e){return W.get(e)??null}async removeItem(e){W.remove(e,this.getData())}async clear(){const e=W.get(),n=Object.keys(e).map(o=>this.removeItem(o));await Promise.all(n)}getData(){return{path:this.path,expires:this.expires,domain:this.domain,secure:this.secure,...this.sameSite&&{sameSite:this.sameSite}}}}const Y=new Ao;new To;new Po;const Oo=t=>{let e;return async(...n)=>e||(e=new Promise((o,i)=>{t(...n).then(s=>{o(s)}).catch(s=>{i(s)}).finally(()=>{e=void 0})}),e)};function Qe({expiresAt:t,clockDrift:e,tolerance:n=5e3}){return Date.now()+e+n>t}class l extends v{constructor(e){super(e),this.constructor=l,Object.setPrototypeOf(this,l.prototype)}}function Mo(t){const e=t?.split("_")[0];if(!t||t.indexOf("_")<0||!e||typeof e!="string")throw new l({name:"InvalidUserPoolId",message:"Invalid user pool id provided."});return e}function ae(t){if(!t||!t.includes(":"))throw new l({name:"InvalidIdentityPoolIdException",message:"Invalid identity pool id provided.",recoverySuggestion:"Make sure a valid identityPoolId is given in the config."});return t.split(":")[0]}const Ct="UserUnAuthenticatedException",Do="InvalidRedirectException",xo="InvalidAppSchemeException",Ko="InvalidPreferredRedirectUrlException";new l({name:Do,message:"signInRedirect or signOutRedirect had an invalid format or was not found.",recoverySuggestion:"Please make sure the signIn/Out redirect in your oauth config is valid."});new l({name:xo,message:"A valid non-http app scheme was not found in the config.",recoverySuggestion:"Please make sure a valid custom app scheme is present in the config."});new l({name:Ko,message:"The given preferredRedirectUrl does not match any items in the redirectSignOutUrls array from the config.",recoverySuggestion:"Please make sure a matching preferredRedirectUrl is provided."});const Uo="InvalidOriginException";new l({name:Uo,message:"redirect is coming from a different origin. The oauth flow needs to be initiated from the same origin",recoverySuggestion:"Please call signInWithRedirect from the same origin."});const No="TokenRefreshException";function Lo(t){if(!t||!t.idToken)throw new l({name:Ct,message:"User needs to be authenticated to call this API.",recoverySuggestion:"Sign in before calling this API again."})}const Vo=new l({name:No,message:`Token refresh is not supported when authenticated with the 'implicit grant' (token) oauth flow. 
	Please change your oauth configuration to use 'code grant' flow.`,recoverySuggestion:`Please logout and change your Amplify configuration to use "code grant" flow. 
	E.g { responseType: 'code' }`}),$o=new l({name:Ct,message:"User needs to be authenticated to call this API.",recoverySuggestion:"Sign in before calling this API again."});function Wo(t){if(zo(t))throw Vo;if(!Fo(t))throw $o}const Go={inflightOAuth:"inflightOAuth",oauthSignIn:"oauthSignIn",oauthPKCE:"oauthPKCE",oauthState:"oauthState"};function vt(t){return t?.accessToken||t?.idToken}function Fo(t){return vt(t)&&t?.refreshToken}function zo(t){return vt(t)&&!t?.refreshToken}const Bo=t=>(e,n)=>{const o=jo(t),i=JSON.stringify(e);return Ho(n,o,i)},jo=t=>({"content-type":"application/x-amz-json-1.1","x-amz-target":`AWSCognitoIdentityProviderService.${t}`}),Ho=({url:t},e,n)=>({headers:e,url:t,body:n,method:"POST"});function L(t){if(!t||t.name==="Error"||t instanceof TypeError)throw new l({name:b.Unknown,message:"An unknown error has occurred.",underlyingError:t})}const qo=()=>async t=>{if(t.statusCode>=300){const e=await V(t);throw L(e),new l({name:e.name,message:e.message,metadata:e.$metadata})}return q(t)},Jo=()=>(t,e)=>async function(o){return o.headers["cache-control"]="no-store",t(o)},Yo=he(ft,[Jo]),At="cognito-idp",Qo={service:At,retryDecider:lt(V),computeDelay:ut,get userAgentValue(){return ue()},cache:"no-store"},Xo=({region:t})=>({url:new J(`https://${At}.${t}.${mt(t)}`)}),Zo=({endpointOverride:t})=>e=>t?{url:new J(t)}:Xo(e),ei=t=>le(Yo,Bo("GetTokensFromRefreshToken"),qo(),{...Qo,...t}),ti=async({tokens:t,authConfig:e,username:n,clientMetadata:o})=>{S(e?.Cognito);const{userPoolId:i,userPoolClientId:s,userPoolEndpoint:r}=e.Cognito,a=Mo(i);Wo(t);const c=ei({endpointResolver:Zo({endpointOverride:r})}),{AuthenticationResult:d}=await c({region:a},{ClientId:s,RefreshToken:t.refreshToken,DeviceKey:t.deviceMetadata?.deviceKey,ClientMetadata:o}),u=U(d?.AccessToken??""),m=d?.IdToken?U(d.IdToken):void 0,{iat:I}=u.payload;if(!I)throw new l({name:"iatNotFoundException",message:"iat not found in access token"});const f=I*1e3-new Date().getTime();return{accessToken:u,idToken:m,clockDrift:f,refreshToken:d?.RefreshToken??t.refreshToken,username:n}},ni=Oo(ti),oi={accessToken:"accessToken",idToken:"idToken",oidcProvider:"oidcProvider",clockDrift:"clockDrift",refreshToken:"refreshToken",deviceKey:"deviceKey",randomPasswordKey:"randomPasswordKey",deviceGroupKey:"deviceGroupKey",signInDetails:"signInDetails",oauthMetadata:"oauthMetadata"};var B;(function(t){t.InvalidAuthTokens="InvalidAuthTokens"})(B||(B={}));const ii={[B.InvalidAuthTokens]:{message:"Invalid tokens.",recoverySuggestion:"Make sure the tokens are valid."}},si=nt(ii),Xe="CognitoIdentityServiceProvider";class ri{getKeyValueStorage(){if(!this.keyValueStorage)throw new l({name:"KeyValueStorageNotFoundException",message:"KeyValueStorage was not found in TokenStore"});return this.keyValueStorage}setKeyValueStorage(e){this.keyValueStorage=e}setAuthConfig(e){this.authConfig=e}async loadTokens(){try{const e=await this.getAuthKeys(),n=await this.getKeyValueStorage().getItem(e.accessToken);if(!n)throw new l({name:"NoSessionFoundException",message:"Auth session was not found. Make sure to call signIn."});const o=U(n),i=await this.getKeyValueStorage().getItem(e.idToken),s=i?U(i):void 0,r=await this.getKeyValueStorage().getItem(e.refreshToken)??void 0,a=await this.getKeyValueStorage().getItem(e.clockDrift)??"0",c=Number.parseInt(a),d=await this.getKeyValueStorage().getItem(e.signInDetails),u={accessToken:o,idToken:s,refreshToken:r,deviceMetadata:await this.getDeviceMetadata()??void 0,clockDrift:c,username:await this.getLastAuthUser()};return d&&(u.signInDetails=JSON.parse(d)),u}catch{return null}}async storeTokens(e){si(e!==void 0,B.InvalidAuthTokens);const n=e.username;await this.getKeyValueStorage().setItem(this.getLastAuthUserKey(),n);const o=await this.getAuthKeys();await this.getKeyValueStorage().setItem(o.accessToken,e.accessToken.toString()),e.idToken?await this.getKeyValueStorage().setItem(o.idToken,e.idToken.toString()):await this.getKeyValueStorage().removeItem(o.idToken),e.refreshToken?await this.getKeyValueStorage().setItem(o.refreshToken,e.refreshToken):await this.getKeyValueStorage().removeItem(o.refreshToken),e.deviceMetadata&&(e.deviceMetadata.deviceKey&&await this.getKeyValueStorage().setItem(o.deviceKey,e.deviceMetadata.deviceKey),e.deviceMetadata.deviceGroupKey&&await this.getKeyValueStorage().setItem(o.deviceGroupKey,e.deviceMetadata.deviceGroupKey),await this.getKeyValueStorage().setItem(o.randomPasswordKey,e.deviceMetadata.randomPassword)),e.signInDetails?await this.getKeyValueStorage().setItem(o.signInDetails,JSON.stringify(e.signInDetails)):await this.getKeyValueStorage().removeItem(o.signInDetails),await this.getKeyValueStorage().setItem(o.clockDrift,`${e.clockDrift}`)}async clearTokens(){const e=await this.getAuthKeys();await Promise.all([this.getKeyValueStorage().removeItem(e.accessToken),this.getKeyValueStorage().removeItem(e.idToken),this.getKeyValueStorage().removeItem(e.clockDrift),this.getKeyValueStorage().removeItem(e.refreshToken),this.getKeyValueStorage().removeItem(e.signInDetails),this.getKeyValueStorage().removeItem(this.getLastAuthUserKey()),this.getKeyValueStorage().removeItem(e.oauthMetadata)])}async getDeviceMetadata(e){const n=await this.getAuthKeys(e),o=await this.getKeyValueStorage().getItem(n.deviceKey),i=await this.getKeyValueStorage().getItem(n.deviceGroupKey),s=await this.getKeyValueStorage().getItem(n.randomPasswordKey);return s&&i&&o?{deviceKey:o,deviceGroupKey:i,randomPassword:s}:null}async clearDeviceMetadata(e){const n=await this.getAuthKeys(e);await Promise.all([this.getKeyValueStorage().removeItem(n.deviceKey),this.getKeyValueStorage().removeItem(n.deviceGroupKey),this.getKeyValueStorage().removeItem(n.randomPasswordKey)])}async getAuthKeys(e){S(this.authConfig?.Cognito);const n=e??await this.getLastAuthUser();return ai(Xe,`${this.authConfig.Cognito.userPoolClientId}.${n}`)}getLastAuthUserKey(){S(this.authConfig?.Cognito);const e=this.authConfig.Cognito.userPoolClientId;return`${Xe}.${e}.LastAuthUser`}async getLastAuthUser(){return await this.getKeyValueStorage().getItem(this.getLastAuthUserKey())??"username"}async setOAuthMetadata(e){const{oauthMetadata:n}=await this.getAuthKeys();await this.getKeyValueStorage().setItem(n,JSON.stringify(e))}async getOAuthMetadata(){const{oauthMetadata:e}=await this.getAuthKeys(),n=await this.getKeyValueStorage().getItem(e);return n&&JSON.parse(n)}}const ai=(t,e)=>ge(oi)(`${t}`,e);function ge(t){const e=Object.values({...t});return(n,o)=>e.reduce((i,s)=>({...i,[s]:`${n}.${o}.${s}`}),{})}const Ze="amplify-signin-with-hostedUI",E="CognitoIdentityServiceProvider";class ci{constructor(e){this.keyValueStorage=e}async clearOAuthInflightData(){S(this.cognitoConfig);const e=C(E,this.cognitoConfig.userPoolClientId);await Promise.all([this.keyValueStorage.removeItem(e.inflightOAuth),this.keyValueStorage.removeItem(e.oauthPKCE),this.keyValueStorage.removeItem(e.oauthState)])}async clearOAuthData(){S(this.cognitoConfig);const e=C(E,this.cognitoConfig.userPoolClientId);return await this.clearOAuthInflightData(),await this.keyValueStorage.removeItem(Ze),this.keyValueStorage.removeItem(e.oauthSignIn)}loadOAuthState(){S(this.cognitoConfig);const e=C(E,this.cognitoConfig.userPoolClientId);return this.keyValueStorage.getItem(e.oauthState)}storeOAuthState(e){S(this.cognitoConfig);const n=C(E,this.cognitoConfig.userPoolClientId);return this.keyValueStorage.setItem(n.oauthState,e)}loadPKCE(){S(this.cognitoConfig);const e=C(E,this.cognitoConfig.userPoolClientId);return this.keyValueStorage.getItem(e.oauthPKCE)}storePKCE(e){S(this.cognitoConfig);const n=C(E,this.cognitoConfig.userPoolClientId);return this.keyValueStorage.setItem(n.oauthPKCE,e)}setAuthConfig(e){this.cognitoConfig=e}async loadOAuthInFlight(){S(this.cognitoConfig);const e=C(E,this.cognitoConfig.userPoolClientId);return await this.keyValueStorage.getItem(e.inflightOAuth)==="true"}async storeOAuthInFlight(e){S(this.cognitoConfig);const n=C(E,this.cognitoConfig.userPoolClientId);await this.keyValueStorage.setItem(n.inflightOAuth,`${e}`)}async loadOAuthSignIn(){S(this.cognitoConfig);const e=C(E,this.cognitoConfig.userPoolClientId),n=await this.keyValueStorage.getItem(Ze),[o,i]=(await this.keyValueStorage.getItem(e.oauthSignIn))?.split(",")??[];return{isOAuthSignIn:o==="true"||n==="true",preferPrivateSession:i==="true"}}async storeOAuthSignIn(e,n=!1){S(this.cognitoConfig);const o=C(E,this.cognitoConfig.userPoolClientId);await this.keyValueStorage.setItem(o.oauthSignIn,`${e},${n}`)}}const C=(t,e)=>ge(Go)(t,e),et=new ci(Y);class di{constructor(){this.waitForInflightOAuth=jn()?async()=>{if(await et.loadOAuthInFlight())return this.inflightPromise?this.inflightPromise:(this.inflightPromise=new Promise((e,n)=>{}),this.inflightPromise)}:async()=>{}}setAuthConfig(e){et.setAuthConfig(e.Cognito),this.authConfig=e}setTokenRefresher(e){this.tokenRefresher=e}setAuthTokenStore(e){this.tokenStore=e}getTokenStore(){if(!this.tokenStore)throw new l({name:"EmptyTokenStoreException",message:"TokenStore not set"});return this.tokenStore}getTokenRefresher(){if(!this.tokenRefresher)throw new l({name:"EmptyTokenRefresherException",message:"TokenRefresher not set"});return this.tokenRefresher}setClientMetadataProvider(e){this.clientMetadataProvider=e}async getTokens(e){let n;try{S(this.authConfig?.Cognito)}catch{return null}await this.waitForInflightOAuth(),this.inflightPromise=void 0,n=await this.getTokenStore().loadTokens();const o=await this.getTokenStore().getLastAuthUser();if(n===null)return null;const i=!!n?.idToken&&Qe({expiresAt:(n.idToken?.payload?.exp??0)*1e3,clockDrift:n.clockDrift??0}),s=Qe({expiresAt:(n.accessToken?.payload?.exp??0)*1e3,clockDrift:n.clockDrift??0});return(e?.forceRefresh||i||s)&&(n=await this.refreshTokens({tokens:n,username:o,clientMetadata:e?.clientMetadata??await this.clientMetadataProvider?.()}),n===null)?null:{accessToken:n?.accessToken,idToken:n?.idToken,signInDetails:n?.signInDetails}}async refreshTokens({tokens:e,username:n,clientMetadata:o}){try{const{signInDetails:i}=e,s=await this.getTokenRefresher()({tokens:e,authConfig:this.authConfig,username:n,clientMetadata:o});return s.signInDetails=i,await this.setTokens({tokens:s}),ie.dispatch("auth",{event:"tokenRefresh"},"Auth",z),s}catch(i){return this.handleErrors(i)}}handleErrors(e){if(L(e),this.isAuthenticationError(e)&&this.clearTokens(),ie.dispatch("auth",{event:"tokenRefresh_failure",data:{error:e}},"Auth",z),e.name.startsWith("NotAuthorizedException"))return null;throw e}isAuthenticationError(e){return["NotAuthorizedException","TokenRevokedException","UserNotFoundException","PasswordResetRequiredException","UserNotConfirmedException","RefreshTokenReuseException"].some(o=>e?.name?.startsWith?.(o))}async setTokens({tokens:e}){return this.getTokenStore().storeTokens(e)}async clearTokens(){return this.getTokenStore().clearTokens()}getDeviceMetadata(e){return this.getTokenStore().getDeviceMetadata(e)}clearDeviceMetadata(e){return this.getTokenStore().clearDeviceMetadata(e)}setOAuthMetadata(e){return this.getTokenStore().setOAuthMetadata(e)}getOAuthMetadata(){return this.getTokenStore().getOAuthMetadata()}}class ui{constructor(){this.authTokenStore=new ri,this.authTokenStore.setKeyValueStorage(Y),this.tokenOrchestrator=new di,this.tokenOrchestrator.setAuthTokenStore(this.authTokenStore),this.tokenOrchestrator.setTokenRefresher(ni)}getTokens(e={}){return this.tokenOrchestrator.getTokens(e)}setKeyValueStorage(e){this.authTokenStore.setKeyValueStorage(e)}setClientMetadataProvider(e){this.tokenOrchestrator.setClientMetadataProvider(e)}setAuthConfig(e){this.authTokenStore.setAuthConfig(e),this.tokenOrchestrator.setAuthConfig(e)}}const x=new ui,{tokenOrchestrator:mi}=x,li={identityId:"identityId"},hi=new _("DefaultIdentityIdStore");class Tt{setAuthConfig(e){F(e.Cognito),this.authConfig=e,this._authKeys=gi("Cognito",e.Cognito.identityPoolId)}constructor(e){this._authKeys={},this._hasGuestIdentityId=!1,this.keyValueStorage=e}async loadIdentityId(){F(this.authConfig?.Cognito);try{if(this._primaryIdentityId)return{id:this._primaryIdentityId,type:"primary"};{const e=await this.keyValueStorage.getItem(this._authKeys.identityId);return e?(this._hasGuestIdentityId=!0,{id:e,type:"guest"}):null}}catch(e){return hi.log("Error getting stored IdentityId.",e),null}}async storeIdentityId(e){F(this.authConfig?.Cognito),e.type==="guest"?(this.keyValueStorage.setItem(this._authKeys.identityId,e.id),this._primaryIdentityId=void 0,this._hasGuestIdentityId=!0):(this._primaryIdentityId=e.id,this._hasGuestIdentityId&&(this.keyValueStorage.removeItem(this._authKeys.identityId),this._hasGuestIdentityId=!1))}async clearIdentityId(){this._primaryIdentityId=void 0,await this.keyValueStorage.removeItem(this._authKeys.identityId)}}const gi=(t,e)=>ge(li)(`com.amplify.${t}`,e),ce=({endpointOverride:t})=>e=>t?{url:new J(t)}:Co(e);function kt(t){const e=U(t).payload.iss,n={};if(!e)throw new l({name:"InvalidIdTokenException",message:"Invalid Idtoken."});const o=e.replace(/(^\w+:|^)\/\//,"");return n[o]=t,n}async function fi({tokens:t,authConfig:e,identityIdStore:n}){n.setAuthConfig({Cognito:e});const o=await n.loadIdentityId();if(o)return o.id;const i=t?.idToken?kt(t.idToken.toString()):{},s=await pi(i,e);return n.storeIdentityId({id:s,type:t?"primary":"guest"}),s}async function pi(t,e){const n=e?.identityPoolId,o=ae(n),i=wo({endpointResolver:ce({endpointOverride:e.identityPoolEndpoint})});let s;try{s=(await i({region:o},{IdentityPoolId:n,Logins:t})).IdentityId}catch(r){throw L(r),new l(r)}if(!s)throw new l({name:"GetIdResponseException",message:"Received undefined response from getId operation",recoverySuggestion:"Make sure to pass a valid identityPoolId in the configuration."});return s}const G=new _("CognitoCredentialsProvider"),tt=3e3*1e3;class Pt{constructor(e){this._nextCredentialsRefresh=0,this._identityIdStore=e}async clearCredentialsAndIdentityId(){G.debug("Clearing out credentials and identityId"),this._credentialsAndIdentityId=void 0,await this._identityIdStore.clearIdentityId()}async clearCredentials(){G.debug("Clearing out in-memory credentials"),this._credentialsAndIdentityId=void 0}async getCredentialsAndIdentityId(e){const n=e.authenticated,{tokens:o}=e,{authConfig:i}=e;try{F(i?.Cognito)}catch{return}if(!n&&!i.Cognito.allowGuestAccess)return;const{forceRefresh:s}=e,r=this.hasTokenChanged(o),a=await fi({tokens:o,authConfig:i.Cognito,identityIdStore:this._identityIdStore});return(s||r)&&this.clearCredentials(),n?(Lo(o),this.credsForOIDCTokens(i.Cognito,o,a)):this.getGuestCredentials(a,i.Cognito)}async getGuestCredentials(e,n){if(this._credentialsAndIdentityId&&!this.isPastTTL()&&this._credentialsAndIdentityId.isAuthenticatedCreds===!1)return G.info("returning stored credentials as they neither past TTL nor expired."),this._credentialsAndIdentityId;this.clearCredentials();const o=ae(n.identityPoolId),i=Ye({endpointResolver:ce({endpointOverride:n.identityPoolEndpoint})});let s;try{s=await i({region:o},{IdentityId:e})}catch(r){throw L(r),new l(r)}if(s?.Credentials?.AccessKeyId&&s?.Credentials?.SecretKey){this._nextCredentialsRefresh=new Date().getTime()+tt;const r={credentials:{accessKeyId:s.Credentials.AccessKeyId,secretAccessKey:s.Credentials.SecretKey,sessionToken:s.Credentials.SessionToken,expiration:s.Credentials.Expiration},identityId:e};return s.IdentityId&&(r.identityId=s.IdentityId,this._identityIdStore.storeIdentityId({id:s.IdentityId,type:"guest"})),this._credentialsAndIdentityId={...r,isAuthenticatedCreds:!1},r}else throw new l({name:"CredentialsNotFoundException",message:"Cognito did not respond with either Credentials, AccessKeyId or SecretKey."})}async credsForOIDCTokens(e,n,o){if(this._credentialsAndIdentityId&&!this.isPastTTL()&&this._credentialsAndIdentityId.isAuthenticatedCreds===!0)return G.debug("returning stored credentials as they neither past TTL nor expired."),this._credentialsAndIdentityId;this.clearCredentials();const i=n.idToken?kt(n.idToken.toString()):{},s=ae(e.identityPoolId),r=Ye({endpointResolver:ce({endpointOverride:e.identityPoolEndpoint})});let a;try{a=await r({region:s},{IdentityId:o,Logins:i})}catch(c){throw L(c),new l(c)}if(a?.Credentials?.AccessKeyId&&a?.Credentials?.SecretKey){this._nextCredentialsRefresh=new Date().getTime()+tt;const c={credentials:{accessKeyId:a.Credentials.AccessKeyId,secretAccessKey:a.Credentials.SecretKey,sessionToken:a.Credentials.SessionToken,expiration:a.Credentials.Expiration},identityId:o};return a.IdentityId&&(c.identityId=a.IdentityId,this._identityIdStore.storeIdentityId({id:a.IdentityId,type:"primary"})),this._credentialsAndIdentityId={...c,isAuthenticatedCreds:!0,associatedIdToken:n.idToken?.toString()},c}else throw new l({name:"CredentialsException",message:"Cognito did not respond with either Credentials, AccessKeyId or SecretKey."})}isPastTTL(){return this._nextCredentialsRefresh===void 0?!0:this._nextCredentialsRefresh<=Date.now()}hasTokenChanged(e){return!!e&&!!this._credentialsAndIdentityId?.associatedIdToken&&e.idToken?.toString()!==this._credentialsAndIdentityId.associatedIdToken}}const yi=new Pt(new Tt(Y)),Si={configure(t,e){const n=rt(t),o=new bo({sameSite:"lax"}),i=e?.ssr?o:Y,s=e?.ssr?new Pt(new Tt(o)):yi;if(!n.Auth){k.configure(n,e);return}if(e?.Auth){k.configure(n,e);return}if(!k.libraryOptions.Auth){x.setAuthConfig(n.Auth),x.setKeyValueStorage(i),k.configure(n,{...e,Auth:{tokenProvider:x,credentialsProvider:s}});return}if(e){const r=k.libraryOptions.Auth;e.ssr!==void 0&&(x.setKeyValueStorage(i),r.credentialsProvider=s),k.configure(n,{Auth:r,...e});return}k.configure(n)},getConfig(){return k.getConfig()}};export{Si as Amplify};
