import{a as n,j as e}from"./charts-VUD2E1tl.js";import{r as T,a as q}from"./tensorflow-Bdm-eNd5.js";import{l as B,A as z,n as H}from"./index-OIM89d1-.js";import"./three-BxGoG16y.js";var K=T();function U({detections:a,onViolationClick:r}){return e.jsx("svg",{className:"absolute inset-0 w-full h-full pointer-events-none",children:a.map((t,o)=>e.jsxs("g",{children:[e.jsx("rect",{x:t.bbox[0],y:t.bbox[1],width:t.bbox[2],height:t.bbox[3],fill:"none",stroke:t.compliance==="compliant"?"#00FF00":t.compliance==="marginal"?"#FFFF00":"#FF0000",strokeWidth:"3",className:"pointer-events-auto cursor-pointer",onClick:()=>r(t)}),e.jsx("line",{x1:t.bbox[0],y1:t.bbox[1]+t.bbox[3]/2,x2:t.bbox[0]+t.bbox[2],y2:t.bbox[1]+t.bbox[3]/2,stroke:"#FFFFFF",strokeWidth:"2",strokeDasharray:"5,5"}),e.jsx("foreignObject",{x:t.bbox[0],y:t.bbox[1]-30,width:200,height:30,children:e.jsxs("div",{className:`px-2 py-1 rounded text-xs font-semibold ${t.compliance==="compliant"?"bg-green-500 text-white":t.compliance==="marginal"?"bg-yellow-500 text-black":"bg-red-500 text-white"}`,children:[t.class,": ",t.measurement,t.compliance!=="compliant"&&" âœ—"]})})]},o))})}function X({onContrastResult:a}){const r=n.useRef(null),t=n.useRef(null),o=n.useCallback(b=>{if(!r.current||!t.current)return;const i=r.current.getBoundingClientRect(),h=b.clientX-i.left,m=b.clientY-i.top,j=r.current.getContext("2d");j.drawImage(t.current,0,0,r.current.width,r.current.height);const v=j.getImageData(h,m,1,1).data,y=[v[0],v[1],v[2]],w=y.map(s=>(s=s/255,s<=.03928?s/12.92:Math.pow((s+.055)/1.055,2.4))),N=.2126*w[0]+.7152*w[1]+.0722*w[2],x=j.getImageData(Math.max(0,h-10),Math.max(0,m-10),20,20),u=[0,0,0];for(let s=0;s<x.data.length;s+=4)u[0]+=x.data[s],u[1]+=x.data[s+1],u[2]+=x.data[s+2];const C=x.data.length/4;u[0]/=C,u[1]/=C,u[2]/=C;const g=u.map(s=>(s=s/255,s<=.03928?s/12.92:Math.pow((s+.055)/1.055,2.4))),A=.2126*g[0]+.7152*g[1]+.0722*g[2],S=Math.max(N,A)+.05,D=Math.min(N,A)+.05,d=S/D,k=d>=4.5,I=d>=7;a({position:{x:h,y:m},contrastRatio:d.toFixed(2),wcagAA:k,wcagAAA:I,color1:`rgb(${y.join(",")})`,color2:`rgb(${u.map(s=>Math.round(s)).join(",")})`})},[a]);return e.jsx("canvas",{ref:r,className:"absolute inset-0 w-full h-full cursor-crosshair",onClick:o})}function Y({onAngleResult:a}){const[r,t]=n.useState(0),[o,b]=n.useState(!1);return n.useEffect(()=>{if(!window.DeviceOrientationEvent)return;const i=h=>{if(!o)return;const{beta:m}=h;t(Math.abs(m)),a(m)};return window.addEventListener("deviceorientation",i),()=>window.removeEventListener("deviceorientation",i)},[o,a]),e.jsxs("div",{className:"absolute top-4 left-4 glass-morphism p-4",children:[e.jsx("button",{onClick:()=>b(!o),className:`px-4 py-2 rounded ${o?"bg-red-500 text-white":"button-primary"}`,children:o?"Stop Measuring":"Measure Ramp Angle"}),o&&e.jsxs("div",{className:"mt-2 text-sm",children:["Current Angle: ",r.toFixed(1),"Â°",e.jsx("div",{className:`text-xs ${r<=4.76?"text-green-400":"text-red-400"}`,children:r<=4.76?"âœ“ ADA Compliant":"âœ— Exceeds ADA max (4.76Â°)"})]})]})}function J({violations:a,onGenerateReport:r}){return e.jsxs("div",{className:"absolute right-4 top-4 bottom-4 w-80 glass-morphism p-4 overflow-y-auto",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Real-time Compliance"}),e.jsx("div",{className:"space-y-2",children:a.length===0?e.jsx("div",{className:"text-gray-400 text-sm",children:"Scanning for violations..."}):a.map((t,o)=>e.jsxs("div",{className:`p-3 rounded text-sm ${t.severity==="critical"?"bg-red-500/20 border border-red-500":t.severity==="important"?"bg-yellow-500/20 border border-yellow-500":"bg-blue-500/20 border border-blue-500"}`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-semibold",children:t.type}),e.jsx("span",{children:t.measurement})]}),e.jsx("div",{className:"text-xs text-gray-400 mt-1",children:t.description}),e.jsx("div",{className:"text-xs mt-1",children:t.compliance?"âœ… ADA OK":"âŒ Non-Compliant"})]},o))}),a.length>0&&e.jsx("button",{onClick:r,className:"w-full button-primary mt-4",children:"Generate AI Report"})]})}function Q({result:a,onClose:r}){return a?e.jsx("div",{className:"absolute bottom-4 left-1/2 transform -translate-x-1/2 glass-morphism p-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded border",style:{backgroundColor:a.color1}}),e.jsx("div",{className:"w-8 h-8 rounded border",style:{backgroundColor:a.color2}})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-semibold",children:["Contrast: ",a.contrastRatio,":1"]}),e.jsxs("div",{className:"text-sm",children:["WCAG AA: ",a.wcagAA?"âœ…":"âŒ"," | WCAG AAA: ",a.wcagAAA?"âœ…":"âŒ"]})]}),e.jsx("button",{onClick:r,className:"text-gray-400 hover:text-white",children:"âœ•"})]})}):null}function ae(){const{setCurrentScene:a,startSession:r,endSession:t}=B(),[o,b]=n.useState(!0),[i,h]=n.useState(!1),[m,j]=n.useState(null),[E,v]=n.useState([]),[y,w]=n.useState([]),[N,x]=n.useState(null),[u,C]=n.useState(0),[g,A]=n.useState(null),[S,D]=n.useState("environment"),d=n.useRef(null),k=n.useRef(null);n.useEffect(()=>{(async()=>{try{await q();const l=await K.load();j(l)}catch(l){console.error("Failed to load model:",l)}})()},[]),n.useEffect(()=>(o===!1&&(async()=>{try{const l=await navigator.mediaDevices.getUserMedia({video:{facingMode:S},audio:!1});d.current&&(d.current.srcObject=l,A(l))}catch(l){console.error("Camera access denied:",l)}})(),()=>{g&&g.getTracks().forEach(l=>l.stop())}),[o,S]),n.useEffect(()=>{if(!m||!d.current||!i)return;const l=setInterval(async()=>{if(!d.current||!k.current)return;const O=(await m.detect(d.current)).map(p=>{let R="compliant",M="",F=null;switch(p.class){case"door":const f=I(p.bbox);M=`${f}"`,R=f>=32?"compliant":"non-compliant",f<32&&(F={type:"Door Width",measurement:`${f}"`,description:`Door is ${32-f}" too narrow for wheelchair access`,severity:f<28?"critical":"important",compliance:!1});break;case"chair":M="Obstacle",R="marginal",F={type:"Path Obstruction",measurement:"Chair blocking path",description:"Chair blocks accessible route",severity:"important",compliance:!1};break;case"stop sign":case"traffic light":M="Signage",R="marginal",F={type:"Sign Accessibility",measurement:"Visual sign only",description:"Missing tactile or audible signage",severity:"minor",compliance:!1};break}return{...p,measurement:M,compliance:R,violation:F}});v(O);const L=O.filter(p=>p.violation).map(p=>p.violation);w(L)},500);return()=>clearInterval(l)},[m,i]);const I=c=>{const l=c[2];return Math.round(l/10)},s=c=>{c.violation&&console.log("Violation details:",c.violation)},$=c=>{x(c)},W=c=>{C(Math.abs(c))},G=()=>{D(c=>c==="environment"?"user":"environment")},P=async()=>{console.log("Generating report for violations:",y)},V=()=>{a("dashboard")};return e.jsxs("div",{className:"relative w-full h-screen bg-black",children:[e.jsx(z,{children:o&&e.jsx(H.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 z-50 flex items-center justify-center bg-black/80",children:e.jsxs("div",{className:"glass-morphism p-8 max-w-2xl mx-4",children:[e.jsx("h2",{className:"text-3xl font-bold gradient-text mb-4",children:"AR Accessibility Auditor"}),e.jsxs("div",{className:"text-gray-300 space-y-4 mb-6",children:[e.jsx("p",{children:"Scan your environment to detect accessibility violations in real-time:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-2 ml-4",children:[e.jsx("li",{children:"Point camera at doors, ramps, and pathways"}),e.jsx("li",{children:"Tap to check color contrast ratios"}),e.jsx("li",{children:"Measure ramp angles using device orientation"}),e.jsx("li",{children:"Get AI-powered compliance reports"})]}),e.jsx("p",{className:"text-sm text-cyan-accent",children:"Powered by TensorFlow.js object detection and OpenAI analysis. Camera permission is required for scanning."})]}),e.jsx("button",{onClick:()=>b(!1),className:"button-primary w-full",children:"Start Scanning"})]})})}),e.jsx("video",{ref:d,autoPlay:!0,playsInline:!0,className:"absolute inset-0 w-full h-full object-cover"}),e.jsx("canvas",{ref:k,className:"absolute inset-0 w-full h-full",width:window.innerWidth,height:window.innerHeight}),i&&e.jsxs(e.Fragment,{children:[e.jsx(U,{detections:E,onViolationClick:s}),e.jsx(X,{onContrastResult:$})]}),e.jsxs("div",{className:"absolute top-4 left-4 flex gap-2",children:[e.jsx("button",{onClick:()=>h(!i),className:`px-4 py-2 rounded ${i?"bg-red-500 text-white":"button-primary"}`,children:i?"Stop Scanning":"Start Scanning"}),e.jsx("button",{onClick:G,className:"button-secondary",children:"ðŸ“· Switch Camera"})]}),e.jsx(Y,{onAngleResult:W}),e.jsx(J,{violations:y,onGenerateReport:P}),e.jsx(Q,{result:N,onClose:()=>x(null)}),e.jsx("button",{onClick:V,className:"absolute top-4 left-1/2 transform -translate-x-1/2 glass-morphism px-6 py-2 hover:bg-white/20 transition-colors",children:"Exit Auditor"}),e.jsx("div",{className:"absolute bottom-4 left-4 glass-morphism px-4 py-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${i?"bg-green-400 animate-pulse":"bg-gray-400"}`}),e.jsx("span",{className:"text-sm",children:i?"Scanning...":"Ready"})]})})]})}export{ae as default};
