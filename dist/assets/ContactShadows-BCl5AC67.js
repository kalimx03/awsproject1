import{t as Hr,s as Aa,_ as Lt,x as It,r as Da,k as Qn,y as Ia,z as In}from"./index-OIM89d1-.js";import{a as Ee}from"./charts-VUD2E1tl.js";import{l as Ra,v as Zr,I as Oa,o as pt,D as qn,w as $n,H as Er,x as Br,y as Qr,z as Mr,f as gt,G as Ba,J as La,K as ea,X as Ga,Y as Pa,Z as Na,_ as ra,m as yt,d as Nr,$ as za,c as Rt,a0 as Wa,u as Ha,t as ta,a1 as Va,a2 as jr,a3 as ja,a4 as Rn,a5 as $r,a6 as zr,S as na,O as Xa,a7 as Ot,a8 as Bt,W as Za,a9 as Ya,aa as tn,ab as Ka,ac as Ja,ad as Qa,ae as qa,U as nn,r as $a,af as eo,ag as On,ah as ro,F as Ft,ai as to,aj as no,ak as ao,al as oo,am as io}from"./three-BxGoG16y.js";const aa=parseInt(Ra.replace(/\D+/g,""));var Tr=Uint8Array,Wr=Uint16Array,an=Uint32Array,oa=new Tr([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),ia=new Tr([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),so=new Tr([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),sa=function(u,t){for(var c=new Wr(31),f=0;f<31;++f)c[f]=t+=1<<u[f-1];for(var r=new an(c[30]),f=1;f<30;++f)for(var e=c[f];e<c[f+1];++e)r[e]=e-c[f]<<5|f;return[c,r]},la=sa(oa,2),ua=la[0],lo=la[1];ua[28]=258,lo[258]=28;var uo=sa(ia,0),fo=uo[0],on=new Wr(32768);for(var rr=0;rr<32768;++rr){var Pr=(rr&43690)>>>1|(rr&21845)<<1;Pr=(Pr&52428)>>>2|(Pr&13107)<<2,Pr=(Pr&61680)>>>4|(Pr&3855)<<4,on[rr]=((Pr&65280)>>>8|(Pr&255)<<8)>>>1}var ht=(function(u,t,c){for(var f=u.length,r=0,e=new Wr(t);r<f;++r)++e[u[r]-1];var a=new Wr(t);for(r=0;r<t;++r)a[r]=a[r-1]+e[r-1]<<1;var i;if(c){i=new Wr(1<<t);var n=15-t;for(r=0;r<f;++r)if(u[r])for(var o=r<<4|u[r],s=t-u[r],h=a[u[r]-1]++<<s,d=h|(1<<s)-1;h<=d;++h)i[on[h]>>>n]=o}else for(i=new Wr(f),r=0;r<f;++r)u[r]&&(i[r]=on[a[u[r]-1]++]>>>15-u[r]);return i}),_t=new Tr(288);for(var rr=0;rr<144;++rr)_t[rr]=8;for(var rr=144;rr<256;++rr)_t[rr]=9;for(var rr=256;rr<280;++rr)_t[rr]=7;for(var rr=280;rr<288;++rr)_t[rr]=8;var fa=new Tr(32);for(var rr=0;rr<32;++rr)fa[rr]=5;var co=ht(_t,9,1),ho=ht(fa,5,1),Qt=function(u){for(var t=u[0],c=1;c<u.length;++c)u[c]>t&&(t=u[c]);return t},Dr=function(u,t,c){var f=t/8|0;return(u[f]|u[f+1]<<8)>>(t&7)&c},qt=function(u,t){var c=t/8|0;return(u[c]|u[c+1]<<8|u[c+2]<<16)>>(t&7)},vo=function(u){return(u/8|0)+(u&7&&1)},po=function(u,t,c){(c==null||c>u.length)&&(c=u.length);var f=new(u instanceof Wr?Wr:u instanceof an?an:Tr)(c-t);return f.set(u.subarray(t,c)),f},go=function(u,t,c){var f=u.length;if(!f||c&&!c.l&&f<5)return t||new Tr(0);var r=!t||c,e=!c||c.i;c||(c={}),t||(t=new Tr(f*3));var a=function(V){var j=t.length;if(V>j){var Y=new Tr(Math.max(j*2,V));Y.set(t),t=Y}},i=c.f||0,n=c.p||0,o=c.b||0,s=c.l,h=c.d,d=c.m,p=c.n,m=f*8;do{if(!s){c.f=i=Dr(u,n,1);var S=Dr(u,n+1,3);if(n+=3,S)if(S==1)s=co,h=ho,d=9,p=5;else if(S==2){var I=Dr(u,n,31)+257,E=Dr(u,n+10,15)+4,C=I+Dr(u,n+5,31)+1;n+=14;for(var A=new Tr(C),M=new Tr(19),_=0;_<E;++_)M[so[_]]=Dr(u,n+_*3,7);n+=E*3;for(var T=Qt(M),O=(1<<T)-1,q=ht(M,T,1),_=0;_<C;){var b=q[Dr(u,n,O)];n+=b&15;var w=b>>>4;if(w<16)A[_++]=w;else{var D=0,U=0;for(w==16?(U=3+Dr(u,n,3),n+=2,D=A[_-1]):w==17?(U=3+Dr(u,n,7),n+=3):w==18&&(U=11+Dr(u,n,127),n+=7);U--;)A[_++]=D}}var K=A.subarray(0,I),H=A.subarray(I);d=Qt(K),p=Qt(H),s=ht(K,d,1),h=ht(H,p,1)}else throw"invalid block type";else{var w=vo(n)+4,W=u[w-4]|u[w-3]<<8,k=w+W;if(k>f){if(e)throw"unexpected EOF";break}r&&a(o+W),t.set(u.subarray(w,k),o),c.b=o+=W,c.p=n=k*8;continue}if(n>m){if(e)throw"unexpected EOF";break}}r&&a(o+131072);for(var ie=(1<<d)-1,ue=(1<<p)-1,X=n;;X=n){var D=s[qt(u,n)&ie],L=D>>>4;if(n+=D&15,n>m){if(e)throw"unexpected EOF";break}if(!D)throw"invalid length/literal";if(L<256)t[o++]=L;else if(L==256){X=n,s=null;break}else{var y=L-254;if(L>264){var _=L-257,x=oa[_];y=Dr(u,n,(1<<x)-1)+ua[_],n+=x}var R=h[qt(u,n)&ue],P=R>>>4;if(!R)throw"invalid distance";n+=R&15;var H=fo[P];if(P>3){var x=ia[P];H+=qt(u,n)&(1<<x)-1,n+=x}if(n>m){if(e)throw"unexpected EOF";break}r&&a(o+131072);for(var G=o+y;o<G;o+=4)t[o]=t[o-H],t[o+1]=t[o+1-H],t[o+2]=t[o+2-H],t[o+3]=t[o+3-H];o=G}}c.l=s,c.p=X,c.b=o,s&&(i=1,c.m=d,c.d=h,c.n=p)}while(!i);return o==t.length?t:po(t,0,o)},mo=new Tr(0),yo=function(u){if((u[0]&15)!=8||u[0]>>>4>7||(u[0]<<8|u[1])%31)throw"invalid zlib data";if(u[1]&32)throw"invalid zlib data: preset dictionaries not supported"};function Et(u,t){return go((yo(u),u.subarray(2,-4)),t)}var _o=typeof TextDecoder<"u"&&new TextDecoder,wo=0;try{_o.decode(mo,{stream:!0}),wo=1}catch{}const bo=u=>u&&u.isCubeTexture;class So extends Zr{constructor(t,c){var f,r;const e=bo(t),i=((r=e?(f=t.image[0])==null?void 0:f.width:t.image.width)!=null?r:1024)/4,n=Math.floor(Math.log2(i)),o=Math.pow(2,n),s=3*Math.max(o,112),h=4*o,d=[e?"#define ENVMAP_TYPE_CUBE":"",`#define CUBEUV_TEXEL_WIDTH ${1/s}`,`#define CUBEUV_TEXEL_HEIGHT ${1/h}`,`#define CUBEUV_MAX_MIP ${n}.0`],p=`
        varying vec3 vWorldPosition;
        void main() 
        {
            vec4 worldPosition = ( modelMatrix * vec4( position, 1.0 ) );
            vWorldPosition = worldPosition.xyz;
            
            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }
        `,m=d.join(`
`)+`
        #define ENVMAP_TYPE_CUBE_UV
        varying vec3 vWorldPosition;
        uniform float radius;
        uniform float height;
        uniform float angle;
        #ifdef ENVMAP_TYPE_CUBE
            uniform samplerCube map;
        #else
            uniform sampler2D map;
        #endif
        // From: https://www.shadertoy.com/view/4tsBD7
        float diskIntersectWithBackFaceCulling( vec3 ro, vec3 rd, vec3 c, vec3 n, float r ) 
        {
            float d = dot ( rd, n );
            
            if( d > 0.0 ) { return 1e6; }
            
            vec3  o = ro - c;
            float t = - dot( n, o ) / d;
            vec3  q = o + rd * t;
            
            return ( dot( q, q ) < r * r ) ? t : 1e6;
        }
        // From: https://www.iquilezles.org/www/articles/intersectors/intersectors.htm
        float sphereIntersect( vec3 ro, vec3 rd, vec3 ce, float ra ) 
        {
            vec3 oc = ro - ce;
            float b = dot( oc, rd );
            float c = dot( oc, oc ) - ra * ra;
            float h = b * b - c;
            
            if( h < 0.0 ) { return -1.0; }
            
            h = sqrt( h );
            
            return - b + h;
        }
        vec3 project() 
        {
            vec3 p = normalize( vWorldPosition );
            vec3 camPos = cameraPosition;
            camPos.y -= height;
            float intersection = sphereIntersect( camPos, p, vec3( 0.0 ), radius );
            if( intersection > 0.0 ) {
                
                vec3 h = vec3( 0.0, - height, 0.0 );
                float intersection2 = diskIntersectWithBackFaceCulling( camPos, p, h, vec3( 0.0, 1.0, 0.0 ), radius );
                p = ( camPos + min( intersection, intersection2 ) * p ) / radius;
            } else {
                p = vec3( 0.0, 1.0, 0.0 );
            }
            return p;
        }
        #include <common>
        #include <cube_uv_reflection_fragment>
        void main() 
        {
            vec3 projectedWorldPosition = project();
            
            #ifdef ENVMAP_TYPE_CUBE
                vec3 outcolor = textureCube( map, projectedWorldPosition ).rgb;
            #else
                vec3 direction = normalize( projectedWorldPosition );
                vec2 uv = equirectUv( direction );
                vec3 outcolor = texture2D( map, uv ).rgb;
            #endif
            gl_FragColor = vec4( outcolor, 1.0 );
            #include <tonemapping_fragment>
            #include <${aa>=154?"colorspace_fragment":"encodings_fragment"}>
        }
        `,S={map:{value:t},height:{value:c?.height||15},radius:{value:c?.radius||100}},w=new Oa(1,16),W=new pt({uniforms:S,fragmentShader:m,vertexShader:p,side:qn});super(w,W)}set radius(t){this.material.uniforms.radius.value=t}get radius(){return this.material.uniforms.radius.value}set height(t){this.material.uniforms.height.value=t}get height(){return this.material.uniforms.height.value}}const Uo={uniforms:{tDiffuse:{value:null},h:{value:1/512}},vertexShader:`
      varying vec2 vUv;

      void main() {

        vUv = uv;
        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

      }
  `,fragmentShader:`
    uniform sampler2D tDiffuse;
    uniform float h;

    varying vec2 vUv;

    void main() {

    	vec4 sum = vec4( 0.0 );

    	sum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;
    	sum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;
    	sum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;
    	sum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;
    	sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
    	sum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;
    	sum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;
    	sum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;
    	sum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;

    	gl_FragColor = sum;

    }
  `},xo={uniforms:{tDiffuse:{value:null},v:{value:1/512}},vertexShader:`
    varying vec2 vUv;

    void main() {

      vUv = uv;
      gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

    }
  `,fragmentShader:`

  uniform sampler2D tDiffuse;
  uniform float v;

  varying vec2 vUv;

  void main() {

    vec4 sum = vec4( 0.0 );

    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;

    gl_FragColor = sum;

  }
  `};class To extends $n{constructor(t){super(t),this.type=Er}parse(t){const a=function(_,T){switch(_){case 1:throw new Error("THREE.RGBELoader: Read Error: "+(T||""));case 2:throw new Error("THREE.RGBELoader: Write Error: "+(T||""));case 3:throw new Error("THREE.RGBELoader: Bad File Format: "+(T||""));default:case 4:throw new Error("THREE.RGBELoader: Memory Error: "+(T||""))}},h=function(_,T,O){T=T||1024;let b=_.pos,D=-1,U=0,K="",H=String.fromCharCode.apply(null,new Uint16Array(_.subarray(b,b+128)));for(;0>(D=H.indexOf(`
`))&&U<T&&b<_.byteLength;)K+=H,U+=H.length,b+=128,H+=String.fromCharCode.apply(null,new Uint16Array(_.subarray(b,b+128)));return-1<D?(_.pos+=U+D+1,K+H.slice(0,D)):!1},d=function(_){const T=/^#\?(\S+)/,O=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,q=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,b=/^\s*FORMAT=(\S+)\s*$/,D=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,U={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let K,H;for((_.pos>=_.byteLength||!(K=h(_)))&&a(1,"no header found"),(H=K.match(T))||a(3,"bad initial token"),U.valid|=1,U.programtype=H[1],U.string+=K+`
`;K=h(_),K!==!1;){if(U.string+=K+`
`,K.charAt(0)==="#"){U.comments+=K+`
`;continue}if((H=K.match(O))&&(U.gamma=parseFloat(H[1])),(H=K.match(q))&&(U.exposure=parseFloat(H[1])),(H=K.match(b))&&(U.valid|=2,U.format=H[1]),(H=K.match(D))&&(U.valid|=4,U.height=parseInt(H[1],10),U.width=parseInt(H[2],10)),U.valid&2&&U.valid&4)break}return U.valid&2||a(3,"missing format specifier"),U.valid&4||a(3,"missing image size specifier"),U},p=function(_,T,O){const q=T;if(q<8||q>32767||_[0]!==2||_[1]!==2||_[2]&128)return new Uint8Array(_);q!==(_[2]<<8|_[3])&&a(3,"wrong scanline width");const b=new Uint8Array(4*T*O);b.length||a(4,"unable to allocate buffer space");let D=0,U=0;const K=4*q,H=new Uint8Array(4),ie=new Uint8Array(K);let ue=O;for(;ue>0&&U<_.byteLength;){U+4>_.byteLength&&a(1),H[0]=_[U++],H[1]=_[U++],H[2]=_[U++],H[3]=_[U++],(H[0]!=2||H[1]!=2||(H[2]<<8|H[3])!=q)&&a(3,"bad rgbe scanline format");let X=0,L;for(;X<K&&U<_.byteLength;){L=_[U++];const x=L>128;if(x&&(L-=128),(L===0||X+L>K)&&a(3,"bad scanline data"),x){const R=_[U++];for(let P=0;P<L;P++)ie[X++]=R}else ie.set(_.subarray(U,U+L),X),X+=L,U+=L}const y=q;for(let x=0;x<y;x++){let R=0;b[D]=ie[x+R],R+=q,b[D+1]=ie[x+R],R+=q,b[D+2]=ie[x+R],R+=q,b[D+3]=ie[x+R],D+=4}ue--}return b},m=function(_,T,O,q){const b=_[T+3],D=Math.pow(2,b-128)/255;O[q+0]=_[T+0]*D,O[q+1]=_[T+1]*D,O[q+2]=_[T+2]*D,O[q+3]=1},S=function(_,T,O,q){const b=_[T+3],D=Math.pow(2,b-128)/255;O[q+0]=Qr.toHalfFloat(Math.min(_[T+0]*D,65504)),O[q+1]=Qr.toHalfFloat(Math.min(_[T+1]*D,65504)),O[q+2]=Qr.toHalfFloat(Math.min(_[T+2]*D,65504)),O[q+3]=Qr.toHalfFloat(1)},w=new Uint8Array(t);w.pos=0;const W=d(w),k=W.width,I=W.height,E=p(w.subarray(w.pos),k,I);let C,A,M;switch(this.type){case Br:M=E.length/4;const _=new Float32Array(M*4);for(let O=0;O<M;O++)m(E,O*4,_,O*4);C=_,A=Br;break;case Er:M=E.length/4;const T=new Uint16Array(M*4);for(let O=0;O<M;O++)S(E,O*4,T,O*4);C=T,A=Er;break;default:throw new Error("THREE.RGBELoader: Unsupported type: "+this.type)}return{width:k,height:I,data:C,header:W.string,gamma:W.gamma,exposure:W.exposure,type:A}}setDataType(t){return this.type=t,this}load(t,c,f,r){function e(a,i){switch(a.type){case Br:case Er:"colorSpace"in a?a.colorSpace="srgb-linear":a.encoding=3e3,a.minFilter=Mr,a.magFilter=Mr,a.generateMipmaps=!1,a.flipY=!0;break}c&&c(a,i)}return super.load(t,e,f,r)}}const lt=aa>=152;class Eo extends $n{constructor(t){super(t),this.type=Er}parse(t){const T=Math.pow(2.7182818,2.2);function O(l,v){for(var g=0,F=0;F<65536;++F)(F==0||l[F>>3]&1<<(F&7))&&(v[g++]=F);for(var N=g-1;g<65536;)v[g++]=0;return N}function q(l){for(var v=0;v<16384;v++)l[v]={},l[v].len=0,l[v].lit=0,l[v].p=null}const b={l:0,c:0,lc:0};function D(l,v,g,F,N){for(;g<l;)v=v<<8|Se(F,N),g+=8;g-=l,b.l=v>>g&(1<<l)-1,b.c=v,b.lc=g}const U=new Array(59);function K(l){for(var v=0;v<=58;++v)U[v]=0;for(var v=0;v<65537;++v)U[l[v]]+=1;for(var g=0,v=58;v>0;--v){var F=g+U[v]>>1;U[v]=g,g=F}for(var v=0;v<65537;++v){var N=l[v];N>0&&(l[v]=N|U[N]++<<6)}}function H(l,v,g,F,N,z,ee){for(var Q=g,te=0,ne=0;N<=z;N++){if(Q.value-g.value>F)return!1;D(6,te,ne,l,Q);var oe=b.l;if(te=b.c,ne=b.lc,ee[N]=oe,oe==63){if(Q.value-g.value>F)throw"Something wrong with hufUnpackEncTable";D(8,te,ne,l,Q);var B=b.l+6;if(te=b.c,ne=b.lc,N+B>z+1)throw"Something wrong with hufUnpackEncTable";for(;B--;)ee[N++]=0;N--}else if(oe>=59){var B=oe-59+2;if(N+B>z+1)throw"Something wrong with hufUnpackEncTable";for(;B--;)ee[N++]=0;N--}}K(ee)}function ie(l){return l&63}function ue(l){return l>>6}function X(l,v,g,F){for(;v<=g;v++){var N=ue(l[v]),z=ie(l[v]);if(N>>z)throw"Invalid table entry";if(z>14){var ee=F[N>>z-14];if(ee.len)throw"Invalid table entry";if(ee.lit++,ee.p){var Q=ee.p;ee.p=new Array(ee.lit);for(var te=0;te<ee.lit-1;++te)ee.p[te]=Q[te]}else ee.p=new Array(1);ee.p[ee.lit-1]=v}else if(z)for(var ne=0,te=1<<14-z;te>0;te--){var ee=F[(N<<14-z)+ne];if(ee.len||ee.p)throw"Invalid table entry";ee.len=z,ee.lit=v,ne++}}return!0}const L={c:0,lc:0};function y(l,v,g,F){l=l<<8|Se(g,F),v+=8,L.c=l,L.lc=v}const x={c:0,lc:0};function R(l,v,g,F,N,z,ee,Q,te,ne){if(l==v){F<8&&(y(g,F,N,ee),g=L.c,F=L.lc),F-=8;var oe=g>>F,oe=new Uint8Array([oe])[0];if(te.value+oe>ne)return!1;for(var B=Q[te.value-1];oe-- >0;)Q[te.value++]=B}else if(te.value<ne)Q[te.value++]=l;else return!1;x.c=g,x.lc=F}function P(l){return l&65535}function G(l){var v=P(l);return v>32767?v-65536:v}const V={a:0,b:0};function j(l,v){var g=G(l),F=G(v),N=F,z=g+(N&1)+(N>>1),ee=z,Q=z-N;V.a=ee,V.b=Q}function Y(l,v){var g=P(l),F=P(v),N=g-(F>>1)&65535,z=F+N-32768&65535;V.a=z,V.b=N}function le(l,v,g,F,N,z,ee){for(var Q=ee<16384,te=g>N?N:g,ne=1,oe;ne<=te;)ne<<=1;for(ne>>=1,oe=ne,ne>>=1;ne>=1;){for(var B=0,Ze=B+z*(N-oe),_e=z*ne,ve=z*oe,Me=F*ne,Re=F*oe,ze,We,tr,cr;B<=Ze;B+=ve){for(var He=B,Sr=B+F*(g-oe);He<=Sr;He+=Re){var Ye=He+Me,or=He+_e,vr=or+Me;Q?(j(l[He+v],l[or+v]),ze=V.a,tr=V.b,j(l[Ye+v],l[vr+v]),We=V.a,cr=V.b,j(ze,We),l[He+v]=V.a,l[Ye+v]=V.b,j(tr,cr),l[or+v]=V.a,l[vr+v]=V.b):(Y(l[He+v],l[or+v]),ze=V.a,tr=V.b,Y(l[Ye+v],l[vr+v]),We=V.a,cr=V.b,Y(ze,We),l[He+v]=V.a,l[Ye+v]=V.b,Y(tr,cr),l[or+v]=V.a,l[vr+v]=V.b)}if(g&ne){var or=He+_e;Q?j(l[He+v],l[or+v]):Y(l[He+v],l[or+v]),ze=V.a,l[or+v]=V.b,l[He+v]=ze}}if(N&ne)for(var He=B,Sr=B+F*(g-oe);He<=Sr;He+=Re){var Ye=He+Me;Q?j(l[He+v],l[Ye+v]):Y(l[He+v],l[Ye+v]),ze=V.a,l[Ye+v]=V.b,l[He+v]=ze}oe=ne,ne>>=1}return B}function de(l,v,g,F,N,z,ee,Q,te,ne){for(var oe=0,B=0,Ze=Q,_e=Math.trunc(N.value+(z+7)/8);N.value<_e;)for(y(oe,B,g,N),oe=L.c,B=L.lc;B>=14;){var ve=oe>>B-14&16383,Me=v[ve];if(Me.len)B-=Me.len,R(Me.lit,ee,oe,B,g,F,N,te,ne,Ze),oe=x.c,B=x.lc;else{if(!Me.p)throw"hufDecode issues";var Re;for(Re=0;Re<Me.lit;Re++){for(var ze=ie(l[Me.p[Re]]);B<ze&&N.value<_e;)y(oe,B,g,N),oe=L.c,B=L.lc;if(B>=ze&&ue(l[Me.p[Re]])==(oe>>B-ze&(1<<ze)-1)){B-=ze,R(Me.p[Re],ee,oe,B,g,F,N,te,ne,Ze),oe=x.c,B=x.lc;break}}if(Re==Me.lit)throw"hufDecode issues"}}var We=8-z&7;for(oe>>=We,B-=We;B>0;){var Me=v[oe<<14-B&16383];if(Me.len)B-=Me.len,R(Me.lit,ee,oe,B,g,F,N,te,ne,Ze),oe=x.c,B=x.lc;else throw"hufDecode issues"}return!0}function ae(l,v,g,F,N,z){var ee={value:0},Q=g.value,te=xe(v,g),ne=xe(v,g);g.value+=4;var oe=xe(v,g);if(g.value+=4,te<0||te>=65537||ne<0||ne>=65537)throw"Something wrong with HUF_ENCSIZE";var B=new Array(65537),Ze=new Array(16384);q(Ze);var _e=F-(g.value-Q);if(H(l,v,g,_e,te,ne,B),oe>8*(F-(g.value-Q)))throw"Something wrong with hufUncompress";X(B,te,ne,Ze),de(B,Ze,l,v,g,oe,ne,z,N,ee)}function $(l,v,g){for(var F=0;F<g;++F)v[F]=l[v[F]]}function Fe(l){for(var v=1;v<l.length;v++){var g=l[v-1]+l[v]-128;l[v]=g}}function Te(l,v){for(var g=0,F=Math.floor((l.length+1)/2),N=0,z=l.length-1;!(N>z||(v[N++]=l[g++],N>z));)v[N++]=l[F++]}function ce(l){for(var v=l.byteLength,g=new Array,F=0,N=new DataView(l);v>0;){var z=N.getInt8(F++);if(z<0){var ee=-z;v-=ee+1;for(var Q=0;Q<ee;Q++)g.push(N.getUint8(F++))}else{var ee=z;v-=2;for(var te=N.getUint8(F++),Q=0;Q<ee+1;Q++)g.push(te)}}return g}function pe(l,v,g,F,N,z){var Ye=new DataView(z.buffer),ee=g[l.idx[0]].width,Q=g[l.idx[0]].height,te=3,ne=Math.floor(ee/8),oe=Math.ceil(ee/8),B=Math.ceil(Q/8),Ze=ee-(oe-1)*8,_e=Q-(B-1)*8,ve={value:0},Me=new Array(te),Re=new Array(te),ze=new Array(te),We=new Array(te),tr=new Array(te);for(let Ve=0;Ve<te;++Ve)tr[Ve]=v[l.idx[Ve]],Me[Ve]=Ve<1?0:Me[Ve-1]+oe*B,Re[Ve]=new Float32Array(64),ze[Ve]=new Uint16Array(64),We[Ve]=new Uint16Array(oe*64);for(let Ve=0;Ve<B;++Ve){var cr=8;Ve==B-1&&(cr=_e);var He=8;for(let Qe=0;Qe<oe;++Qe){Qe==oe-1&&(He=Ze);for(let Oe=0;Oe<te;++Oe)ze[Oe].fill(0),ze[Oe][0]=N[Me[Oe]++],Ue(ve,F,ze[Oe]),re(ze[Oe],Re[Oe]),ge(Re[Oe]);he(Re);for(let Oe=0;Oe<te;++Oe)J(Re[Oe],We[Oe],Qe*64)}let ir=0;for(let Qe=0;Qe<te;++Qe){const Oe=g[l.idx[Qe]].type;for(let gr=8*Ve;gr<8*Ve+cr;++gr){ir=tr[Qe][gr];for(let xr=0;xr<ne;++xr){const lr=xr*64+(gr&7)*8;Ye.setUint16(ir+0*Oe,We[Qe][lr+0],!0),Ye.setUint16(ir+2*Oe,We[Qe][lr+1],!0),Ye.setUint16(ir+4*Oe,We[Qe][lr+2],!0),Ye.setUint16(ir+6*Oe,We[Qe][lr+3],!0),Ye.setUint16(ir+8*Oe,We[Qe][lr+4],!0),Ye.setUint16(ir+10*Oe,We[Qe][lr+5],!0),Ye.setUint16(ir+12*Oe,We[Qe][lr+6],!0),Ye.setUint16(ir+14*Oe,We[Qe][lr+7],!0),ir+=16*Oe}}if(ne!=oe)for(let gr=8*Ve;gr<8*Ve+cr;++gr){const xr=tr[Qe][gr]+8*ne*2*Oe,lr=ne*64+(gr&7)*8;for(let kr=0;kr<He;++kr)Ye.setUint16(xr+kr*2*Oe,We[Qe][lr+kr],!0)}}}for(var Sr=new Uint16Array(ee),Ye=new DataView(z.buffer),or=0;or<te;++or){g[l.idx[or]].decoded=!0;var vr=g[l.idx[or]].type;if(g[or].type==2)for(var Or=0;Or<Q;++Or){const Ve=tr[or][Or];for(var sr=0;sr<ee;++sr)Sr[sr]=Ye.getUint16(Ve+sr*2*vr,!0);for(var sr=0;sr<ee;++sr)Ye.setFloat32(Ve+sr*2*vr,Z(Sr[sr]),!0)}}}function Ue(l,v,g){for(var F,N=1;N<64;)F=v[l.value],F==65280?N=64:F>>8==255?N+=F&255:(g[N]=F,N++),l.value++}function re(l,v){v[0]=Z(l[0]),v[1]=Z(l[1]),v[2]=Z(l[5]),v[3]=Z(l[6]),v[4]=Z(l[14]),v[5]=Z(l[15]),v[6]=Z(l[27]),v[7]=Z(l[28]),v[8]=Z(l[2]),v[9]=Z(l[4]),v[10]=Z(l[7]),v[11]=Z(l[13]),v[12]=Z(l[16]),v[13]=Z(l[26]),v[14]=Z(l[29]),v[15]=Z(l[42]),v[16]=Z(l[3]),v[17]=Z(l[8]),v[18]=Z(l[12]),v[19]=Z(l[17]),v[20]=Z(l[25]),v[21]=Z(l[30]),v[22]=Z(l[41]),v[23]=Z(l[43]),v[24]=Z(l[9]),v[25]=Z(l[11]),v[26]=Z(l[18]),v[27]=Z(l[24]),v[28]=Z(l[31]),v[29]=Z(l[40]),v[30]=Z(l[44]),v[31]=Z(l[53]),v[32]=Z(l[10]),v[33]=Z(l[19]),v[34]=Z(l[23]),v[35]=Z(l[32]),v[36]=Z(l[39]),v[37]=Z(l[45]),v[38]=Z(l[52]),v[39]=Z(l[54]),v[40]=Z(l[20]),v[41]=Z(l[22]),v[42]=Z(l[33]),v[43]=Z(l[38]),v[44]=Z(l[46]),v[45]=Z(l[51]),v[46]=Z(l[55]),v[47]=Z(l[60]),v[48]=Z(l[21]),v[49]=Z(l[34]),v[50]=Z(l[37]),v[51]=Z(l[47]),v[52]=Z(l[50]),v[53]=Z(l[56]),v[54]=Z(l[59]),v[55]=Z(l[61]),v[56]=Z(l[35]),v[57]=Z(l[36]),v[58]=Z(l[48]),v[59]=Z(l[49]),v[60]=Z(l[57]),v[61]=Z(l[58]),v[62]=Z(l[62]),v[63]=Z(l[63])}function ge(l){const v=.5*Math.cos(.7853975),g=.5*Math.cos(3.14159/16),F=.5*Math.cos(3.14159/8),N=.5*Math.cos(3*3.14159/16),z=.5*Math.cos(5*3.14159/16),ee=.5*Math.cos(3*3.14159/8),Q=.5*Math.cos(7*3.14159/16);for(var te=new Array(4),ne=new Array(4),oe=new Array(4),B=new Array(4),Ze=0;Ze<8;++Ze){var _e=Ze*8;te[0]=F*l[_e+2],te[1]=ee*l[_e+2],te[2]=F*l[_e+6],te[3]=ee*l[_e+6],ne[0]=g*l[_e+1]+N*l[_e+3]+z*l[_e+5]+Q*l[_e+7],ne[1]=N*l[_e+1]-Q*l[_e+3]-g*l[_e+5]-z*l[_e+7],ne[2]=z*l[_e+1]-g*l[_e+3]+Q*l[_e+5]+N*l[_e+7],ne[3]=Q*l[_e+1]-z*l[_e+3]+N*l[_e+5]-g*l[_e+7],oe[0]=v*(l[_e+0]+l[_e+4]),oe[3]=v*(l[_e+0]-l[_e+4]),oe[1]=te[0]+te[3],oe[2]=te[1]-te[2],B[0]=oe[0]+oe[1],B[1]=oe[3]+oe[2],B[2]=oe[3]-oe[2],B[3]=oe[0]-oe[1],l[_e+0]=B[0]+ne[0],l[_e+1]=B[1]+ne[1],l[_e+2]=B[2]+ne[2],l[_e+3]=B[3]+ne[3],l[_e+4]=B[3]-ne[3],l[_e+5]=B[2]-ne[2],l[_e+6]=B[1]-ne[1],l[_e+7]=B[0]-ne[0]}for(var ve=0;ve<8;++ve)te[0]=F*l[16+ve],te[1]=ee*l[16+ve],te[2]=F*l[48+ve],te[3]=ee*l[48+ve],ne[0]=g*l[8+ve]+N*l[24+ve]+z*l[40+ve]+Q*l[56+ve],ne[1]=N*l[8+ve]-Q*l[24+ve]-g*l[40+ve]-z*l[56+ve],ne[2]=z*l[8+ve]-g*l[24+ve]+Q*l[40+ve]+N*l[56+ve],ne[3]=Q*l[8+ve]-z*l[24+ve]+N*l[40+ve]-g*l[56+ve],oe[0]=v*(l[ve]+l[32+ve]),oe[3]=v*(l[ve]-l[32+ve]),oe[1]=te[0]+te[3],oe[2]=te[1]-te[2],B[0]=oe[0]+oe[1],B[1]=oe[3]+oe[2],B[2]=oe[3]-oe[2],B[3]=oe[0]-oe[1],l[0+ve]=B[0]+ne[0],l[8+ve]=B[1]+ne[1],l[16+ve]=B[2]+ne[2],l[24+ve]=B[3]+ne[3],l[32+ve]=B[3]-ne[3],l[40+ve]=B[2]-ne[2],l[48+ve]=B[1]-ne[1],l[56+ve]=B[0]-ne[0]}function he(l){for(var v=0;v<64;++v){var g=l[0][v],F=l[1][v],N=l[2][v];l[0][v]=g+1.5747*N,l[1][v]=g-.1873*F-.4682*N,l[2][v]=g+1.8556*F}}function J(l,v,g){for(var F=0;F<64;++F)v[g+F]=Qr.toHalfFloat(ke(l[F]))}function ke(l){return l<=1?Math.sign(l)*Math.pow(Math.abs(l),2.2):Math.sign(l)*Math.pow(T,Math.abs(l)-1)}function fe(l){return new DataView(l.array.buffer,l.offset.value,l.size)}function we(l){var v=l.viewer.buffer.slice(l.offset.value,l.offset.value+l.size),g=new Uint8Array(ce(v)),F=new Uint8Array(g.length);return Fe(g),Te(g,F),new DataView(F.buffer)}function se(l){var v=l.array.slice(l.offset.value,l.offset.value+l.size),g=Et(v),F=new Uint8Array(g.length);return Fe(g),Te(g,F),new DataView(F.buffer)}function Pe(l){for(var v=l.viewer,g={value:l.offset.value},F=new Uint16Array(l.width*l.scanlineBlockSize*(l.channels*l.type)),N=new Uint8Array(8192),z=0,ee=new Array(l.channels),Q=0;Q<l.channels;Q++)ee[Q]={},ee[Q].start=z,ee[Q].end=ee[Q].start,ee[Q].nx=l.width,ee[Q].ny=l.lines,ee[Q].size=l.type,z+=ee[Q].nx*ee[Q].ny*ee[Q].size;var te=Ge(v,g),ne=Ge(v,g);if(ne>=8192)throw"Something is wrong with PIZ_COMPRESSION BITMAP_SIZE";if(te<=ne)for(var Q=0;Q<ne-te+1;Q++)N[Q+te]=Xe(v,g);var oe=new Uint16Array(65536),B=O(N,oe),Ze=xe(v,g);ae(l.array,v,g,Ze,F,z);for(var Q=0;Q<l.channels;++Q)for(var _e=ee[Q],ve=0;ve<ee[Q].size;++ve)le(F,_e.start+ve,_e.nx,_e.size,_e.ny,_e.nx*_e.size,B);$(oe,F,z);for(var Me=0,Re=new Uint8Array(F.buffer.byteLength),ze=0;ze<l.lines;ze++)for(var We=0;We<l.channels;We++){var _e=ee[We],tr=_e.nx*_e.size,cr=new Uint8Array(F.buffer,_e.end*2,tr*2);Re.set(cr,Me),Me+=tr*2,_e.end+=tr}return new DataView(Re.buffer)}function me(l){var v=l.array.slice(l.offset.value,l.offset.value+l.size),g=Et(v);const F=l.lines*l.channels*l.width,N=l.type==1?new Uint16Array(F):new Uint32Array(F);let z=0,ee=0;const Q=new Array(4);for(let te=0;te<l.lines;te++)for(let ne=0;ne<l.channels;ne++){let oe=0;switch(l.type){case 1:Q[0]=z,Q[1]=Q[0]+l.width,z=Q[1]+l.width;for(let B=0;B<l.width;++B){const Ze=g[Q[0]++]<<8|g[Q[1]++];oe+=Ze,N[ee]=oe,ee++}break;case 2:Q[0]=z,Q[1]=Q[0]+l.width,Q[2]=Q[1]+l.width,z=Q[2]+l.width;for(let B=0;B<l.width;++B){const Ze=g[Q[0]++]<<24|g[Q[1]++]<<16|g[Q[2]++]<<8;oe+=Ze,N[ee]=oe,ee++}break}}return new DataView(N.buffer)}function ye(l){var v=l.viewer,g={value:l.offset.value},F=new Uint8Array(l.width*l.lines*(l.channels*l.type*2)),N={version:Le(v,g),unknownUncompressedSize:Le(v,g),unknownCompressedSize:Le(v,g),acCompressedSize:Le(v,g),dcCompressedSize:Le(v,g),rleCompressedSize:Le(v,g),rleUncompressedSize:Le(v,g),rleRawSize:Le(v,g),totalAcUncompressedCount:Le(v,g),totalDcUncompressedCount:Le(v,g),acCompression:Le(v,g)};if(N.version<2)throw"EXRLoader.parse: "+br.compression+" version "+N.version+" is unsupported";for(var z=new Array,ee=Ge(v,g)-2;ee>0;){var Q=be(v.buffer,g),te=Xe(v,g),ne=te>>2&3,oe=(te>>4)-1,B=new Int8Array([oe])[0],Ze=Xe(v,g);z.push({name:Q,index:B,type:Ze,compression:ne}),ee-=Q.length+3}for(var _e=br.channels,ve=new Array(l.channels),Me=0;Me<l.channels;++Me){var Re=ve[Me]={},ze=_e[Me];Re.name=ze.name,Re.compression=0,Re.decoded=!1,Re.type=ze.pixelType,Re.pLinear=ze.pLinear,Re.width=l.width,Re.height=l.lines}for(var We={idx:new Array(3)},tr=0;tr<l.channels;++tr)for(var Re=ve[tr],Me=0;Me<z.length;++Me){var cr=z[Me];Re.name==cr.name&&(Re.compression=cr.compression,cr.index>=0&&(We.idx[cr.index]=tr),Re.offset=tr)}if(N.acCompressedSize>0)switch(N.acCompression){case 0:var Ye=new Uint16Array(N.totalAcUncompressedCount);ae(l.array,v,g,N.acCompressedSize,Ye,N.totalAcUncompressedCount);break;case 1:var He=l.array.slice(g.value,g.value+N.totalAcUncompressedCount),Sr=Et(He),Ye=new Uint16Array(Sr.buffer);g.value+=N.totalAcUncompressedCount;break}if(N.dcCompressedSize>0){var or={array:l.array,offset:g,size:N.dcCompressedSize},vr=new Uint16Array(se(or).buffer);g.value+=N.dcCompressedSize}if(N.rleRawSize>0){var He=l.array.slice(g.value,g.value+N.rleCompressedSize),Sr=Et(He),Or=ce(Sr.buffer);g.value+=N.rleCompressedSize}for(var sr=0,Ve=new Array(ve.length),Me=0;Me<Ve.length;++Me)Ve[Me]=new Array;for(var ir=0;ir<l.lines;++ir)for(var Qe=0;Qe<ve.length;++Qe)Ve[Qe].push(sr),sr+=ve[Qe].width*l.type*2;pe(We,Ve,ve,Ye,vr,F);for(var Me=0;Me<ve.length;++Me){var Re=ve[Me];if(!Re.decoded)switch(Re.compression){case 2:for(var Oe=0,gr=0,ir=0;ir<l.lines;++ir){for(var xr=Ve[Me][Oe],lr=0;lr<Re.width;++lr){for(var kr=0;kr<2*Re.type;++kr)F[xr++]=Or[gr+kr*Re.width*Re.height];gr++}Oe++}break;default:throw"EXRLoader.parse: unsupported channel compression"}}return new DataView(F.buffer)}function be(l,v){for(var g=new Uint8Array(l),F=0;g[v.value+F]!=0;)F+=1;var N=new TextDecoder().decode(g.slice(v.value,v.value+F));return v.value=v.value+F+1,N}function Ae(l,v,g){var F=new TextDecoder().decode(new Uint8Array(l).slice(v.value,v.value+g));return v.value=v.value+g,F}function Ke(l,v){var g=De(l,v),F=xe(l,v);return[g,F]}function er(l,v){var g=xe(l,v),F=xe(l,v);return[g,F]}function De(l,v){var g=l.getInt32(v.value,!0);return v.value=v.value+4,g}function xe(l,v){var g=l.getUint32(v.value,!0);return v.value=v.value+4,g}function Se(l,v){var g=l[v.value];return v.value=v.value+1,g}function Xe(l,v){var g=l.getUint8(v.value);return v.value=v.value+1,g}const Le=function(l,v){let g;return"getBigInt64"in DataView.prototype?g=Number(l.getBigInt64(v.value,!0)):g=l.getUint32(v.value+4,!0)+Number(l.getUint32(v.value,!0)<<32),v.value+=8,g};function Ne(l,v){var g=l.getFloat32(v.value,!0);return v.value+=4,g}function Je(l,v){return Qr.toHalfFloat(Ne(l,v))}function Z(l){var v=(l&31744)>>10,g=l&1023;return(l>>15?-1:1)*(v?v===31?g?NaN:1/0:Math.pow(2,v-15)*(1+g/1024):6103515625e-14*(g/1024))}function Ge(l,v){var g=l.getUint16(v.value,!0);return v.value+=2,g}function Ir(l,v){return Z(Ge(l,v))}function je(l,v,g,F){for(var N=g.value,z=[];g.value<N+F-1;){var ee=be(v,g),Q=De(l,g),te=Xe(l,g);g.value+=3;var ne=De(l,g),oe=De(l,g);z.push({name:ee,pixelType:Q,pLinear:te,xSampling:ne,ySampling:oe})}return g.value+=1,z}function Be(l,v){var g=Ne(l,v),F=Ne(l,v),N=Ne(l,v),z=Ne(l,v),ee=Ne(l,v),Q=Ne(l,v),te=Ne(l,v),ne=Ne(l,v);return{redX:g,redY:F,greenX:N,greenY:z,blueX:ee,blueY:Q,whiteX:te,whiteY:ne}}function nr(l,v){var g=["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"],F=Xe(l,v);return g[F]}function qe(l,v){var g=xe(l,v),F=xe(l,v),N=xe(l,v),z=xe(l,v);return{xMin:g,yMin:F,xMax:N,yMax:z}}function Ie(l,v){var g=["INCREASING_Y"],F=Xe(l,v);return g[F]}function $e(l,v){var g=Ne(l,v),F=Ne(l,v);return[g,F]}function hr(l,v){var g=Ne(l,v),F=Ne(l,v),N=Ne(l,v);return[g,F,N]}function ur(l,v,g,F,N){if(F==="string"||F==="stringvector"||F==="iccProfile")return Ae(v,g,N);if(F==="chlist")return je(l,v,g,N);if(F==="chromaticities")return Be(l,g);if(F==="compression")return nr(l,g);if(F==="box2i")return qe(l,g);if(F==="lineOrder")return Ie(l,g);if(F==="float")return Ne(l,g);if(F==="v2f")return $e(l,g);if(F==="v3f")return hr(l,g);if(F==="int")return De(l,g);if(F==="rational")return Ke(l,g);if(F==="timecode")return er(l,g);if(F==="preview")return g.value+=N,"skipped";g.value+=N}function ar(l,v,g){const F={};if(l.getUint32(0,!0)!=20000630)throw"THREE.EXRLoader: provided file doesn't appear to be in OpenEXR format.";F.version=l.getUint8(4);const N=l.getUint8(5);F.spec={singleTile:!!(N&2),longName:!!(N&4),deepFormat:!!(N&8),multiPart:!!(N&16)},g.value=8;for(var z=!0;z;){var ee=be(v,g);if(ee==0)z=!1;else{var Q=be(v,g),te=xe(l,g),ne=ur(l,v,g,Q,te);ne===void 0?console.warn(`EXRLoader.parse: skipped unknown header attribute type '${Q}'.`):F[ee]=ne}}if((N&-5)!=0)throw console.error("EXRHeader:",F),"THREE.EXRLoader: provided file is currently unsupported.";return F}function _r(l,v,g,F,N){const z={size:0,viewer:v,array:g,offset:F,width:l.dataWindow.xMax-l.dataWindow.xMin+1,height:l.dataWindow.yMax-l.dataWindow.yMin+1,channels:l.channels.length,bytesPerLine:null,lines:null,inputSize:null,type:l.channels[0].pixelType,uncompress:null,getter:null,format:null,[lt?"colorSpace":"encoding"]:null};switch(l.compression){case"NO_COMPRESSION":z.lines=1,z.uncompress=fe;break;case"RLE_COMPRESSION":z.lines=1,z.uncompress=we;break;case"ZIPS_COMPRESSION":z.lines=1,z.uncompress=se;break;case"ZIP_COMPRESSION":z.lines=16,z.uncompress=se;break;case"PIZ_COMPRESSION":z.lines=32,z.uncompress=Pe;break;case"PXR24_COMPRESSION":z.lines=16,z.uncompress=me;break;case"DWAA_COMPRESSION":z.lines=32,z.uncompress=ye;break;case"DWAB_COMPRESSION":z.lines=256,z.uncompress=ye;break;default:throw"EXRLoader.parse: "+l.compression+" is unsupported"}if(z.scanlineBlockSize=z.lines,z.type==1)switch(N){case Br:z.getter=Ir,z.inputSize=2;break;case Er:z.getter=Ge,z.inputSize=2;break}else if(z.type==2)switch(N){case Br:z.getter=Ne,z.inputSize=4;break;case Er:z.getter=Je,z.inputSize=4}else throw"EXRLoader.parse: unsupported pixelType "+z.type+" for "+l.compression+".";z.blockCount=(l.dataWindow.yMax+1)/z.scanlineBlockSize;for(var ee=0;ee<z.blockCount;ee++)Le(v,F);z.outputChannels=z.channels==3?4:z.channels;const Q=z.width*z.height*z.outputChannels;switch(N){case Br:z.byteArray=new Float32Array(Q),z.channels<z.outputChannels&&z.byteArray.fill(1,0,Q);break;case Er:z.byteArray=new Uint16Array(Q),z.channels<z.outputChannels&&z.byteArray.fill(15360,0,Q);break;default:console.error("THREE.EXRLoader: unsupported type: ",N);break}return z.bytesPerLine=z.width*z.inputSize*z.channels,z.outputChannels==4?z.format=gt:z.format=Ba,lt?z.colorSpace="srgb-linear":z.encoding=3e3,z}const wr=new DataView(t),Cr=new Uint8Array(t),pr={value:0},br=ar(wr,t,pr),Ce=_r(br,wr,Cr,pr,this.type),fr={value:0},Rr={R:0,G:1,B:2,A:3,Y:0};for(let l=0;l<Ce.height/Ce.scanlineBlockSize;l++){const v=xe(wr,pr);Ce.size=xe(wr,pr),Ce.lines=v+Ce.scanlineBlockSize>Ce.height?Ce.height-v:Ce.scanlineBlockSize;const F=Ce.size<Ce.lines*Ce.bytesPerLine?Ce.uncompress(Ce):fe(Ce);pr.value+=Ce.size;for(let N=0;N<Ce.scanlineBlockSize;N++){const z=N+l*Ce.scanlineBlockSize;if(z>=Ce.height)break;for(let ee=0;ee<Ce.channels;ee++){const Q=Rr[br.channels[ee].name];for(let te=0;te<Ce.width;te++){fr.value=(N*(Ce.channels*Ce.width)+ee*Ce.width+te)*Ce.inputSize;const ne=(Ce.height-1-z)*(Ce.width*Ce.outputChannels)+te*Ce.outputChannels+Q;Ce.byteArray[ne]=Ce.getter(F,fr)}}}}return{header:br,width:Ce.width,height:Ce.height,data:Ce.byteArray,format:Ce.format,[lt?"colorSpace":"encoding"]:Ce[lt?"colorSpace":"encoding"],type:this.type}}setDataType(t){return this.type=t,this}load(t,c,f,r){function e(a,i){lt?a.colorSpace=i.colorSpace:a.encoding=i.encoding,a.minFilter=Mr,a.magFilter=Mr,a.generateMipmaps=!1,a.flipY=!1,c&&c(a,i)}return super.load(t,e,f,r)}}function Mo(){var u=Object.create(null);function t(r,e){var a=r.id,i=r.name,n=r.dependencies;n===void 0&&(n=[]);var o=r.init;o===void 0&&(o=function(){});var s=r.getTransferables;if(s===void 0&&(s=null),!u[a])try{n=n.map(function(d){return d&&d.isWorkerModule&&(t(d,function(p){if(p instanceof Error)throw p}),d=u[d.id].value),d}),o=f("<"+i+">.init",o),s&&(s=f("<"+i+">.getTransferables",s));var h=null;typeof o=="function"?h=o.apply(void 0,n):console.error("worker module init function failed to rehydrate"),u[a]={id:a,value:h,getTransferables:s},e(h)}catch(d){d&&d.noLog||console.error(d),e(d)}}function c(r,e){var a,i=r.id,n=r.args;(!u[i]||typeof u[i].value!="function")&&e(new Error("Worker module "+i+": not found or its 'init' did not return a function"));try{var o=(a=u[i]).value.apply(a,n);o&&typeof o.then=="function"?o.then(s,function(h){return e(h instanceof Error?h:new Error(""+h))}):s(o)}catch(h){e(h)}function s(h){try{var d=u[i].getTransferables&&u[i].getTransferables(h);(!d||!Array.isArray(d)||!d.length)&&(d=void 0),e(h,d)}catch(p){console.error(p),e(p)}}}function f(r,e){var a=void 0;self.troikaDefine=function(n){return a=n};var i=URL.createObjectURL(new Blob(["/** "+r.replace(/\*/g,"")+` **/

troikaDefine(
`+e+`
)`],{type:"application/javascript"}));try{importScripts(i)}catch(n){console.error(n)}return URL.revokeObjectURL(i),delete self.troikaDefine,a}self.addEventListener("message",function(r){var e=r.data,a=e.messageId,i=e.action,n=e.data;try{i==="registerModule"&&t(n,function(o){o instanceof Error?postMessage({messageId:a,success:!1,error:o.message}):postMessage({messageId:a,success:!0,result:{isCallable:typeof o=="function"}})}),i==="callModule"&&c(n,function(o,s){o instanceof Error?postMessage({messageId:a,success:!1,error:o.message}):postMessage({messageId:a,success:!0,result:o},s||void 0)})}catch(o){postMessage({messageId:a,success:!1,error:o.stack})}})}function Co(u){var t=function(){for(var c=[],f=arguments.length;f--;)c[f]=arguments[f];return t._getInitResult().then(function(r){if(typeof r=="function")return r.apply(void 0,c);throw new Error("Worker module function was called but `init` did not return a callable function")})};return t._getInitResult=function(){var c=u.dependencies,f=u.init;c=Array.isArray(c)?c.map(function(e){return e&&(e=e.onMainThread||e,e._getInitResult&&(e=e._getInitResult())),e}):[];var r=Promise.all(c).then(function(e){return f.apply(null,e)});return t._getInitResult=function(){return r},r},t}var ca=function(){var u=!1;if(typeof window<"u"&&typeof window.document<"u")try{var t=new Worker(URL.createObjectURL(new Blob([""],{type:"application/javascript"})));t.terminate(),u=!0}catch(c){console.log("Troika createWorkerModule: web workers not allowed; falling back to main thread execution. Cause: ["+c.message+"]")}return ca=function(){return u},u},ko=0,Fo=0,$t=!1,dt=Object.create(null),vt=Object.create(null),sn=Object.create(null);function et(u){if((!u||typeof u.init!="function")&&!$t)throw new Error("requires `options.init` function");var t=u.dependencies,c=u.init,f=u.getTransferables,r=u.workerId,e=Co(u);r==null&&(r="#default");var a="workerModule"+ ++ko,i=u.name||a,n=null;t=t&&t.map(function(s){return typeof s=="function"&&!s.workerModuleData&&($t=!0,s=et({workerId:r,name:"<"+i+"> function dependency: "+s.name,init:`function(){return (
`+At(s)+`
)}`}),$t=!1),s&&s.workerModuleData&&(s=s.workerModuleData),s});function o(){for(var s=[],h=arguments.length;h--;)s[h]=arguments[h];if(!ca())return e.apply(void 0,s);if(!n){n=Bn(r,"registerModule",o.workerModuleData);var d=function(){n=null,vt[r].delete(d)};(vt[r]||(vt[r]=new Set)).add(d)}return n.then(function(p){var m=p.isCallable;if(m)return Bn(r,"callModule",{id:a,args:s});throw new Error("Worker module function was called but `init` did not return a callable function")})}return o.workerModuleData={isWorkerModule:!0,id:a,name:i,dependencies:t,init:At(c),getTransferables:f&&At(f)},o.onMainThread=e,o}function Ao(u){vt[u]&&vt[u].forEach(function(t){t()}),dt[u]&&(dt[u].terminate(),delete dt[u])}function At(u){var t=u.toString();return!/^function/.test(t)&&/^\w+\s*\(/.test(t)&&(t="function "+t),t}function Do(u){var t=dt[u];if(!t){var c=At(Mo);t=dt[u]=new Worker(URL.createObjectURL(new Blob(["/** Worker Module Bootstrap: "+u.replace(/\*/g,"")+` **/

;(`+c+")()"],{type:"application/javascript"}))),t.onmessage=function(f){var r=f.data,e=r.messageId,a=sn[e];if(!a)throw new Error("WorkerModule response with empty or unknown messageId");delete sn[e],a(r)}}return t}function Bn(u,t,c){return new Promise(function(f,r){var e=++Fo;sn[e]=function(a){a.success?f(a.result):r(new Error("Error in worker "+t+" call: "+a.error))},Do(u).postMessage({messageId:e,action:t,data:c})})}function ha(){var u=(function(t){function c(X,L,y,x,R,P,G,V){var j=1-G;V.x=j*j*X+2*j*G*y+G*G*R,V.y=j*j*L+2*j*G*x+G*G*P}function f(X,L,y,x,R,P,G,V,j,Y){var le=1-j;Y.x=le*le*le*X+3*le*le*j*y+3*le*j*j*R+j*j*j*G,Y.y=le*le*le*L+3*le*le*j*x+3*le*j*j*P+j*j*j*V}function r(X,L){for(var y=/([MLQCZ])([^MLQCZ]*)/g,x,R,P,G,V;x=y.exec(X);){var j=x[2].replace(/^\s*|\s*$/g,"").split(/[,\s]+/).map(function(Y){return parseFloat(Y)});switch(x[1]){case"M":G=R=j[0],V=P=j[1];break;case"L":(j[0]!==G||j[1]!==V)&&L("L",G,V,G=j[0],V=j[1]);break;case"Q":{L("Q",G,V,G=j[2],V=j[3],j[0],j[1]);break}case"C":{L("C",G,V,G=j[4],V=j[5],j[0],j[1],j[2],j[3]);break}case"Z":(G!==R||V!==P)&&L("L",G,V,R,P);break}}}function e(X,L,y){y===void 0&&(y=16);var x={x:0,y:0};r(X,function(R,P,G,V,j,Y,le,de,ae){switch(R){case"L":L(P,G,V,j);break;case"Q":{for(var $=P,Fe=G,Te=1;Te<y;Te++)c(P,G,Y,le,V,j,Te/(y-1),x),L($,Fe,x.x,x.y),$=x.x,Fe=x.y;break}case"C":{for(var ce=P,pe=G,Ue=1;Ue<y;Ue++)f(P,G,Y,le,de,ae,V,j,Ue/(y-1),x),L(ce,pe,x.x,x.y),ce=x.x,pe=x.y;break}}})}var a="precision highp float;attribute vec2 aUV;varying vec2 vUV;void main(){vUV=aUV;gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",i="precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){gl_FragColor=texture2D(tex,vUV);}",n=new WeakMap,o={premultipliedAlpha:!1,preserveDrawingBuffer:!0,antialias:!1,depth:!1};function s(X,L){var y=X.getContext?X.getContext("webgl",o):X,x=n.get(y);if(!x){let le=function(ce){var pe=P[ce];if(!pe&&(pe=P[ce]=y.getExtension(ce),!pe))throw new Error(ce+" not supported");return pe},de=function(ce,pe){var Ue=y.createShader(pe);return y.shaderSource(Ue,ce),y.compileShader(Ue),Ue},ae=function(ce,pe,Ue,re){if(!G[ce]){var ge={},he={},J=y.createProgram();y.attachShader(J,de(pe,y.VERTEX_SHADER)),y.attachShader(J,de(Ue,y.FRAGMENT_SHADER)),y.linkProgram(J),G[ce]={program:J,transaction:function(fe){y.useProgram(J),fe({setUniform:function(se,Pe){for(var me=[],ye=arguments.length-2;ye-- >0;)me[ye]=arguments[ye+2];var be=he[Pe]||(he[Pe]=y.getUniformLocation(J,Pe));y["uniform"+se].apply(y,[be].concat(me))},setAttribute:function(se,Pe,me,ye,be){var Ae=ge[se];Ae||(Ae=ge[se]={buf:y.createBuffer(),loc:y.getAttribLocation(J,se),data:null}),y.bindBuffer(y.ARRAY_BUFFER,Ae.buf),y.vertexAttribPointer(Ae.loc,Pe,y.FLOAT,!1,0,0),y.enableVertexAttribArray(Ae.loc),R?y.vertexAttribDivisor(Ae.loc,ye):le("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(Ae.loc,ye),be!==Ae.data&&(y.bufferData(y.ARRAY_BUFFER,be,me),Ae.data=be)}})}}}G[ce].transaction(re)},$=function(ce,pe){j++;try{y.activeTexture(y.TEXTURE0+j);var Ue=V[ce];Ue||(Ue=V[ce]=y.createTexture(),y.bindTexture(y.TEXTURE_2D,Ue),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MIN_FILTER,y.NEAREST),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MAG_FILTER,y.NEAREST)),y.bindTexture(y.TEXTURE_2D,Ue),pe(Ue,j)}finally{j--}},Fe=function(ce,pe,Ue){var re=y.createFramebuffer();Y.push(re),y.bindFramebuffer(y.FRAMEBUFFER,re),y.activeTexture(y.TEXTURE0+pe),y.bindTexture(y.TEXTURE_2D,ce),y.framebufferTexture2D(y.FRAMEBUFFER,y.COLOR_ATTACHMENT0,y.TEXTURE_2D,ce,0);try{Ue(re)}finally{y.deleteFramebuffer(re),y.bindFramebuffer(y.FRAMEBUFFER,Y[--Y.length-1]||null)}},Te=function(){P={},G={},V={},j=-1,Y.length=0};var R=typeof WebGL2RenderingContext<"u"&&y instanceof WebGL2RenderingContext,P={},G={},V={},j=-1,Y=[];y.canvas.addEventListener("webglcontextlost",function(ce){Te(),ce.preventDefault()},!1),n.set(y,x={gl:y,isWebGL2:R,getExtension:le,withProgram:ae,withTexture:$,withTextureFramebuffer:Fe,handleContextLoss:Te})}L(x)}function h(X,L,y,x,R,P,G,V){G===void 0&&(G=15),V===void 0&&(V=null),s(X,function(j){var Y=j.gl,le=j.withProgram,de=j.withTexture;de("copy",function(ae,$){Y.texImage2D(Y.TEXTURE_2D,0,Y.RGBA,R,P,0,Y.RGBA,Y.UNSIGNED_BYTE,L),le("copy",a,i,function(Fe){var Te=Fe.setUniform,ce=Fe.setAttribute;ce("aUV",2,Y.STATIC_DRAW,0,new Float32Array([0,0,2,0,0,2])),Te("1i","image",$),Y.bindFramebuffer(Y.FRAMEBUFFER,V||null),Y.disable(Y.BLEND),Y.colorMask(G&8,G&4,G&2,G&1),Y.viewport(y,x,R,P),Y.scissor(y,x,R,P),Y.drawArrays(Y.TRIANGLES,0,3)})})})}function d(X,L,y){var x=X.width,R=X.height;s(X,function(P){var G=P.gl,V=new Uint8Array(x*R*4);G.readPixels(0,0,x,R,G.RGBA,G.UNSIGNED_BYTE,V),X.width=L,X.height=y,h(G,V,0,0,x,R)})}var p=Object.freeze({__proto__:null,withWebGLContext:s,renderImageData:h,resizeWebGLCanvasWithoutClearing:d});function m(X,L,y,x,R,P){P===void 0&&(P=1);var G=new Uint8Array(X*L),V=x[2]-x[0],j=x[3]-x[1],Y=[];e(y,function(ce,pe,Ue,re){Y.push({x1:ce,y1:pe,x2:Ue,y2:re,minX:Math.min(ce,Ue),minY:Math.min(pe,re),maxX:Math.max(ce,Ue),maxY:Math.max(pe,re)})}),Y.sort(function(ce,pe){return ce.maxX-pe.maxX});for(var le=0;le<X;le++)for(var de=0;de<L;de++){var ae=Fe(x[0]+V*(le+.5)/X,x[1]+j*(de+.5)/L),$=Math.pow(1-Math.abs(ae)/R,P)/2;ae<0&&($=1-$),$=Math.max(0,Math.min(255,Math.round($*255))),G[de*X+le]=$}return G;function Fe(ce,pe){for(var Ue=1/0,re=1/0,ge=Y.length;ge--;){var he=Y[ge];if(he.maxX+re<=ce)break;if(ce+re>he.minX&&pe-re<he.maxY&&pe+re>he.minY){var J=W(ce,pe,he.x1,he.y1,he.x2,he.y2);J<Ue&&(Ue=J,re=Math.sqrt(Ue))}}return Te(ce,pe)&&(re=-re),re}function Te(ce,pe){for(var Ue=0,re=Y.length;re--;){var ge=Y[re];if(ge.maxX<=ce)break;var he=ge.y1>pe!=ge.y2>pe&&ce<(ge.x2-ge.x1)*(pe-ge.y1)/(ge.y2-ge.y1)+ge.x1;he&&(Ue+=ge.y1<ge.y2?1:-1)}return Ue!==0}}function S(X,L,y,x,R,P,G,V,j,Y){P===void 0&&(P=1),V===void 0&&(V=0),j===void 0&&(j=0),Y===void 0&&(Y=0),w(X,L,y,x,R,P,G,null,V,j,Y)}function w(X,L,y,x,R,P,G,V,j,Y,le){P===void 0&&(P=1),j===void 0&&(j=0),Y===void 0&&(Y=0),le===void 0&&(le=0);for(var de=m(X,L,y,x,R,P),ae=new Uint8Array(de.length*4),$=0;$<de.length;$++)ae[$*4+le]=de[$];h(G,ae,j,Y,X,L,1<<3-le,V)}function W(X,L,y,x,R,P){var G=R-y,V=P-x,j=G*G+V*V,Y=j?Math.max(0,Math.min(1,((X-y)*G+(L-x)*V)/j)):0,le=X-(y+Y*G),de=L-(x+Y*V);return le*le+de*de}var k=Object.freeze({__proto__:null,generate:m,generateIntoCanvas:S,generateIntoFramebuffer:w}),I="precision highp float;uniform vec4 uGlyphBounds;attribute vec2 aUV;attribute vec4 aLineSegment;varying vec4 vLineSegment;varying vec2 vGlyphXY;void main(){vLineSegment=aLineSegment;vGlyphXY=mix(uGlyphBounds.xy,uGlyphBounds.zw,aUV);gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",E="precision highp float;uniform vec4 uGlyphBounds;uniform float uMaxDistance;uniform float uExponent;varying vec4 vLineSegment;varying vec2 vGlyphXY;float absDistToSegment(vec2 point,vec2 lineA,vec2 lineB){vec2 lineDir=lineB-lineA;float lenSq=dot(lineDir,lineDir);float t=lenSq==0.0 ? 0.0 : clamp(dot(point-lineA,lineDir)/lenSq,0.0,1.0);vec2 linePt=lineA+t*lineDir;return distance(point,linePt);}void main(){vec4 seg=vLineSegment;vec2 p=vGlyphXY;float dist=absDistToSegment(p,seg.xy,seg.zw);float val=pow(1.0-clamp(dist/uMaxDistance,0.0,1.0),uExponent)*0.5;bool crossing=(seg.y>p.y!=seg.w>p.y)&&(p.x<(seg.z-seg.x)*(p.y-seg.y)/(seg.w-seg.y)+seg.x);bool crossingUp=crossing&&vLineSegment.y<vLineSegment.w;gl_FragColor=vec4(crossingUp ? 1.0/255.0 : 0.0,crossing&&!crossingUp ? 1.0/255.0 : 0.0,0.0,val);}",C="precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){vec4 color=texture2D(tex,vUV);bool inside=color.r!=color.g;float val=inside ? 1.0-color.a : color.a;gl_FragColor=vec4(val);}",A=new Float32Array([0,0,2,0,0,2]),M=null,_=!1,T={},O=new WeakMap;function q(X){if(!_&&!K(X))throw new Error("WebGL generation not supported")}function b(X,L,y,x,R,P,G){if(P===void 0&&(P=1),G===void 0&&(G=null),!G&&(G=M,!G)){var V=typeof OffscreenCanvas=="function"?new OffscreenCanvas(1,1):typeof document<"u"?document.createElement("canvas"):null;if(!V)throw new Error("OffscreenCanvas or DOM canvas not supported");G=M=V.getContext("webgl",{depth:!1})}q(G);var j=new Uint8Array(X*L*4);s(G,function(ae){var $=ae.gl,Fe=ae.withTexture,Te=ae.withTextureFramebuffer;Fe("readable",function(ce,pe){$.texImage2D($.TEXTURE_2D,0,$.RGBA,X,L,0,$.RGBA,$.UNSIGNED_BYTE,null),Te(ce,pe,function(Ue){U(X,L,y,x,R,P,$,Ue,0,0,0),$.readPixels(0,0,X,L,$.RGBA,$.UNSIGNED_BYTE,j)})})});for(var Y=new Uint8Array(X*L),le=0,de=0;le<j.length;le+=4)Y[de++]=j[le];return Y}function D(X,L,y,x,R,P,G,V,j,Y){P===void 0&&(P=1),V===void 0&&(V=0),j===void 0&&(j=0),Y===void 0&&(Y=0),U(X,L,y,x,R,P,G,null,V,j,Y)}function U(X,L,y,x,R,P,G,V,j,Y,le){P===void 0&&(P=1),j===void 0&&(j=0),Y===void 0&&(Y=0),le===void 0&&(le=0),q(G);var de=[];e(y,function(ae,$,Fe,Te){de.push(ae,$,Fe,Te)}),de=new Float32Array(de),s(G,function(ae){var $=ae.gl,Fe=ae.isWebGL2,Te=ae.getExtension,ce=ae.withProgram,pe=ae.withTexture,Ue=ae.withTextureFramebuffer,re=ae.handleContextLoss;if(pe("rawDistances",function(ge,he){(X!==ge._lastWidth||L!==ge._lastHeight)&&$.texImage2D($.TEXTURE_2D,0,$.RGBA,ge._lastWidth=X,ge._lastHeight=L,0,$.RGBA,$.UNSIGNED_BYTE,null),ce("main",I,E,function(J){var ke=J.setAttribute,fe=J.setUniform,we=!Fe&&Te("ANGLE_instanced_arrays"),se=!Fe&&Te("EXT_blend_minmax");ke("aUV",2,$.STATIC_DRAW,0,A),ke("aLineSegment",4,$.DYNAMIC_DRAW,1,de),fe.apply(void 0,["4f","uGlyphBounds"].concat(x)),fe("1f","uMaxDistance",R),fe("1f","uExponent",P),Ue(ge,he,function(Pe){$.enable($.BLEND),$.colorMask(!0,!0,!0,!0),$.viewport(0,0,X,L),$.scissor(0,0,X,L),$.blendFunc($.ONE,$.ONE),$.blendEquationSeparate($.FUNC_ADD,Fe?$.MAX:se.MAX_EXT),$.clear($.COLOR_BUFFER_BIT),Fe?$.drawArraysInstanced($.TRIANGLES,0,3,de.length/4):we.drawArraysInstancedANGLE($.TRIANGLES,0,3,de.length/4)})}),ce("post",a,C,function(J){J.setAttribute("aUV",2,$.STATIC_DRAW,0,A),J.setUniform("1i","tex",he),$.bindFramebuffer($.FRAMEBUFFER,V),$.disable($.BLEND),$.colorMask(le===0,le===1,le===2,le===3),$.viewport(j,Y,X,L),$.scissor(j,Y,X,L),$.drawArrays($.TRIANGLES,0,3)})}),$.isContextLost())throw re(),new Error("webgl context lost")})}function K(X){var L=!X||X===M?T:X.canvas||X,y=O.get(L);if(y===void 0){_=!0;var x=null;try{var R=[97,106,97,61,99,137,118,80,80,118,137,99,61,97,106,97],P=b(4,4,"M8,8L16,8L24,24L16,24Z",[0,0,32,32],24,1,X);y=P&&R.length===P.length&&P.every(function(G,V){return G===R[V]}),y||(x="bad trial run results",console.info(R,P))}catch(G){y=!1,x=G.message}x&&console.warn("WebGL SDF generation not supported:",x),_=!1,O.set(L,y)}return y}var H=Object.freeze({__proto__:null,generate:b,generateIntoCanvas:D,generateIntoFramebuffer:U,isSupported:K});function ie(X,L,y,x,R,P){R===void 0&&(R=Math.max(x[2]-x[0],x[3]-x[1])/2),P===void 0&&(P=1);try{return b.apply(H,arguments)}catch(G){return console.info("WebGL SDF generation failed, falling back to JS",G),m.apply(k,arguments)}}function ue(X,L,y,x,R,P,G,V,j,Y){R===void 0&&(R=Math.max(x[2]-x[0],x[3]-x[1])/2),P===void 0&&(P=1),V===void 0&&(V=0),j===void 0&&(j=0),Y===void 0&&(Y=0);try{return D.apply(H,arguments)}catch(le){return console.info("WebGL SDF generation failed, falling back to JS",le),S.apply(k,arguments)}}return t.forEachPathCommand=r,t.generate=ie,t.generateIntoCanvas=ue,t.javascript=k,t.pathToLineSegments=e,t.webgl=H,t.webglUtils=p,Object.defineProperty(t,"__esModule",{value:!0}),t})({});return u}function Io(){var u=(function(t){var c={R:"13k,1a,2,3,3,2+1j,ch+16,a+1,5+2,2+n,5,a,4,6+16,4+3,h+1b,4mo,179q,2+9,2+11,2i9+7y,2+68,4,3+4,5+13,4+3,2+4k,3+29,8+cf,1t+7z,w+17,3+3m,1t+3z,16o1+5r,8+30,8+mc,29+1r,29+4v,75+73",EN:"1c+9,3d+1,6,187+9,513,4+5,7+9,sf+j,175h+9,qw+q,161f+1d,4xt+a,25i+9",ES:"17,2,6dp+1,f+1,av,16vr,mx+1,4o,2",ET:"z+2,3h+3,b+1,ym,3e+1,2o,p4+1,8,6u,7c,g6,1wc,1n9+4,30+1b,2n,6d,qhx+1,h0m,a+1,49+2,63+1,4+1,6bb+3,12jj",AN:"16o+5,2j+9,2+1,35,ed,1ff2+9,87+u",CS:"18,2+1,b,2u,12k,55v,l,17v0,2,3,53,2+1,b",B:"a,3,f+2,2v,690",S:"9,2,k",WS:"c,k,4f4,1vk+a,u,1j,335",ON:"x+1,4+4,h+5,r+5,r+3,z,5+3,2+1,2+1,5,2+2,3+4,o,w,ci+1,8+d,3+d,6+8,2+g,39+1,9,6+1,2,33,b8,3+1,3c+1,7+1,5r,b,7h+3,sa+5,2,3i+6,jg+3,ur+9,2v,ij+1,9g+9,7+a,8m,4+1,49+x,14u,2+2,c+2,e+2,e+2,e+1,i+n,e+e,2+p,u+2,e+2,36+1,2+3,2+1,b,2+2,6+5,2,2,2,h+1,5+4,6+3,3+f,16+2,5+3l,3+81,1y+p,2+40,q+a,m+13,2r+ch,2+9e,75+hf,3+v,2+2w,6e+5,f+6,75+2a,1a+p,2+2g,d+5x,r+b,6+3,4+o,g,6+1,6+2,2k+1,4,2j,5h+z,1m+1,1e+f,t+2,1f+e,d+3,4o+3,2s+1,w,535+1r,h3l+1i,93+2,2s,b+1,3l+x,2v,4g+3,21+3,kz+1,g5v+1,5a,j+9,n+v,2,3,2+8,2+1,3+2,2,3,46+1,4+4,h+5,r+5,r+a,3h+2,4+6,b+4,78,1r+24,4+c,4,1hb,ey+6,103+j,16j+c,1ux+7,5+g,fsh,jdq+1t,4,57+2e,p1,1m,1m,1m,1m,4kt+1,7j+17,5+2r,d+e,3+e,2+e,2+10,m+4,w,1n+5,1q,4z+5,4b+rb,9+c,4+c,4+37,d+2g,8+b,l+b,5+1j,9+9,7+13,9+t,3+1,27+3c,2+29,2+3q,d+d,3+4,4+2,6+6,a+o,8+6,a+2,e+6,16+42,2+1i",BN:"0+8,6+d,2s+5,2+p,e,4m9,1kt+2,2b+5,5+5,17q9+v,7k,6p+8,6+1,119d+3,440+7,96s+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+75,6p+2rz,1ben+1,1ekf+1,1ekf+1",NSM:"lc+33,7o+6,7c+18,2,2+1,2+1,2,21+a,1d+k,h,2u+6,3+5,3+1,2+3,10,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,g+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+g,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,k1+w,2db+2,3y,2p+v,ff+3,30+1,n9x+3,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,r2,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+5,3+1,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2d+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,f0c+4,1o+6,t5,1s+3,2a,f5l+1,43t+2,i+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,gzhy+6n",AL:"16w,3,2,e+1b,z+2,2+2s,g+1,8+1,b+m,2+t,s+2i,c+e,4h+f,1d+1e,1bwe+dp,3+3z,x+c,2+1,35+3y,2rm+z,5+7,b+5,dt+l,c+u,17nl+27,1t+27,4x+6n,3+d",LRO:"6ct",RLO:"6cu",LRE:"6cq",RLE:"6cr",PDF:"6cs",LRI:"6ee",RLI:"6ef",FSI:"6eg",PDI:"6eh"},f={},r={};f.L=1,r[1]="L",Object.keys(c).forEach(function(re,ge){f[re]=1<<ge+1,r[f[re]]=re}),Object.freeze(f);var e=f.LRI|f.RLI|f.FSI,a=f.L|f.R|f.AL,i=f.B|f.S|f.WS|f.ON|f.FSI|f.LRI|f.RLI|f.PDI,n=f.BN|f.RLE|f.LRE|f.RLO|f.LRO|f.PDF,o=f.S|f.WS|f.B|e|f.PDI|n,s=null;function h(){if(!s){s=new Map;var re=function(he){if(c.hasOwnProperty(he)){var J=0;c[he].split(",").forEach(function(ke){var fe=ke.split("+"),we=fe[0],se=fe[1];we=parseInt(we,36),se=se?parseInt(se,36):0,s.set(J+=we,f[he]);for(var Pe=0;Pe<se;Pe++)s.set(++J,f[he])})}};for(var ge in c)re(ge)}}function d(re){return h(),s.get(re.codePointAt(0))||f.L}function p(re){return r[d(re)]}var m={pairs:"14>1,1e>2,u>2,2wt>1,1>1,1ge>1,1wp>1,1j>1,f>1,hm>1,1>1,u>1,u6>1,1>1,+5,28>1,w>1,1>1,+3,b8>1,1>1,+3,1>3,-1>-1,3>1,1>1,+2,1s>1,1>1,x>1,th>1,1>1,+2,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,4q>1,1e>2,u>2,2>1,+1",canonical:"6f1>-6dx,6dy>-6dx,6ec>-6ed,6ee>-6ed,6ww>2jj,-2ji>2jj,14r4>-1e7l,1e7m>-1e7l,1e7m>-1e5c,1e5d>-1e5b,1e5c>-14qx,14qy>-14qx,14vn>-1ecg,1ech>-1ecg,1edu>-1ecg,1eci>-1ecg,1eda>-1ecg,1eci>-1ecg,1eci>-168q,168r>-168q,168s>-14ye,14yf>-14ye"};function S(re,ge){var he=36,J=0,ke=new Map,fe=ge&&new Map,we;return re.split(",").forEach(function se(Pe){if(Pe.indexOf("+")!==-1)for(var me=+Pe;me--;)se(we);else{we=Pe;var ye=Pe.split(">"),be=ye[0],Ae=ye[1];be=String.fromCodePoint(J+=parseInt(be,he)),Ae=String.fromCodePoint(J+=parseInt(Ae,he)),ke.set(be,Ae),ge&&fe.set(Ae,be)}}),{map:ke,reverseMap:fe}}var w,W,k;function I(){if(!w){var re=S(m.pairs,!0),ge=re.map,he=re.reverseMap;w=ge,W=he,k=S(m.canonical,!1).map}}function E(re){return I(),w.get(re)||null}function C(re){return I(),W.get(re)||null}function A(re){return I(),k.get(re)||null}var M=f.L,_=f.R,T=f.EN,O=f.ES,q=f.ET,b=f.AN,D=f.CS,U=f.B,K=f.S,H=f.ON,ie=f.BN,ue=f.NSM,X=f.AL,L=f.LRO,y=f.RLO,x=f.LRE,R=f.RLE,P=f.PDF,G=f.LRI,V=f.RLI,j=f.FSI,Y=f.PDI;function le(re,ge){for(var he=125,J=new Uint32Array(re.length),ke=0;ke<re.length;ke++)J[ke]=d(re[ke]);var fe=new Map;function we(mr,Ar){var yr=J[mr];J[mr]=Ar,fe.set(yr,fe.get(yr)-1),yr&i&&fe.set(i,fe.get(i)-1),fe.set(Ar,(fe.get(Ar)||0)+1),Ar&i&&fe.set(i,(fe.get(i)||0)+1)}for(var se=new Uint8Array(re.length),Pe=new Map,me=[],ye=null,be=0;be<re.length;be++)ye||me.push(ye={start:be,end:re.length-1,level:ge==="rtl"?1:ge==="ltr"?0:An(be,!1)}),J[be]&U&&(ye.end=be,ye=null);for(var Ae=R|x|y|L|e|Y|P|U,Ke=function(mr){return mr+(mr&1?1:2)},er=function(mr){return mr+(mr&1?2:1)},De=0;De<me.length;De++){ye=me[De];var xe=[{_level:ye.level,_override:0,_isolate:0}],Se=void 0,Xe=0,Le=0,Ne=0;fe.clear();for(var Je=ye.start;Je<=ye.end;Je++){var Z=J[Je];if(Se=xe[xe.length-1],fe.set(Z,(fe.get(Z)||0)+1),Z&i&&fe.set(i,(fe.get(i)||0)+1),Z&Ae)if(Z&(R|x)){se[Je]=Se._level;var Ge=(Z===R?er:Ke)(Se._level);Ge<=he&&!Xe&&!Le?xe.push({_level:Ge,_override:0,_isolate:0}):Xe||Le++}else if(Z&(y|L)){se[Je]=Se._level;var Ir=(Z===y?er:Ke)(Se._level);Ir<=he&&!Xe&&!Le?xe.push({_level:Ir,_override:Z&y?_:M,_isolate:0}):Xe||Le++}else if(Z&e){Z&j&&(Z=An(Je+1,!0)===1?V:G),se[Je]=Se._level,Se._override&&we(Je,Se._override);var je=(Z===V?er:Ke)(Se._level);je<=he&&Xe===0&&Le===0?(Ne++,xe.push({_level:je,_override:0,_isolate:1,_isolInitIndex:Je})):Xe++}else if(Z&Y){if(Xe>0)Xe--;else if(Ne>0){for(Le=0;!xe[xe.length-1]._isolate;)xe.pop();var Be=xe[xe.length-1]._isolInitIndex;Be!=null&&(Pe.set(Be,Je),Pe.set(Je,Be)),xe.pop(),Ne--}Se=xe[xe.length-1],se[Je]=Se._level,Se._override&&we(Je,Se._override)}else Z&P?(Xe===0&&(Le>0?Le--:!Se._isolate&&xe.length>1&&(xe.pop(),Se=xe[xe.length-1])),se[Je]=Se._level):Z&U&&(se[Je]=ye.level);else se[Je]=Se._level,Se._override&&Z!==ie&&we(Je,Se._override)}for(var nr=[],qe=null,Ie=ye.start;Ie<=ye.end;Ie++){var $e=J[Ie];if(!($e&n)){var hr=se[Ie],ur=$e&e,ar=$e===Y;qe&&hr===qe._level?(qe._end=Ie,qe._endsWithIsolInit=ur):nr.push(qe={_start:Ie,_end:Ie,_level:hr,_startsWithPDI:ar,_endsWithIsolInit:ur})}}for(var _r=[],wr=0;wr<nr.length;wr++){var Cr=nr[wr];if(!Cr._startsWithPDI||Cr._startsWithPDI&&!Pe.has(Cr._start)){for(var pr=[qe=Cr],br=void 0;qe&&qe._endsWithIsolInit&&(br=Pe.get(qe._end))!=null;)for(var Ce=wr+1;Ce<nr.length;Ce++)if(nr[Ce]._start===br){pr.push(qe=nr[Ce]);break}for(var fr=[],Rr=0;Rr<pr.length;Rr++)for(var l=pr[Rr],v=l._start;v<=l._end;v++)fr.push(v);for(var g=se[fr[0]],F=ye.level,N=fr[0]-1;N>=0;N--)if(!(J[N]&n)){F=se[N];break}var z=fr[fr.length-1],ee=se[z],Q=ye.level;if(!(J[z]&e)){for(var te=z+1;te<=ye.end;te++)if(!(J[te]&n)){Q=se[te];break}}_r.push({_seqIndices:fr,_sosType:Math.max(F,g)%2?_:M,_eosType:Math.max(Q,ee)%2?_:M})}}for(var ne=0;ne<_r.length;ne++){var oe=_r[ne],B=oe._seqIndices,Ze=oe._sosType,_e=oe._eosType,ve=se[B[0]]&1?_:M;if(fe.get(ue))for(var Me=0;Me<B.length;Me++){var Re=B[Me];if(J[Re]&ue){for(var ze=Ze,We=Me-1;We>=0;We--)if(!(J[B[We]]&n)){ze=J[B[We]];break}we(Re,ze&(e|Y)?H:ze)}}if(fe.get(T))for(var tr=0;tr<B.length;tr++){var cr=B[tr];if(J[cr]&T)for(var He=tr-1;He>=-1;He--){var Sr=He===-1?Ze:J[B[He]];if(Sr&a){Sr===X&&we(cr,b);break}}}if(fe.get(X))for(var Ye=0;Ye<B.length;Ye++){var or=B[Ye];J[or]&X&&we(or,_)}if(fe.get(O)||fe.get(D))for(var vr=1;vr<B.length-1;vr++){var Or=B[vr];if(J[Or]&(O|D)){for(var sr=0,Ve=0,ir=vr-1;ir>=0&&(sr=J[B[ir]],!!(sr&n));ir--);for(var Qe=vr+1;Qe<B.length&&(Ve=J[B[Qe]],!!(Ve&n));Qe++);sr===Ve&&(J[Or]===O?sr===T:sr&(T|b))&&we(Or,sr)}}if(fe.get(T))for(var Oe=0;Oe<B.length;Oe++){var gr=B[Oe];if(J[gr]&T){for(var xr=Oe-1;xr>=0&&J[B[xr]]&(q|n);xr--)we(B[xr],T);for(Oe++;Oe<B.length&&J[B[Oe]]&(q|n|T);Oe++)J[B[Oe]]!==T&&we(B[Oe],T)}}if(fe.get(q)||fe.get(O)||fe.get(D))for(var lr=0;lr<B.length;lr++){var kr=B[lr];if(J[kr]&(q|O|D)){we(kr,H);for(var wt=lr-1;wt>=0&&J[B[wt]]&n;wt--)we(B[wt],H);for(var bt=lr+1;bt<B.length&&J[B[bt]]&n;bt++)we(B[bt],H)}}if(fe.get(T))for(var zt=0,_n=Ze;zt<B.length;zt++){var wn=B[zt],Wt=J[wn];Wt&T?_n===M&&we(wn,M):Wt&a&&(_n=Wt)}if(fe.get(i)){var rt=_|T|b,bn=rt|M,St=[];{for(var Yr=[],Kr=0;Kr<B.length;Kr++)if(J[B[Kr]]&i){var tt=re[B[Kr]],Sn=void 0;if(E(tt)!==null)if(Yr.length<63)Yr.push({char:tt,seqIndex:Kr});else break;else if((Sn=C(tt))!==null)for(var nt=Yr.length-1;nt>=0;nt--){var Ht=Yr[nt].char;if(Ht===Sn||Ht===C(A(tt))||E(A(Ht))===tt){St.push([Yr[nt].seqIndex,Kr]),Yr.length=nt;break}}}St.sort(function(mr,Ar){return mr[0]-Ar[0]})}for(var Vt=0;Vt<St.length;Vt++){for(var Un=St[Vt],Ut=Un[0],jt=Un[1],xn=!1,Fr=0,Xt=Ut+1;Xt<jt;Xt++){var Tn=B[Xt];if(J[Tn]&bn){xn=!0;var En=J[Tn]&rt?_:M;if(En===ve){Fr=En;break}}}if(xn&&!Fr){Fr=Ze;for(var Zt=Ut-1;Zt>=0;Zt--){var Mn=B[Zt];if(J[Mn]&bn){var Cn=J[Mn]&rt?_:M;Cn!==ve?Fr=Cn:Fr=ve;break}}}if(Fr){if(J[B[Ut]]=J[B[jt]]=Fr,Fr!==ve){for(var at=Ut+1;at<B.length;at++)if(!(J[B[at]]&n)){d(re[B[at]])&ue&&(J[B[at]]=Fr);break}}if(Fr!==ve){for(var ot=jt+1;ot<B.length;ot++)if(!(J[B[ot]]&n)){d(re[B[ot]])&ue&&(J[B[ot]]=Fr);break}}}}for(var Lr=0;Lr<B.length;Lr++)if(J[B[Lr]]&i){for(var kn=Lr,Yt=Lr,Kt=Ze,it=Lr-1;it>=0;it--)if(J[B[it]]&n)kn=it;else{Kt=J[B[it]]&rt?_:M;break}for(var Fn=_e,st=Lr+1;st<B.length;st++)if(J[B[st]]&(i|n))Yt=st;else{Fn=J[B[st]]&rt?_:M;break}for(var Jt=kn;Jt<=Yt;Jt++)J[B[Jt]]=Kt===Fn?Kt:ve;Lr=Yt}}}for(var Ur=ye.start;Ur<=ye.end;Ur++){var ka=se[Ur],xt=J[Ur];if(ka&1?xt&(M|T|b)&&se[Ur]++:xt&_?se[Ur]++:xt&(b|T)&&(se[Ur]+=2),xt&n&&(se[Ur]=Ur===0?ye.level:se[Ur-1]),Ur===ye.end||d(re[Ur])&(K|U))for(var Tt=Ur;Tt>=0&&d(re[Tt])&o;Tt--)se[Tt]=ye.level}}return{levels:se,paragraphs:me};function An(mr,Ar){for(var yr=mr;yr<re.length;yr++){var Gr=J[yr];if(Gr&(_|X))return 1;if(Gr&(U|M)||Ar&&Gr===Y)return 0;if(Gr&e){var Dn=Fa(yr);yr=Dn===-1?re.length:Dn}}return 0}function Fa(mr){for(var Ar=1,yr=mr+1;yr<re.length;yr++){var Gr=J[yr];if(Gr&U)break;if(Gr&Y){if(--Ar===0)return yr}else Gr&e&&Ar++}return-1}}var de="14>1,j>2,t>2,u>2,1a>g,2v3>1,1>1,1ge>1,1wd>1,b>1,1j>1,f>1,ai>3,-2>3,+1,8>1k0,-1jq>1y7,-1y6>1hf,-1he>1h6,-1h5>1ha,-1h8>1qi,-1pu>1,6>3u,-3s>7,6>1,1>1,f>1,1>1,+2,3>1,1>1,+13,4>1,1>1,6>1eo,-1ee>1,3>1mg,-1me>1mk,-1mj>1mi,-1mg>1mi,-1md>1,1>1,+2,1>10k,-103>1,1>1,4>1,5>1,1>1,+10,3>1,1>8,-7>8,+1,-6>7,+1,a>1,1>1,u>1,u6>1,1>1,+5,26>1,1>1,2>1,2>2,8>1,7>1,4>1,1>1,+5,b8>1,1>1,+3,1>3,-2>1,2>1,1>1,+2,c>1,3>1,1>1,+2,h>1,3>1,a>1,1>1,2>1,3>1,1>1,d>1,f>1,3>1,1a>1,1>1,6>1,7>1,13>1,k>1,1>1,+19,4>1,1>1,+2,2>1,1>1,+18,m>1,a>1,1>1,lk>1,1>1,4>1,2>1,f>1,3>1,1>1,+3,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,6>1,4j>1,j>2,t>2,u>2,2>1,+1",ae;function $(){if(!ae){var re=S(de,!0),ge=re.map,he=re.reverseMap;he.forEach(function(J,ke){ge.set(ke,J)}),ae=ge}}function Fe(re){return $(),ae.get(re)||null}function Te(re,ge,he,J){var ke=re.length;he=Math.max(0,he==null?0:+he),J=Math.min(ke-1,J==null?ke-1:+J);for(var fe=new Map,we=he;we<=J;we++)if(ge[we]&1){var se=Fe(re[we]);se!==null&&fe.set(we,se)}return fe}function ce(re,ge,he,J){var ke=re.length;he=Math.max(0,he==null?0:+he),J=Math.min(ke-1,J==null?ke-1:+J);var fe=[];return ge.paragraphs.forEach(function(we){var se=Math.max(he,we.start),Pe=Math.min(J,we.end);if(se<Pe){for(var me=ge.levels.slice(se,Pe+1),ye=Pe;ye>=se&&d(re[ye])&o;ye--)me[ye]=we.level;for(var be=we.level,Ae=1/0,Ke=0;Ke<me.length;Ke++){var er=me[Ke];er>be&&(be=er),er<Ae&&(Ae=er|1)}for(var De=be;De>=Ae;De--)for(var xe=0;xe<me.length;xe++)if(me[xe]>=De){for(var Se=xe;xe+1<me.length&&me[xe+1]>=De;)xe++;xe>Se&&fe.push([Se+se,xe+se])}}}),fe}function pe(re,ge,he,J){var ke=Ue(re,ge,he,J),fe=[].concat(re);return ke.forEach(function(we,se){fe[se]=(ge.levels[we]&1?Fe(re[we]):null)||re[we]}),fe.join("")}function Ue(re,ge,he,J){for(var ke=ce(re,ge,he,J),fe=[],we=0;we<re.length;we++)fe[we]=we;return ke.forEach(function(se){for(var Pe=se[0],me=se[1],ye=fe.slice(Pe,me+1),be=ye.length;be--;)fe[me-be]=ye[be]}),fe}return t.closingToOpeningBracket=C,t.getBidiCharType=d,t.getBidiCharTypeName=p,t.getCanonicalBracket=A,t.getEmbeddingLevels=le,t.getMirroredCharacter=Fe,t.getMirroredCharactersMap=Te,t.getReorderSegments=ce,t.getReorderedIndices=Ue,t.getReorderedString=pe,t.openingToClosingBracket=E,Object.defineProperty(t,"__esModule",{value:!0}),t})({});return u}const da=/\bvoid\s+main\s*\(\s*\)\s*{/g;function ln(u){const t=/^[ \t]*#include +<([\w\d./]+)>/gm;function c(f,r){let e=Na[r];return e?ln(e):f}return u.replace(t,c)}const dr=[];for(let u=0;u<256;u++)dr[u]=(u<16?"0":"")+u.toString(16);function Ro(){const u=Math.random()*4294967295|0,t=Math.random()*4294967295|0,c=Math.random()*4294967295|0,f=Math.random()*4294967295|0;return(dr[u&255]+dr[u>>8&255]+dr[u>>16&255]+dr[u>>24&255]+"-"+dr[t&255]+dr[t>>8&255]+"-"+dr[t>>16&15|64]+dr[t>>24&255]+"-"+dr[c&63|128]+dr[c>>8&255]+"-"+dr[c>>16&255]+dr[c>>24&255]+dr[f&255]+dr[f>>8&255]+dr[f>>16&255]+dr[f>>24&255]).toUpperCase()}const Vr=Object.assign||function(){let u=arguments[0];for(let t=1,c=arguments.length;t<c;t++){let f=arguments[t];if(f)for(let r in f)Object.prototype.hasOwnProperty.call(f,r)&&(u[r]=f[r])}return u},Oo=Date.now(),Ln=new WeakMap,Gn=new Map;let Bo=1e10;function un(u,t){const c=No(t);let f=Ln.get(u);if(f||Ln.set(u,f=Object.create(null)),f[c])return new f[c];const r=`_onBeforeCompile${c}`,e=function(o,s){u.onBeforeCompile.call(this,o,s);const h=this.customProgramCacheKey()+"|"+o.vertexShader+"|"+o.fragmentShader;let d=Gn[h];if(!d){const p=Lo(this,o,t,c);d=Gn[h]=p}o.vertexShader=d.vertexShader,o.fragmentShader=d.fragmentShader,Vr(o.uniforms,this.uniforms),t.timeUniform&&(o.uniforms[t.timeUniform]={get value(){return Date.now()-Oo}}),this[r]&&this[r](o)},a=function(){return i(t.chained?u:u.clone())},i=function(o){const s=Object.create(o,n);return Object.defineProperty(s,"baseMaterial",{value:u}),Object.defineProperty(s,"id",{value:Bo++}),s.uuid=Ro(),s.uniforms=Vr({},o.uniforms,t.uniforms),s.defines=Vr({},o.defines,t.defines),s.defines[`TROIKA_DERIVED_MATERIAL_${c}`]="",s.extensions=Vr({},o.extensions,t.extensions),s._listeners=void 0,s},n={constructor:{value:a},isDerivedMaterial:{value:!0},type:{get:()=>u.type,set:o=>{u.type=o}},isDerivedFrom:{writable:!0,configurable:!0,value:function(o){const s=this.baseMaterial;return o===s||s.isDerivedMaterial&&s.isDerivedFrom(o)||!1}},customProgramCacheKey:{writable:!0,configurable:!0,value:function(){return u.customProgramCacheKey()+"|"+c}},onBeforeCompile:{get(){return e},set(o){this[r]=o}},copy:{writable:!0,configurable:!0,value:function(o){return u.copy.call(this,o),!u.isShaderMaterial&&!u.isDerivedMaterial&&(Vr(this.extensions,o.extensions),Vr(this.defines,o.defines),Vr(this.uniforms,Pa.clone(o.uniforms))),this}},clone:{writable:!0,configurable:!0,value:function(){const o=new u.constructor;return i(o).copy(this)}},getDepthMaterial:{writable:!0,configurable:!0,value:function(){let o=this._depthMaterial;return o||(o=this._depthMaterial=un(u.isDerivedMaterial?u.getDepthMaterial():new ea({depthPacking:Ga}),t),o.defines.IS_DEPTH_MATERIAL="",o.uniforms=this.uniforms),o}},getDistanceMaterial:{writable:!0,configurable:!0,value:function(){let o=this._distanceMaterial;return o||(o=this._distanceMaterial=un(u.isDerivedMaterial?u.getDistanceMaterial():new La,t),o.defines.IS_DISTANCE_MATERIAL="",o.uniforms=this.uniforms),o}},dispose:{writable:!0,configurable:!0,value(){const{_depthMaterial:o,_distanceMaterial:s}=this;o&&o.dispose(),s&&s.dispose(),u.dispose.call(this)}}};return f[c]=a,new a}function Lo(u,{vertexShader:t,fragmentShader:c},f,r){let{vertexDefs:e,vertexMainIntro:a,vertexMainOutro:i,vertexTransform:n,fragmentDefs:o,fragmentMainIntro:s,fragmentMainOutro:h,fragmentColorTransform:d,customRewriter:p,timeUniform:m}=f;if(e=e||"",a=a||"",i=i||"",o=o||"",s=s||"",h=h||"",(n||p)&&(t=ln(t)),(d||p)&&(c=c.replace(/^[ \t]*#include <((?:tonemapping|encodings|colorspace|fog|premultiplied_alpha|dithering)_fragment)>/gm,`
//!BEGIN_POST_CHUNK $1
$&
//!END_POST_CHUNK
`),c=ln(c)),p){let S=p({vertexShader:t,fragmentShader:c});t=S.vertexShader,c=S.fragmentShader}if(d){let S=[];c=c.replace(/^\/\/!BEGIN_POST_CHUNK[^]+?^\/\/!END_POST_CHUNK/gm,w=>(S.push(w),"")),h=`${d}
${S.join(`
`)}
${h}`}if(m){const S=`
uniform float ${m};
`;e=S+e,o=S+o}return n&&(t=`vec3 troika_position_${r};
vec3 troika_normal_${r};
vec2 troika_uv_${r};
${t}
`,e=`${e}
void troikaVertexTransform${r}(inout vec3 position, inout vec3 normal, inout vec2 uv) {
  ${n}
}
`,a=`
troika_position_${r} = vec3(position);
troika_normal_${r} = vec3(normal);
troika_uv_${r} = vec2(uv);
troikaVertexTransform${r}(troika_position_${r}, troika_normal_${r}, troika_uv_${r});
${a}
`,t=t.replace(/\b(position|normal|uv)\b/g,(S,w,W,k)=>/\battribute\s+vec[23]\s+$/.test(k.substr(0,W))?w:`troika_${w}_${r}`),u.map&&u.map.channel>0||(t=t.replace(/\bMAP_UV\b/g,`troika_uv_${r}`))),t=Pn(t,r,e,a,i),c=Pn(c,r,o,s,h),{vertexShader:t,fragmentShader:c}}function Pn(u,t,c,f,r){return(f||r||c)&&(u=u.replace(da,`
${c}
void troikaOrigMain${t}() {`),u+=`
void main() {
  ${f}
  troikaOrigMain${t}();
  ${r}
}`),u}function Go(u,t){return u==="uniforms"?void 0:typeof t=="function"?t.toString():t}let Po=0;const Nn=new Map;function No(u){const t=JSON.stringify(u,Go);let c=Nn.get(t);return c==null&&Nn.set(t,c=++Po),c}function zo(){return typeof window>"u"&&(self.window=self),(function(u){var t={parse:function(r){var e=t._bin,a=new Uint8Array(r);if(e.readASCII(a,0,4)=="ttcf"){var i=4;e.readUshort(a,i),i+=2,e.readUshort(a,i),i+=2;var n=e.readUint(a,i);i+=4;for(var o=[],s=0;s<n;s++){var h=e.readUint(a,i);i+=4,o.push(t._readFont(a,h))}return o}return[t._readFont(a,0)]},_readFont:function(r,e){var a=t._bin,i=e;a.readFixed(r,e),e+=4;var n=a.readUshort(r,e);e+=2,a.readUshort(r,e),e+=2,a.readUshort(r,e),e+=2,a.readUshort(r,e),e+=2;for(var o=["cmap","head","hhea","maxp","hmtx","name","OS/2","post","loca","glyf","kern","CFF ","GDEF","GPOS","GSUB","SVG "],s={_data:r,_offset:i},h={},d=0;d<n;d++){var p=a.readASCII(r,e,4);e+=4,a.readUint(r,e),e+=4;var m=a.readUint(r,e);e+=4;var S=a.readUint(r,e);e+=4,h[p]={offset:m,length:S}}for(d=0;d<o.length;d++){var w=o[d];h[w]&&(s[w.trim()]=t[w.trim()].parse(r,h[w].offset,h[w].length,s))}return s},_tabOffset:function(r,e,a){for(var i=t._bin,n=i.readUshort(r,a+4),o=a+12,s=0;s<n;s++){var h=i.readASCII(r,o,4);o+=4,i.readUint(r,o),o+=4;var d=i.readUint(r,o);if(o+=4,i.readUint(r,o),o+=4,h==e)return d}return 0}};t._bin={readFixed:function(r,e){return(r[e]<<8|r[e+1])+(r[e+2]<<8|r[e+3])/65540},readF2dot14:function(r,e){return t._bin.readShort(r,e)/16384},readInt:function(r,e){return t._bin._view(r).getInt32(e)},readInt8:function(r,e){return t._bin._view(r).getInt8(e)},readShort:function(r,e){return t._bin._view(r).getInt16(e)},readUshort:function(r,e){return t._bin._view(r).getUint16(e)},readUshorts:function(r,e,a){for(var i=[],n=0;n<a;n++)i.push(t._bin.readUshort(r,e+2*n));return i},readUint:function(r,e){return t._bin._view(r).getUint32(e)},readUint64:function(r,e){return 4294967296*t._bin.readUint(r,e)+t._bin.readUint(r,e+4)},readASCII:function(r,e,a){for(var i="",n=0;n<a;n++)i+=String.fromCharCode(r[e+n]);return i},readUnicode:function(r,e,a){for(var i="",n=0;n<a;n++){var o=r[e++]<<8|r[e++];i+=String.fromCharCode(o)}return i},_tdec:typeof window<"u"&&window.TextDecoder?new window.TextDecoder:null,readUTF8:function(r,e,a){var i=t._bin._tdec;return i&&e==0&&a==r.length?i.decode(r):t._bin.readASCII(r,e,a)},readBytes:function(r,e,a){for(var i=[],n=0;n<a;n++)i.push(r[e+n]);return i},readASCIIArray:function(r,e,a){for(var i=[],n=0;n<a;n++)i.push(String.fromCharCode(r[e+n]));return i},_view:function(r){return r._dataView||(r._dataView=r.buffer?new DataView(r.buffer,r.byteOffset,r.byteLength):new DataView(new Uint8Array(r).buffer))}},t._lctf={},t._lctf.parse=function(r,e,a,i,n){var o=t._bin,s={},h=e;o.readFixed(r,e),e+=4;var d=o.readUshort(r,e);e+=2;var p=o.readUshort(r,e);e+=2;var m=o.readUshort(r,e);return e+=2,s.scriptList=t._lctf.readScriptList(r,h+d),s.featureList=t._lctf.readFeatureList(r,h+p),s.lookupList=t._lctf.readLookupList(r,h+m,n),s},t._lctf.readLookupList=function(r,e,a){var i=t._bin,n=e,o=[],s=i.readUshort(r,e);e+=2;for(var h=0;h<s;h++){var d=i.readUshort(r,e);e+=2;var p=t._lctf.readLookupTable(r,n+d,a);o.push(p)}return o},t._lctf.readLookupTable=function(r,e,a){var i=t._bin,n=e,o={tabs:[]};o.ltype=i.readUshort(r,e),e+=2,o.flag=i.readUshort(r,e),e+=2;var s=i.readUshort(r,e);e+=2;for(var h=o.ltype,d=0;d<s;d++){var p=i.readUshort(r,e);e+=2;var m=a(r,h,n+p,o);o.tabs.push(m)}return o},t._lctf.numOfOnes=function(r){for(var e=0,a=0;a<32;a++)(r>>>a&1)!=0&&e++;return e},t._lctf.readClassDef=function(r,e){var a=t._bin,i=[],n=a.readUshort(r,e);if(e+=2,n==1){var o=a.readUshort(r,e);e+=2;var s=a.readUshort(r,e);e+=2;for(var h=0;h<s;h++)i.push(o+h),i.push(o+h),i.push(a.readUshort(r,e)),e+=2}if(n==2){var d=a.readUshort(r,e);for(e+=2,h=0;h<d;h++)i.push(a.readUshort(r,e)),e+=2,i.push(a.readUshort(r,e)),e+=2,i.push(a.readUshort(r,e)),e+=2}return i},t._lctf.getInterval=function(r,e){for(var a=0;a<r.length;a+=3){var i=r[a],n=r[a+1];if(r[a+2],i<=e&&e<=n)return a}return-1},t._lctf.readCoverage=function(r,e){var a=t._bin,i={};i.fmt=a.readUshort(r,e),e+=2;var n=a.readUshort(r,e);return e+=2,i.fmt==1&&(i.tab=a.readUshorts(r,e,n)),i.fmt==2&&(i.tab=a.readUshorts(r,e,3*n)),i},t._lctf.coverageIndex=function(r,e){var a=r.tab;if(r.fmt==1)return a.indexOf(e);if(r.fmt==2){var i=t._lctf.getInterval(a,e);if(i!=-1)return a[i+2]+(e-a[i])}return-1},t._lctf.readFeatureList=function(r,e){var a=t._bin,i=e,n=[],o=a.readUshort(r,e);e+=2;for(var s=0;s<o;s++){var h=a.readASCII(r,e,4);e+=4;var d=a.readUshort(r,e);e+=2;var p=t._lctf.readFeatureTable(r,i+d);p.tag=h.trim(),n.push(p)}return n},t._lctf.readFeatureTable=function(r,e){var a=t._bin,i=e,n={},o=a.readUshort(r,e);e+=2,o>0&&(n.featureParams=i+o);var s=a.readUshort(r,e);e+=2,n.tab=[];for(var h=0;h<s;h++)n.tab.push(a.readUshort(r,e+2*h));return n},t._lctf.readScriptList=function(r,e){var a=t._bin,i=e,n={},o=a.readUshort(r,e);e+=2;for(var s=0;s<o;s++){var h=a.readASCII(r,e,4);e+=4;var d=a.readUshort(r,e);e+=2,n[h.trim()]=t._lctf.readScriptTable(r,i+d)}return n},t._lctf.readScriptTable=function(r,e){var a=t._bin,i=e,n={},o=a.readUshort(r,e);e+=2,o>0&&(n.default=t._lctf.readLangSysTable(r,i+o));var s=a.readUshort(r,e);e+=2;for(var h=0;h<s;h++){var d=a.readASCII(r,e,4);e+=4;var p=a.readUshort(r,e);e+=2,n[d.trim()]=t._lctf.readLangSysTable(r,i+p)}return n},t._lctf.readLangSysTable=function(r,e){var a=t._bin,i={};a.readUshort(r,e),e+=2,i.reqFeature=a.readUshort(r,e),e+=2;var n=a.readUshort(r,e);return e+=2,i.features=a.readUshorts(r,e,n),i},t.CFF={},t.CFF.parse=function(r,e,a){var i=t._bin;(r=new Uint8Array(r.buffer,e,a))[e=0],r[++e],r[++e],r[++e],e++;var n=[];e=t.CFF.readIndex(r,e,n);for(var o=[],s=0;s<n.length-1;s++)o.push(i.readASCII(r,e+n[s],n[s+1]-n[s]));e+=n[n.length-1];var h=[];e=t.CFF.readIndex(r,e,h);var d=[];for(s=0;s<h.length-1;s++)d.push(t.CFF.readDict(r,e+h[s],e+h[s+1]));e+=h[h.length-1];var p=d[0],m=[];e=t.CFF.readIndex(r,e,m);var S=[];for(s=0;s<m.length-1;s++)S.push(i.readASCII(r,e+m[s],m[s+1]-m[s]));if(e+=m[m.length-1],t.CFF.readSubrs(r,e,p),p.CharStrings){e=p.CharStrings,m=[],e=t.CFF.readIndex(r,e,m);var w=[];for(s=0;s<m.length-1;s++)w.push(i.readBytes(r,e+m[s],m[s+1]-m[s]));p.CharStrings=w}if(p.ROS){e=p.FDArray;var W=[];for(e=t.CFF.readIndex(r,e,W),p.FDArray=[],s=0;s<W.length-1;s++){var k=t.CFF.readDict(r,e+W[s],e+W[s+1]);t.CFF._readFDict(r,k,S),p.FDArray.push(k)}e+=W[W.length-1],e=p.FDSelect,p.FDSelect=[];var I=r[e];if(e++,I!=3)throw I;var E=i.readUshort(r,e);for(e+=2,s=0;s<E+1;s++)p.FDSelect.push(i.readUshort(r,e),r[e+2]),e+=3}return p.Encoding&&(p.Encoding=t.CFF.readEncoding(r,p.Encoding,p.CharStrings.length)),p.charset&&(p.charset=t.CFF.readCharset(r,p.charset,p.CharStrings.length)),t.CFF._readFDict(r,p,S),p},t.CFF._readFDict=function(r,e,a){var i;for(var n in e.Private&&(i=e.Private[1],e.Private=t.CFF.readDict(r,i,i+e.Private[0]),e.Private.Subrs&&t.CFF.readSubrs(r,i+e.Private.Subrs,e.Private)),e)["FamilyName","FontName","FullName","Notice","version","Copyright"].indexOf(n)!=-1&&(e[n]=a[e[n]-426+35])},t.CFF.readSubrs=function(r,e,a){var i=t._bin,n=[];e=t.CFF.readIndex(r,e,n);var o,s=n.length;o=s<1240?107:s<33900?1131:32768,a.Bias=o,a.Subrs=[];for(var h=0;h<n.length-1;h++)a.Subrs.push(i.readBytes(r,e+n[h],n[h+1]-n[h]))},t.CFF.tableSE=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,0,111,112,113,114,0,115,116,117,118,119,120,121,122,0,123,0,124,125,126,127,128,129,130,131,0,132,133,0,134,135,136,137,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,138,0,139,0,0,0,0,140,141,142,143,0,0,0,0,0,144,0,0,0,145,0,0,146,147,148,149,0,0,0,0],t.CFF.glyphByUnicode=function(r,e){for(var a=0;a<r.charset.length;a++)if(r.charset[a]==e)return a;return-1},t.CFF.glyphBySE=function(r,e){return e<0||e>255?-1:t.CFF.glyphByUnicode(r,t.CFF.tableSE[e])},t.CFF.readEncoding=function(r,e,a){t._bin;var i=[".notdef"],n=r[e];if(e++,n!=0)throw"error: unknown encoding format: "+n;var o=r[e];e++;for(var s=0;s<o;s++)i.push(r[e+s]);return i},t.CFF.readCharset=function(r,e,a){var i=t._bin,n=[".notdef"],o=r[e];if(e++,o==0)for(var s=0;s<a;s++){var h=i.readUshort(r,e);e+=2,n.push(h)}else{if(o!=1&&o!=2)throw"error: format: "+o;for(;n.length<a;){h=i.readUshort(r,e),e+=2;var d=0;for(o==1?(d=r[e],e++):(d=i.readUshort(r,e),e+=2),s=0;s<=d;s++)n.push(h),h++}}return n},t.CFF.readIndex=function(r,e,a){var i=t._bin,n=i.readUshort(r,e)+1,o=r[e+=2];if(e++,o==1)for(var s=0;s<n;s++)a.push(r[e+s]);else if(o==2)for(s=0;s<n;s++)a.push(i.readUshort(r,e+2*s));else if(o==3)for(s=0;s<n;s++)a.push(16777215&i.readUint(r,e+3*s-1));else if(n!=1)throw"unsupported offset size: "+o+", count: "+n;return(e+=n*o)-1},t.CFF.getCharString=function(r,e,a){var i=t._bin,n=r[e],o=r[e+1];r[e+2],r[e+3],r[e+4];var s=1,h=null,d=null;n<=20&&(h=n,s=1),n==12&&(h=100*n+o,s=2),21<=n&&n<=27&&(h=n,s=1),n==28&&(d=i.readShort(r,e+1),s=3),29<=n&&n<=31&&(h=n,s=1),32<=n&&n<=246&&(d=n-139,s=1),247<=n&&n<=250&&(d=256*(n-247)+o+108,s=2),251<=n&&n<=254&&(d=256*-(n-251)-o-108,s=2),n==255&&(d=i.readInt(r,e+1)/65535,s=5),a.val=d??"o"+h,a.size=s},t.CFF.readCharString=function(r,e,a){for(var i=e+a,n=t._bin,o=[];e<i;){var s=r[e],h=r[e+1];r[e+2],r[e+3],r[e+4];var d=1,p=null,m=null;s<=20&&(p=s,d=1),s==12&&(p=100*s+h,d=2),s!=19&&s!=20||(p=s,d=2),21<=s&&s<=27&&(p=s,d=1),s==28&&(m=n.readShort(r,e+1),d=3),29<=s&&s<=31&&(p=s,d=1),32<=s&&s<=246&&(m=s-139,d=1),247<=s&&s<=250&&(m=256*(s-247)+h+108,d=2),251<=s&&s<=254&&(m=256*-(s-251)-h-108,d=2),s==255&&(m=n.readInt(r,e+1)/65535,d=5),o.push(m??"o"+p),e+=d}return o},t.CFF.readDict=function(r,e,a){for(var i=t._bin,n={},o=[];e<a;){var s=r[e],h=r[e+1];r[e+2],r[e+3],r[e+4];var d=1,p=null,m=null;if(s==28&&(m=i.readShort(r,e+1),d=3),s==29&&(m=i.readInt(r,e+1),d=5),32<=s&&s<=246&&(m=s-139,d=1),247<=s&&s<=250&&(m=256*(s-247)+h+108,d=2),251<=s&&s<=254&&(m=256*-(s-251)-h-108,d=2),s==255)throw m=i.readInt(r,e+1)/65535,d=5,"unknown number";if(s==30){var S=[];for(d=1;;){var w=r[e+d];d++;var W=w>>4,k=15&w;if(W!=15&&S.push(W),k!=15&&S.push(k),k==15)break}for(var I="",E=[0,1,2,3,4,5,6,7,8,9,".","e","e-","reserved","-","endOfNumber"],C=0;C<S.length;C++)I+=E[S[C]];m=parseFloat(I)}s<=21&&(p=["version","Notice","FullName","FamilyName","Weight","FontBBox","BlueValues","OtherBlues","FamilyBlues","FamilyOtherBlues","StdHW","StdVW","escape","UniqueID","XUID","charset","Encoding","CharStrings","Private","Subrs","defaultWidthX","nominalWidthX"][s],d=1,s==12&&(p=["Copyright","isFixedPitch","ItalicAngle","UnderlinePosition","UnderlineThickness","PaintType","CharstringType","FontMatrix","StrokeWidth","BlueScale","BlueShift","BlueFuzz","StemSnapH","StemSnapV","ForceBold",0,0,"LanguageGroup","ExpansionFactor","initialRandomSeed","SyntheticBase","PostScript","BaseFontName","BaseFontBlend",0,0,0,0,0,0,"ROS","CIDFontVersion","CIDFontRevision","CIDFontType","CIDCount","UIDBase","FDArray","FDSelect","FontName"][h],d=2)),p!=null?(n[p]=o.length==1?o[0]:o,o=[]):o.push(m),e+=d}return n},t.cmap={},t.cmap.parse=function(r,e,a){r=new Uint8Array(r.buffer,e,a),e=0;var i=t._bin,n={};i.readUshort(r,e),e+=2;var o=i.readUshort(r,e);e+=2;var s=[];n.tables=[];for(var h=0;h<o;h++){var d=i.readUshort(r,e);e+=2;var p=i.readUshort(r,e);e+=2;var m=i.readUint(r,e);e+=4;var S="p"+d+"e"+p,w=s.indexOf(m);if(w==-1){var W;w=n.tables.length,s.push(m);var k=i.readUshort(r,m);k==0?W=t.cmap.parse0(r,m):k==4?W=t.cmap.parse4(r,m):k==6?W=t.cmap.parse6(r,m):k==12?W=t.cmap.parse12(r,m):console.debug("unknown format: "+k,d,p,m),n.tables.push(W)}if(n[S]!=null)throw"multiple tables for one platform+encoding";n[S]=w}return n},t.cmap.parse0=function(r,e){var a=t._bin,i={};i.format=a.readUshort(r,e),e+=2;var n=a.readUshort(r,e);e+=2,a.readUshort(r,e),e+=2,i.map=[];for(var o=0;o<n-6;o++)i.map.push(r[e+o]);return i},t.cmap.parse4=function(r,e){var a=t._bin,i=e,n={};n.format=a.readUshort(r,e),e+=2;var o=a.readUshort(r,e);e+=2,a.readUshort(r,e),e+=2;var s=a.readUshort(r,e);e+=2;var h=s/2;n.searchRange=a.readUshort(r,e),e+=2,n.entrySelector=a.readUshort(r,e),e+=2,n.rangeShift=a.readUshort(r,e),e+=2,n.endCount=a.readUshorts(r,e,h),e+=2*h,e+=2,n.startCount=a.readUshorts(r,e,h),e+=2*h,n.idDelta=[];for(var d=0;d<h;d++)n.idDelta.push(a.readShort(r,e)),e+=2;for(n.idRangeOffset=a.readUshorts(r,e,h),e+=2*h,n.glyphIdArray=[];e<i+o;)n.glyphIdArray.push(a.readUshort(r,e)),e+=2;return n},t.cmap.parse6=function(r,e){var a=t._bin,i={};i.format=a.readUshort(r,e),e+=2,a.readUshort(r,e),e+=2,a.readUshort(r,e),e+=2,i.firstCode=a.readUshort(r,e),e+=2;var n=a.readUshort(r,e);e+=2,i.glyphIdArray=[];for(var o=0;o<n;o++)i.glyphIdArray.push(a.readUshort(r,e)),e+=2;return i},t.cmap.parse12=function(r,e){var a=t._bin,i={};i.format=a.readUshort(r,e),e+=2,e+=2,a.readUint(r,e),e+=4,a.readUint(r,e),e+=4;var n=a.readUint(r,e);e+=4,i.groups=[];for(var o=0;o<n;o++){var s=e+12*o,h=a.readUint(r,s+0),d=a.readUint(r,s+4),p=a.readUint(r,s+8);i.groups.push([h,d,p])}return i},t.glyf={},t.glyf.parse=function(r,e,a,i){for(var n=[],o=0;o<i.maxp.numGlyphs;o++)n.push(null);return n},t.glyf._parseGlyf=function(r,e){var a=t._bin,i=r._data,n=t._tabOffset(i,"glyf",r._offset)+r.loca[e];if(r.loca[e]==r.loca[e+1])return null;var o={};if(o.noc=a.readShort(i,n),n+=2,o.xMin=a.readShort(i,n),n+=2,o.yMin=a.readShort(i,n),n+=2,o.xMax=a.readShort(i,n),n+=2,o.yMax=a.readShort(i,n),n+=2,o.xMin>=o.xMax||o.yMin>=o.yMax)return null;if(o.noc>0){o.endPts=[];for(var s=0;s<o.noc;s++)o.endPts.push(a.readUshort(i,n)),n+=2;var h=a.readUshort(i,n);if(n+=2,i.length-n<h)return null;o.instructions=a.readBytes(i,n,h),n+=h;var d=o.endPts[o.noc-1]+1;for(o.flags=[],s=0;s<d;s++){var p=i[n];if(n++,o.flags.push(p),(8&p)!=0){var m=i[n];n++;for(var S=0;S<m;S++)o.flags.push(p),s++}}for(o.xs=[],s=0;s<d;s++){var w=(2&o.flags[s])!=0,W=(16&o.flags[s])!=0;w?(o.xs.push(W?i[n]:-i[n]),n++):W?o.xs.push(0):(o.xs.push(a.readShort(i,n)),n+=2)}for(o.ys=[],s=0;s<d;s++)w=(4&o.flags[s])!=0,W=(32&o.flags[s])!=0,w?(o.ys.push(W?i[n]:-i[n]),n++):W?o.ys.push(0):(o.ys.push(a.readShort(i,n)),n+=2);var k=0,I=0;for(s=0;s<d;s++)k+=o.xs[s],I+=o.ys[s],o.xs[s]=k,o.ys[s]=I}else{var E;o.parts=[];do{E=a.readUshort(i,n),n+=2;var C={m:{a:1,b:0,c:0,d:1,tx:0,ty:0},p1:-1,p2:-1};if(o.parts.push(C),C.glyphIndex=a.readUshort(i,n),n+=2,1&E){var A=a.readShort(i,n);n+=2;var M=a.readShort(i,n);n+=2}else A=a.readInt8(i,n),n++,M=a.readInt8(i,n),n++;2&E?(C.m.tx=A,C.m.ty=M):(C.p1=A,C.p2=M),8&E?(C.m.a=C.m.d=a.readF2dot14(i,n),n+=2):64&E?(C.m.a=a.readF2dot14(i,n),n+=2,C.m.d=a.readF2dot14(i,n),n+=2):128&E&&(C.m.a=a.readF2dot14(i,n),n+=2,C.m.b=a.readF2dot14(i,n),n+=2,C.m.c=a.readF2dot14(i,n),n+=2,C.m.d=a.readF2dot14(i,n),n+=2)}while(32&E);if(256&E){var _=a.readUshort(i,n);for(n+=2,o.instr=[],s=0;s<_;s++)o.instr.push(i[n]),n++}}return o},t.GDEF={},t.GDEF.parse=function(r,e,a,i){var n=e;e+=4;var o=t._bin.readUshort(r,e);return{glyphClassDef:o===0?null:t._lctf.readClassDef(r,n+o)}},t.GPOS={},t.GPOS.parse=function(r,e,a,i){return t._lctf.parse(r,e,a,i,t.GPOS.subt)},t.GPOS.subt=function(r,e,a,i){var n=t._bin,o=a,s={};if(s.fmt=n.readUshort(r,a),a+=2,e==1||e==2||e==3||e==7||e==8&&s.fmt<=2){var h=n.readUshort(r,a);a+=2,s.coverage=t._lctf.readCoverage(r,h+o)}if(e==1&&s.fmt==1){var d=n.readUshort(r,a);a+=2,d!=0&&(s.pos=t.GPOS.readValueRecord(r,a,d))}else if(e==2&&s.fmt>=1&&s.fmt<=2){d=n.readUshort(r,a),a+=2;var p=n.readUshort(r,a);a+=2;var m=t._lctf.numOfOnes(d),S=t._lctf.numOfOnes(p);if(s.fmt==1){s.pairsets=[];var w=n.readUshort(r,a);a+=2;for(var W=0;W<w;W++){var k=o+n.readUshort(r,a);a+=2;var I=n.readUshort(r,k);k+=2;for(var E=[],C=0;C<I;C++){var A=n.readUshort(r,k);k+=2,d!=0&&(b=t.GPOS.readValueRecord(r,k,d),k+=2*m),p!=0&&(D=t.GPOS.readValueRecord(r,k,p),k+=2*S),E.push({gid2:A,val1:b,val2:D})}s.pairsets.push(E)}}if(s.fmt==2){var M=n.readUshort(r,a);a+=2;var _=n.readUshort(r,a);a+=2;var T=n.readUshort(r,a);a+=2;var O=n.readUshort(r,a);for(a+=2,s.classDef1=t._lctf.readClassDef(r,o+M),s.classDef2=t._lctf.readClassDef(r,o+_),s.matrix=[],W=0;W<T;W++){var q=[];for(C=0;C<O;C++){var b=null,D=null;d!=0&&(b=t.GPOS.readValueRecord(r,a,d),a+=2*m),p!=0&&(D=t.GPOS.readValueRecord(r,a,p),a+=2*S),q.push({val1:b,val2:D})}s.matrix.push(q)}}}else if(e==4&&s.fmt==1)s.markCoverage=t._lctf.readCoverage(r,n.readUshort(r,a)+o),s.baseCoverage=t._lctf.readCoverage(r,n.readUshort(r,a+2)+o),s.markClassCount=n.readUshort(r,a+4),s.markArray=t.GPOS.readMarkArray(r,n.readUshort(r,a+6)+o),s.baseArray=t.GPOS.readBaseArray(r,n.readUshort(r,a+8)+o,s.markClassCount);else if(e==6&&s.fmt==1)s.mark1Coverage=t._lctf.readCoverage(r,n.readUshort(r,a)+o),s.mark2Coverage=t._lctf.readCoverage(r,n.readUshort(r,a+2)+o),s.markClassCount=n.readUshort(r,a+4),s.mark1Array=t.GPOS.readMarkArray(r,n.readUshort(r,a+6)+o),s.mark2Array=t.GPOS.readBaseArray(r,n.readUshort(r,a+8)+o,s.markClassCount);else{if(e==9&&s.fmt==1){var U=n.readUshort(r,a);a+=2;var K=n.readUint(r,a);if(a+=4,i.ltype==9)i.ltype=U;else if(i.ltype!=U)throw"invalid extension substitution";return t.GPOS.subt(r,i.ltype,o+K)}console.debug("unsupported GPOS table LookupType",e,"format",s.fmt)}return s},t.GPOS.readValueRecord=function(r,e,a){var i=t._bin,n=[];return n.push(1&a?i.readShort(r,e):0),e+=1&a?2:0,n.push(2&a?i.readShort(r,e):0),e+=2&a?2:0,n.push(4&a?i.readShort(r,e):0),e+=4&a?2:0,n.push(8&a?i.readShort(r,e):0),e+=8&a?2:0,n},t.GPOS.readBaseArray=function(r,e,a){var i=t._bin,n=[],o=e,s=i.readUshort(r,e);e+=2;for(var h=0;h<s;h++){for(var d=[],p=0;p<a;p++)d.push(t.GPOS.readAnchorRecord(r,o+i.readUshort(r,e))),e+=2;n.push(d)}return n},t.GPOS.readMarkArray=function(r,e){var a=t._bin,i=[],n=e,o=a.readUshort(r,e);e+=2;for(var s=0;s<o;s++){var h=t.GPOS.readAnchorRecord(r,a.readUshort(r,e+2)+n);h.markClass=a.readUshort(r,e),i.push(h),e+=4}return i},t.GPOS.readAnchorRecord=function(r,e){var a=t._bin,i={};return i.fmt=a.readUshort(r,e),i.x=a.readShort(r,e+2),i.y=a.readShort(r,e+4),i},t.GSUB={},t.GSUB.parse=function(r,e,a,i){return t._lctf.parse(r,e,a,i,t.GSUB.subt)},t.GSUB.subt=function(r,e,a,i){var n=t._bin,o=a,s={};if(s.fmt=n.readUshort(r,a),a+=2,e!=1&&e!=2&&e!=4&&e!=5&&e!=6)return null;if(e==1||e==2||e==4||e==5&&s.fmt<=2||e==6&&s.fmt<=2){var h=n.readUshort(r,a);a+=2,s.coverage=t._lctf.readCoverage(r,o+h)}if(e==1&&s.fmt>=1&&s.fmt<=2){if(s.fmt==1)s.delta=n.readShort(r,a),a+=2;else if(s.fmt==2){var d=n.readUshort(r,a);a+=2,s.newg=n.readUshorts(r,a,d),a+=2*s.newg.length}}else if(e==2&&s.fmt==1){d=n.readUshort(r,a),a+=2,s.seqs=[];for(var p=0;p<d;p++){var m=n.readUshort(r,a)+o;a+=2;var S=n.readUshort(r,m);s.seqs.push(n.readUshorts(r,m+2,S))}}else if(e==4)for(s.vals=[],d=n.readUshort(r,a),a+=2,p=0;p<d;p++){var w=n.readUshort(r,a);a+=2,s.vals.push(t.GSUB.readLigatureSet(r,o+w))}else if(e==5&&s.fmt==2){if(s.fmt==2){var W=n.readUshort(r,a);a+=2,s.cDef=t._lctf.readClassDef(r,o+W),s.scset=[];var k=n.readUshort(r,a);for(a+=2,p=0;p<k;p++){var I=n.readUshort(r,a);a+=2,s.scset.push(I==0?null:t.GSUB.readSubClassSet(r,o+I))}}}else if(e==6&&s.fmt==3){if(s.fmt==3){for(p=0;p<3;p++){d=n.readUshort(r,a),a+=2;for(var E=[],C=0;C<d;C++)E.push(t._lctf.readCoverage(r,o+n.readUshort(r,a+2*C)));a+=2*d,p==0&&(s.backCvg=E),p==1&&(s.inptCvg=E),p==2&&(s.ahedCvg=E)}d=n.readUshort(r,a),a+=2,s.lookupRec=t.GSUB.readSubstLookupRecords(r,a,d)}}else{if(e==7&&s.fmt==1){var A=n.readUshort(r,a);a+=2;var M=n.readUint(r,a);if(a+=4,i.ltype==9)i.ltype=A;else if(i.ltype!=A)throw"invalid extension substitution";return t.GSUB.subt(r,i.ltype,o+M)}console.debug("unsupported GSUB table LookupType",e,"format",s.fmt)}return s},t.GSUB.readSubClassSet=function(r,e){var a=t._bin.readUshort,i=e,n=[],o=a(r,e);e+=2;for(var s=0;s<o;s++){var h=a(r,e);e+=2,n.push(t.GSUB.readSubClassRule(r,i+h))}return n},t.GSUB.readSubClassRule=function(r,e){var a=t._bin.readUshort,i={},n=a(r,e),o=a(r,e+=2);e+=2,i.input=[];for(var s=0;s<n-1;s++)i.input.push(a(r,e)),e+=2;return i.substLookupRecords=t.GSUB.readSubstLookupRecords(r,e,o),i},t.GSUB.readSubstLookupRecords=function(r,e,a){for(var i=t._bin.readUshort,n=[],o=0;o<a;o++)n.push(i(r,e),i(r,e+2)),e+=4;return n},t.GSUB.readChainSubClassSet=function(r,e){var a=t._bin,i=e,n=[],o=a.readUshort(r,e);e+=2;for(var s=0;s<o;s++){var h=a.readUshort(r,e);e+=2,n.push(t.GSUB.readChainSubClassRule(r,i+h))}return n},t.GSUB.readChainSubClassRule=function(r,e){for(var a=t._bin,i={},n=["backtrack","input","lookahead"],o=0;o<n.length;o++){var s=a.readUshort(r,e);e+=2,o==1&&s--,i[n[o]]=a.readUshorts(r,e,s),e+=2*i[n[o]].length}return s=a.readUshort(r,e),e+=2,i.subst=a.readUshorts(r,e,2*s),e+=2*i.subst.length,i},t.GSUB.readLigatureSet=function(r,e){var a=t._bin,i=e,n=[],o=a.readUshort(r,e);e+=2;for(var s=0;s<o;s++){var h=a.readUshort(r,e);e+=2,n.push(t.GSUB.readLigature(r,i+h))}return n},t.GSUB.readLigature=function(r,e){var a=t._bin,i={chain:[]};i.nglyph=a.readUshort(r,e),e+=2;var n=a.readUshort(r,e);e+=2;for(var o=0;o<n-1;o++)i.chain.push(a.readUshort(r,e)),e+=2;return i},t.head={},t.head.parse=function(r,e,a){var i=t._bin,n={};return i.readFixed(r,e),e+=4,n.fontRevision=i.readFixed(r,e),e+=4,i.readUint(r,e),e+=4,i.readUint(r,e),e+=4,n.flags=i.readUshort(r,e),e+=2,n.unitsPerEm=i.readUshort(r,e),e+=2,n.created=i.readUint64(r,e),e+=8,n.modified=i.readUint64(r,e),e+=8,n.xMin=i.readShort(r,e),e+=2,n.yMin=i.readShort(r,e),e+=2,n.xMax=i.readShort(r,e),e+=2,n.yMax=i.readShort(r,e),e+=2,n.macStyle=i.readUshort(r,e),e+=2,n.lowestRecPPEM=i.readUshort(r,e),e+=2,n.fontDirectionHint=i.readShort(r,e),e+=2,n.indexToLocFormat=i.readShort(r,e),e+=2,n.glyphDataFormat=i.readShort(r,e),e+=2,n},t.hhea={},t.hhea.parse=function(r,e,a){var i=t._bin,n={};return i.readFixed(r,e),e+=4,n.ascender=i.readShort(r,e),e+=2,n.descender=i.readShort(r,e),e+=2,n.lineGap=i.readShort(r,e),e+=2,n.advanceWidthMax=i.readUshort(r,e),e+=2,n.minLeftSideBearing=i.readShort(r,e),e+=2,n.minRightSideBearing=i.readShort(r,e),e+=2,n.xMaxExtent=i.readShort(r,e),e+=2,n.caretSlopeRise=i.readShort(r,e),e+=2,n.caretSlopeRun=i.readShort(r,e),e+=2,n.caretOffset=i.readShort(r,e),e+=2,e+=8,n.metricDataFormat=i.readShort(r,e),e+=2,n.numberOfHMetrics=i.readUshort(r,e),e+=2,n},t.hmtx={},t.hmtx.parse=function(r,e,a,i){for(var n=t._bin,o={aWidth:[],lsBearing:[]},s=0,h=0,d=0;d<i.maxp.numGlyphs;d++)d<i.hhea.numberOfHMetrics&&(s=n.readUshort(r,e),e+=2,h=n.readShort(r,e),e+=2),o.aWidth.push(s),o.lsBearing.push(h);return o},t.kern={},t.kern.parse=function(r,e,a,i){var n=t._bin,o=n.readUshort(r,e);if(e+=2,o==1)return t.kern.parseV1(r,e-2,a,i);var s=n.readUshort(r,e);e+=2;for(var h={glyph1:[],rval:[]},d=0;d<s;d++){e+=2,a=n.readUshort(r,e),e+=2;var p=n.readUshort(r,e);e+=2;var m=p>>>8;if((m&=15)!=0)throw"unknown kern table format: "+m;e=t.kern.readFormat0(r,e,h)}return h},t.kern.parseV1=function(r,e,a,i){var n=t._bin;n.readFixed(r,e),e+=4;var o=n.readUint(r,e);e+=4;for(var s={glyph1:[],rval:[]},h=0;h<o;h++){n.readUint(r,e),e+=4;var d=n.readUshort(r,e);e+=2,n.readUshort(r,e),e+=2;var p=d>>>8;if((p&=15)!=0)throw"unknown kern table format: "+p;e=t.kern.readFormat0(r,e,s)}return s},t.kern.readFormat0=function(r,e,a){var i=t._bin,n=-1,o=i.readUshort(r,e);e+=2,i.readUshort(r,e),e+=2,i.readUshort(r,e),e+=2,i.readUshort(r,e),e+=2;for(var s=0;s<o;s++){var h=i.readUshort(r,e);e+=2;var d=i.readUshort(r,e);e+=2;var p=i.readShort(r,e);e+=2,h!=n&&(a.glyph1.push(h),a.rval.push({glyph2:[],vals:[]}));var m=a.rval[a.rval.length-1];m.glyph2.push(d),m.vals.push(p),n=h}return e},t.loca={},t.loca.parse=function(r,e,a,i){var n=t._bin,o=[],s=i.head.indexToLocFormat,h=i.maxp.numGlyphs+1;if(s==0)for(var d=0;d<h;d++)o.push(n.readUshort(r,e+(d<<1))<<1);if(s==1)for(d=0;d<h;d++)o.push(n.readUint(r,e+(d<<2)));return o},t.maxp={},t.maxp.parse=function(r,e,a){var i=t._bin,n={},o=i.readUint(r,e);return e+=4,n.numGlyphs=i.readUshort(r,e),e+=2,o==65536&&(n.maxPoints=i.readUshort(r,e),e+=2,n.maxContours=i.readUshort(r,e),e+=2,n.maxCompositePoints=i.readUshort(r,e),e+=2,n.maxCompositeContours=i.readUshort(r,e),e+=2,n.maxZones=i.readUshort(r,e),e+=2,n.maxTwilightPoints=i.readUshort(r,e),e+=2,n.maxStorage=i.readUshort(r,e),e+=2,n.maxFunctionDefs=i.readUshort(r,e),e+=2,n.maxInstructionDefs=i.readUshort(r,e),e+=2,n.maxStackElements=i.readUshort(r,e),e+=2,n.maxSizeOfInstructions=i.readUshort(r,e),e+=2,n.maxComponentElements=i.readUshort(r,e),e+=2,n.maxComponentDepth=i.readUshort(r,e),e+=2),n},t.name={},t.name.parse=function(r,e,a){var i=t._bin,n={};i.readUshort(r,e),e+=2;var o=i.readUshort(r,e);e+=2,i.readUshort(r,e);for(var s,h=["copyright","fontFamily","fontSubfamily","ID","fullName","version","postScriptName","trademark","manufacturer","designer","description","urlVendor","urlDesigner","licence","licenceURL","---","typoFamilyName","typoSubfamilyName","compatibleFull","sampleText","postScriptCID","wwsFamilyName","wwsSubfamilyName","lightPalette","darkPalette"],d=e+=2,p=0;p<o;p++){var m=i.readUshort(r,e);e+=2;var S=i.readUshort(r,e);e+=2;var w=i.readUshort(r,e);e+=2;var W=i.readUshort(r,e);e+=2;var k=i.readUshort(r,e);e+=2;var I=i.readUshort(r,e);e+=2;var E,C=h[W],A=d+12*o+I;if(m==0)E=i.readUnicode(r,A,k/2);else if(m==3&&S==0)E=i.readUnicode(r,A,k/2);else if(S==0)E=i.readASCII(r,A,k);else if(S==1)E=i.readUnicode(r,A,k/2);else if(S==3)E=i.readUnicode(r,A,k/2);else{if(m!=1)throw"unknown encoding "+S+", platformID: "+m;E=i.readASCII(r,A,k),console.debug("reading unknown MAC encoding "+S+" as ASCII")}var M="p"+m+","+w.toString(16);n[M]==null&&(n[M]={}),n[M][C!==void 0?C:W]=E,n[M]._lang=w}for(var _ in n)if(n[_].postScriptName!=null&&n[_]._lang==1033)return n[_];for(var _ in n)if(n[_].postScriptName!=null&&n[_]._lang==0)return n[_];for(var _ in n)if(n[_].postScriptName!=null&&n[_]._lang==3084)return n[_];for(var _ in n)if(n[_].postScriptName!=null)return n[_];for(var _ in n){s=_;break}return console.debug("returning name table with languageID "+n[s]._lang),n[s]},t["OS/2"]={},t["OS/2"].parse=function(r,e,a){var i=t._bin.readUshort(r,e);e+=2;var n={};if(i==0)t["OS/2"].version0(r,e,n);else if(i==1)t["OS/2"].version1(r,e,n);else if(i==2||i==3||i==4)t["OS/2"].version2(r,e,n);else{if(i!=5)throw"unknown OS/2 table version: "+i;t["OS/2"].version5(r,e,n)}return n},t["OS/2"].version0=function(r,e,a){var i=t._bin;return a.xAvgCharWidth=i.readShort(r,e),e+=2,a.usWeightClass=i.readUshort(r,e),e+=2,a.usWidthClass=i.readUshort(r,e),e+=2,a.fsType=i.readUshort(r,e),e+=2,a.ySubscriptXSize=i.readShort(r,e),e+=2,a.ySubscriptYSize=i.readShort(r,e),e+=2,a.ySubscriptXOffset=i.readShort(r,e),e+=2,a.ySubscriptYOffset=i.readShort(r,e),e+=2,a.ySuperscriptXSize=i.readShort(r,e),e+=2,a.ySuperscriptYSize=i.readShort(r,e),e+=2,a.ySuperscriptXOffset=i.readShort(r,e),e+=2,a.ySuperscriptYOffset=i.readShort(r,e),e+=2,a.yStrikeoutSize=i.readShort(r,e),e+=2,a.yStrikeoutPosition=i.readShort(r,e),e+=2,a.sFamilyClass=i.readShort(r,e),e+=2,a.panose=i.readBytes(r,e,10),e+=10,a.ulUnicodeRange1=i.readUint(r,e),e+=4,a.ulUnicodeRange2=i.readUint(r,e),e+=4,a.ulUnicodeRange3=i.readUint(r,e),e+=4,a.ulUnicodeRange4=i.readUint(r,e),e+=4,a.achVendID=[i.readInt8(r,e),i.readInt8(r,e+1),i.readInt8(r,e+2),i.readInt8(r,e+3)],e+=4,a.fsSelection=i.readUshort(r,e),e+=2,a.usFirstCharIndex=i.readUshort(r,e),e+=2,a.usLastCharIndex=i.readUshort(r,e),e+=2,a.sTypoAscender=i.readShort(r,e),e+=2,a.sTypoDescender=i.readShort(r,e),e+=2,a.sTypoLineGap=i.readShort(r,e),e+=2,a.usWinAscent=i.readUshort(r,e),e+=2,a.usWinDescent=i.readUshort(r,e),e+=2},t["OS/2"].version1=function(r,e,a){var i=t._bin;return e=t["OS/2"].version0(r,e,a),a.ulCodePageRange1=i.readUint(r,e),e+=4,a.ulCodePageRange2=i.readUint(r,e),e+=4},t["OS/2"].version2=function(r,e,a){var i=t._bin;return e=t["OS/2"].version1(r,e,a),a.sxHeight=i.readShort(r,e),e+=2,a.sCapHeight=i.readShort(r,e),e+=2,a.usDefault=i.readUshort(r,e),e+=2,a.usBreak=i.readUshort(r,e),e+=2,a.usMaxContext=i.readUshort(r,e),e+=2},t["OS/2"].version5=function(r,e,a){var i=t._bin;return e=t["OS/2"].version2(r,e,a),a.usLowerOpticalPointSize=i.readUshort(r,e),e+=2,a.usUpperOpticalPointSize=i.readUshort(r,e),e+=2},t.post={},t.post.parse=function(r,e,a){var i=t._bin,n={};return n.version=i.readFixed(r,e),e+=4,n.italicAngle=i.readFixed(r,e),e+=4,n.underlinePosition=i.readShort(r,e),e+=2,n.underlineThickness=i.readShort(r,e),e+=2,n},t==null&&(t={}),t.U==null&&(t.U={}),t.U.codeToGlyph=function(r,e){var a=r.cmap,i=-1;if(a.p0e4!=null?i=a.p0e4:a.p3e1!=null?i=a.p3e1:a.p1e0!=null?i=a.p1e0:a.p0e3!=null&&(i=a.p0e3),i==-1)throw"no familiar platform and encoding!";var n=a.tables[i];if(n.format==0)return e>=n.map.length?0:n.map[e];if(n.format==4){for(var o=-1,s=0;s<n.endCount.length;s++)if(e<=n.endCount[s]){o=s;break}return o==-1||n.startCount[o]>e?0:65535&(n.idRangeOffset[o]!=0?n.glyphIdArray[e-n.startCount[o]+(n.idRangeOffset[o]>>1)-(n.idRangeOffset.length-o)]:e+n.idDelta[o])}if(n.format==12){if(e>n.groups[n.groups.length-1][1])return 0;for(s=0;s<n.groups.length;s++){var h=n.groups[s];if(h[0]<=e&&e<=h[1])return h[2]+(e-h[0])}return 0}throw"unknown cmap table format "+n.format},t.U.glyphToPath=function(r,e){var a={cmds:[],crds:[]};if(r.SVG&&r.SVG.entries[e]){var i=r.SVG.entries[e];return i==null?a:(typeof i=="string"&&(i=t.SVG.toPath(i),r.SVG.entries[e]=i),i)}if(r.CFF){var n={x:0,y:0,stack:[],nStems:0,haveWidth:!1,width:r.CFF.Private?r.CFF.Private.defaultWidthX:0,open:!1},o=r.CFF,s=r.CFF.Private;if(o.ROS){for(var h=0;o.FDSelect[h+2]<=e;)h+=2;s=o.FDArray[o.FDSelect[h+1]].Private}t.U._drawCFF(r.CFF.CharStrings[e],n,o,s,a)}else r.glyf&&t.U._drawGlyf(e,r,a);return a},t.U._drawGlyf=function(r,e,a){var i=e.glyf[r];i==null&&(i=e.glyf[r]=t.glyf._parseGlyf(e,r)),i!=null&&(i.noc>-1?t.U._simpleGlyph(i,a):t.U._compoGlyph(i,e,a))},t.U._simpleGlyph=function(r,e){for(var a=0;a<r.noc;a++){for(var i=a==0?0:r.endPts[a-1]+1,n=r.endPts[a],o=i;o<=n;o++){var s=o==i?n:o-1,h=o==n?i:o+1,d=1&r.flags[o],p=1&r.flags[s],m=1&r.flags[h],S=r.xs[o],w=r.ys[o];if(o==i)if(d){if(!p){t.U.P.moveTo(e,S,w);continue}t.U.P.moveTo(e,r.xs[s],r.ys[s])}else p?t.U.P.moveTo(e,r.xs[s],r.ys[s]):t.U.P.moveTo(e,(r.xs[s]+S)/2,(r.ys[s]+w)/2);d?p&&t.U.P.lineTo(e,S,w):m?t.U.P.qcurveTo(e,S,w,r.xs[h],r.ys[h]):t.U.P.qcurveTo(e,S,w,(S+r.xs[h])/2,(w+r.ys[h])/2)}t.U.P.closePath(e)}},t.U._compoGlyph=function(r,e,a){for(var i=0;i<r.parts.length;i++){var n={cmds:[],crds:[]},o=r.parts[i];t.U._drawGlyf(o.glyphIndex,e,n);for(var s=o.m,h=0;h<n.crds.length;h+=2){var d=n.crds[h],p=n.crds[h+1];a.crds.push(d*s.a+p*s.b+s.tx),a.crds.push(d*s.c+p*s.d+s.ty)}for(h=0;h<n.cmds.length;h++)a.cmds.push(n.cmds[h])}},t.U._getGlyphClass=function(r,e){var a=t._lctf.getInterval(e,r);return a==-1?0:e[a+2]},t.U._applySubs=function(r,e,a,i){for(var n=r.length-e-1,o=0;o<a.tabs.length;o++)if(a.tabs[o]!=null){var s,h=a.tabs[o];if(!h.coverage||(s=t._lctf.coverageIndex(h.coverage,r[e]))!=-1){if(a.ltype==1)r[e],h.fmt==1?r[e]=r[e]+h.delta:r[e]=h.newg[s];else if(a.ltype==4)for(var d=h.vals[s],p=0;p<d.length;p++){var m=d[p],S=m.chain.length;if(!(S>n)){for(var w=!0,W=0,k=0;k<S;k++){for(;r[e+W+(1+k)]==-1;)W++;m.chain[k]!=r[e+W+(1+k)]&&(w=!1)}if(w){for(r[e]=m.nglyph,k=0;k<S+W;k++)r[e+k+1]=-1;break}}}else if(a.ltype==5&&h.fmt==2)for(var I=t._lctf.getInterval(h.cDef,r[e]),E=h.cDef[I+2],C=h.scset[E],A=0;A<C.length;A++){var M=C[A],_=M.input;if(!(_.length>n)){for(w=!0,k=0;k<_.length;k++){var T=t._lctf.getInterval(h.cDef,r[e+1+k]);if(I==-1&&h.cDef[T+2]!=_[k]){w=!1;break}}if(w){var O=M.substLookupRecords;for(p=0;p<O.length;p+=2)O[p],O[p+1]}}}else if(a.ltype==6&&h.fmt==3){if(!t.U._glsCovered(r,h.backCvg,e-h.backCvg.length)||!t.U._glsCovered(r,h.inptCvg,e)||!t.U._glsCovered(r,h.ahedCvg,e+h.inptCvg.length))continue;var q=h.lookupRec;for(A=0;A<q.length;A+=2){I=q[A];var b=i[q[A+1]];t.U._applySubs(r,e+I,b,i)}}}}},t.U._glsCovered=function(r,e,a){for(var i=0;i<e.length;i++)if(t._lctf.coverageIndex(e[i],r[a+i])==-1)return!1;return!0},t.U.glyphsToPath=function(r,e,a){for(var i={cmds:[],crds:[]},n=0,o=0;o<e.length;o++){var s=e[o];if(s!=-1){for(var h=o<e.length-1&&e[o+1]!=-1?e[o+1]:0,d=t.U.glyphToPath(r,s),p=0;p<d.crds.length;p+=2)i.crds.push(d.crds[p]+n),i.crds.push(d.crds[p+1]);for(a&&i.cmds.push(a),p=0;p<d.cmds.length;p++)i.cmds.push(d.cmds[p]);a&&i.cmds.push("X"),n+=r.hmtx.aWidth[s],o<e.length-1&&(n+=t.U.getPairAdjustment(r,s,h))}}return i},t.U.P={},t.U.P.moveTo=function(r,e,a){r.cmds.push("M"),r.crds.push(e,a)},t.U.P.lineTo=function(r,e,a){r.cmds.push("L"),r.crds.push(e,a)},t.U.P.curveTo=function(r,e,a,i,n,o,s){r.cmds.push("C"),r.crds.push(e,a,i,n,o,s)},t.U.P.qcurveTo=function(r,e,a,i,n){r.cmds.push("Q"),r.crds.push(e,a,i,n)},t.U.P.closePath=function(r){r.cmds.push("Z")},t.U._drawCFF=function(r,e,a,i,n){for(var o=e.stack,s=e.nStems,h=e.haveWidth,d=e.width,p=e.open,m=0,S=e.x,w=e.y,W=0,k=0,I=0,E=0,C=0,A=0,M=0,_=0,T=0,O=0,q={val:0,size:0};m<r.length;){t.CFF.getCharString(r,m,q);var b=q.val;if(m+=q.size,b=="o1"||b=="o18")o.length%2!=0&&!h&&(d=o.shift()+i.nominalWidthX),s+=o.length>>1,o.length=0,h=!0;else if(b=="o3"||b=="o23")o.length%2!=0&&!h&&(d=o.shift()+i.nominalWidthX),s+=o.length>>1,o.length=0,h=!0;else if(b=="o4")o.length>1&&!h&&(d=o.shift()+i.nominalWidthX,h=!0),p&&t.U.P.closePath(n),w+=o.pop(),t.U.P.moveTo(n,S,w),p=!0;else if(b=="o5")for(;o.length>0;)S+=o.shift(),w+=o.shift(),t.U.P.lineTo(n,S,w);else if(b=="o6"||b=="o7")for(var D=o.length,U=b=="o6",K=0;K<D;K++){var H=o.shift();U?S+=H:w+=H,U=!U,t.U.P.lineTo(n,S,w)}else if(b=="o8"||b=="o24"){D=o.length;for(var ie=0;ie+6<=D;)W=S+o.shift(),k=w+o.shift(),I=W+o.shift(),E=k+o.shift(),S=I+o.shift(),w=E+o.shift(),t.U.P.curveTo(n,W,k,I,E,S,w),ie+=6;b=="o24"&&(S+=o.shift(),w+=o.shift(),t.U.P.lineTo(n,S,w))}else{if(b=="o11")break;if(b=="o1234"||b=="o1235"||b=="o1236"||b=="o1237")b=="o1234"&&(k=w,I=(W=S+o.shift())+o.shift(),O=E=k+o.shift(),A=E,_=w,S=(M=(C=(T=I+o.shift())+o.shift())+o.shift())+o.shift(),t.U.P.curveTo(n,W,k,I,E,T,O),t.U.P.curveTo(n,C,A,M,_,S,w)),b=="o1235"&&(W=S+o.shift(),k=w+o.shift(),I=W+o.shift(),E=k+o.shift(),T=I+o.shift(),O=E+o.shift(),C=T+o.shift(),A=O+o.shift(),M=C+o.shift(),_=A+o.shift(),S=M+o.shift(),w=_+o.shift(),o.shift(),t.U.P.curveTo(n,W,k,I,E,T,O),t.U.P.curveTo(n,C,A,M,_,S,w)),b=="o1236"&&(W=S+o.shift(),k=w+o.shift(),I=W+o.shift(),O=E=k+o.shift(),A=E,M=(C=(T=I+o.shift())+o.shift())+o.shift(),_=A+o.shift(),S=M+o.shift(),t.U.P.curveTo(n,W,k,I,E,T,O),t.U.P.curveTo(n,C,A,M,_,S,w)),b=="o1237"&&(W=S+o.shift(),k=w+o.shift(),I=W+o.shift(),E=k+o.shift(),T=I+o.shift(),O=E+o.shift(),C=T+o.shift(),A=O+o.shift(),M=C+o.shift(),_=A+o.shift(),Math.abs(M-S)>Math.abs(_-w)?S=M+o.shift():w=_+o.shift(),t.U.P.curveTo(n,W,k,I,E,T,O),t.U.P.curveTo(n,C,A,M,_,S,w));else if(b=="o14"){if(o.length>0&&!h&&(d=o.shift()+a.nominalWidthX,h=!0),o.length==4){var ue=o.shift(),X=o.shift(),L=o.shift(),y=o.shift(),x=t.CFF.glyphBySE(a,L),R=t.CFF.glyphBySE(a,y);t.U._drawCFF(a.CharStrings[x],e,a,i,n),e.x=ue,e.y=X,t.U._drawCFF(a.CharStrings[R],e,a,i,n)}p&&(t.U.P.closePath(n),p=!1)}else if(b=="o19"||b=="o20")o.length%2!=0&&!h&&(d=o.shift()+i.nominalWidthX),s+=o.length>>1,o.length=0,h=!0,m+=s+7>>3;else if(b=="o21")o.length>2&&!h&&(d=o.shift()+i.nominalWidthX,h=!0),w+=o.pop(),S+=o.pop(),p&&t.U.P.closePath(n),t.U.P.moveTo(n,S,w),p=!0;else if(b=="o22")o.length>1&&!h&&(d=o.shift()+i.nominalWidthX,h=!0),S+=o.pop(),p&&t.U.P.closePath(n),t.U.P.moveTo(n,S,w),p=!0;else if(b=="o25"){for(;o.length>6;)S+=o.shift(),w+=o.shift(),t.U.P.lineTo(n,S,w);W=S+o.shift(),k=w+o.shift(),I=W+o.shift(),E=k+o.shift(),S=I+o.shift(),w=E+o.shift(),t.U.P.curveTo(n,W,k,I,E,S,w)}else if(b=="o26")for(o.length%2&&(S+=o.shift());o.length>0;)W=S,k=w+o.shift(),S=I=W+o.shift(),w=(E=k+o.shift())+o.shift(),t.U.P.curveTo(n,W,k,I,E,S,w);else if(b=="o27")for(o.length%2&&(w+=o.shift());o.length>0;)k=w,I=(W=S+o.shift())+o.shift(),E=k+o.shift(),S=I+o.shift(),w=E,t.U.P.curveTo(n,W,k,I,E,S,w);else if(b=="o10"||b=="o29"){var P=b=="o10"?i:a;if(o.length==0)console.debug("error: empty stack");else{var G=o.pop(),V=P.Subrs[G+P.Bias];e.x=S,e.y=w,e.nStems=s,e.haveWidth=h,e.width=d,e.open=p,t.U._drawCFF(V,e,a,i,n),S=e.x,w=e.y,s=e.nStems,h=e.haveWidth,d=e.width,p=e.open}}else if(b=="o30"||b=="o31"){var j=o.length,Y=(ie=0,b=="o31");for(ie+=j-(D=-3&j);ie<D;)Y?(k=w,I=(W=S+o.shift())+o.shift(),w=(E=k+o.shift())+o.shift(),D-ie==5?(S=I+o.shift(),ie++):S=I,Y=!1):(W=S,k=w+o.shift(),I=W+o.shift(),E=k+o.shift(),S=I+o.shift(),D-ie==5?(w=E+o.shift(),ie++):w=E,Y=!0),t.U.P.curveTo(n,W,k,I,E,S,w),ie+=4}else{if((b+"").charAt(0)=="o")throw console.debug("Unknown operation: "+b,r),b;o.push(b)}}}e.x=S,e.y=w,e.nStems=s,e.haveWidth=h,e.width=d,e.open=p};var c=t,f={Typr:c};return u.Typr=c,u.default=f,Object.defineProperty(u,"__esModule",{value:!0}),u})({}).Typr}function Wo(){return(function(u){var t=Uint8Array,c=Uint16Array,f=Uint32Array,r=new t([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),e=new t([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),a=new t([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),i=function(b,D){for(var U=new c(31),K=0;K<31;++K)U[K]=D+=1<<b[K-1];var H=new f(U[30]);for(K=1;K<30;++K)for(var ie=U[K];ie<U[K+1];++ie)H[ie]=ie-U[K]<<5|K;return[U,H]},n=i(r,2),o=n[0],s=n[1];o[28]=258,s[258]=28;for(var h=i(e,0)[0],d=new c(32768),p=0;p<32768;++p){var m=(43690&p)>>>1|(21845&p)<<1;m=(61680&(m=(52428&m)>>>2|(13107&m)<<2))>>>4|(3855&m)<<4,d[p]=((65280&m)>>>8|(255&m)<<8)>>>1}var S=function(b,D,U){for(var K=b.length,H=0,ie=new c(D);H<K;++H)++ie[b[H]-1];var ue,X=new c(D);for(H=0;H<D;++H)X[H]=X[H-1]+ie[H-1]<<1;{ue=new c(1<<D);var L=15-D;for(H=0;H<K;++H)if(b[H])for(var y=H<<4|b[H],x=D-b[H],R=X[b[H]-1]++<<x,P=R|(1<<x)-1;R<=P;++R)ue[d[R]>>>L]=y}return ue},w=new t(288);for(p=0;p<144;++p)w[p]=8;for(p=144;p<256;++p)w[p]=9;for(p=256;p<280;++p)w[p]=7;for(p=280;p<288;++p)w[p]=8;var W=new t(32);for(p=0;p<32;++p)W[p]=5;var k=S(w,9),I=S(W,5),E=function(b){for(var D=b[0],U=1;U<b.length;++U)b[U]>D&&(D=b[U]);return D},C=function(b,D,U){var K=D/8|0;return(b[K]|b[K+1]<<8)>>(7&D)&U},A=function(b,D){var U=D/8|0;return(b[U]|b[U+1]<<8|b[U+2]<<16)>>(7&D)},M=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],_=function(b,D,U){var K=new Error(D||M[b]);if(K.code=b,Error.captureStackTrace&&Error.captureStackTrace(K,_),!U)throw K;return K},T=function(b,D,U){var K=b.length;if(!K||U&&!U.l&&K<5)return D||new t(0);var H=!D||U,ie=!U||U.i;U||(U={}),D||(D=new t(3*K));var ue,X=function(Se){var Xe=D.length;if(Se>Xe){var Le=new t(Math.max(2*Xe,Se));Le.set(D),D=Le}},L=U.f||0,y=U.p||0,x=U.b||0,R=U.l,P=U.d,G=U.m,V=U.n,j=8*K;do{if(!R){U.f=L=C(b,y,1);var Y=C(b,y+1,3);if(y+=3,!Y){var le=b[(he=((ue=y)/8|0)+(7&ue&&1)+4)-4]|b[he-3]<<8,de=he+le;if(de>K){ie&&_(0);break}H&&X(x+le),D.set(b.subarray(he,de),x),U.b=x+=le,U.p=y=8*de;continue}if(Y==1)R=k,P=I,G=9,V=5;else if(Y==2){var ae=C(b,y,31)+257,$=C(b,y+10,15)+4,Fe=ae+C(b,y+5,31)+1;y+=14;for(var Te=new t(Fe),ce=new t(19),pe=0;pe<$;++pe)ce[a[pe]]=C(b,y+3*pe,7);y+=3*$;var Ue=E(ce),re=(1<<Ue)-1,ge=S(ce,Ue);for(pe=0;pe<Fe;){var he,J=ge[C(b,y,re)];if(y+=15&J,(he=J>>>4)<16)Te[pe++]=he;else{var ke=0,fe=0;for(he==16?(fe=3+C(b,y,3),y+=2,ke=Te[pe-1]):he==17?(fe=3+C(b,y,7),y+=3):he==18&&(fe=11+C(b,y,127),y+=7);fe--;)Te[pe++]=ke}}var we=Te.subarray(0,ae),se=Te.subarray(ae);G=E(we),V=E(se),R=S(we,G),P=S(se,V)}else _(1);if(y>j){ie&&_(0);break}}H&&X(x+131072);for(var Pe=(1<<G)-1,me=(1<<V)-1,ye=y;;ye=y){var be=(ke=R[A(b,y)&Pe])>>>4;if((y+=15&ke)>j){ie&&_(0);break}if(ke||_(2),be<256)D[x++]=be;else{if(be==256){ye=y,R=null;break}var Ae=be-254;if(be>264){var Ke=r[pe=be-257];Ae=C(b,y,(1<<Ke)-1)+o[pe],y+=Ke}var er=P[A(b,y)&me],De=er>>>4;if(er||_(3),y+=15&er,se=h[De],De>3&&(Ke=e[De],se+=A(b,y)&(1<<Ke)-1,y+=Ke),y>j){ie&&_(0);break}H&&X(x+131072);for(var xe=x+Ae;x<xe;x+=4)D[x]=D[x-se],D[x+1]=D[x+1-se],D[x+2]=D[x+2-se],D[x+3]=D[x+3-se];x=xe}}U.l=R,U.p=ye,U.b=x,R&&(L=1,U.m=G,U.d=P,U.n=V)}while(!L);return x==D.length?D:(function(Se,Xe,Le){(Le==null||Le>Se.length)&&(Le=Se.length);var Ne=new(Se instanceof c?c:Se instanceof f?f:t)(Le-Xe);return Ne.set(Se.subarray(Xe,Le)),Ne})(D,0,x)},O=new t(0),q=typeof TextDecoder<"u"&&new TextDecoder;try{q.decode(O,{stream:!0})}catch{}return u.convert_streams=function(b){var D=new DataView(b),U=0;function K(){var ae=D.getUint16(U);return U+=2,ae}function H(){var ae=D.getUint32(U);return U+=4,ae}function ie(ae){le.setUint16(de,ae),de+=2}function ue(ae){le.setUint32(de,ae),de+=4}for(var X={signature:H(),flavor:H(),length:H(),numTables:K(),reserved:K(),totalSfntSize:H(),majorVersion:K(),minorVersion:K(),metaOffset:H(),metaLength:H(),metaOrigLength:H(),privOffset:H(),privLength:H()},L=0;Math.pow(2,L)<=X.numTables;)L++;L--;for(var y=16*Math.pow(2,L),x=16*X.numTables-y,R=12,P=[],G=0;G<X.numTables;G++)P.push({tag:H(),offset:H(),compLength:H(),origLength:H(),origChecksum:H()}),R+=16;var V,j=new Uint8Array(12+16*P.length+P.reduce((function(ae,$){return ae+$.origLength+4}),0)),Y=j.buffer,le=new DataView(Y),de=0;return ue(X.flavor),ie(X.numTables),ie(y),ie(L),ie(x),P.forEach((function(ae){ue(ae.tag),ue(ae.origChecksum),ue(R),ue(ae.origLength),ae.outOffset=R,(R+=ae.origLength)%4!=0&&(R+=4-R%4)})),P.forEach((function(ae){var $,Fe=b.slice(ae.offset,ae.offset+ae.compLength);if(ae.compLength!=ae.origLength){var Te=new Uint8Array(ae.origLength);$=new Uint8Array(Fe,2),T($,Te)}else Te=new Uint8Array(Fe);j.set(Te,ae.outOffset);var ce=0;(R=ae.outOffset+ae.origLength)%4!=0&&(ce=4-R%4),j.set(new Uint8Array(ce).buffer,ae.outOffset+ae.origLength),V=R+ce})),Y.slice(0,V)},Object.defineProperty(u,"__esModule",{value:!0}),u})({}).convert_streams}function Ho(u,t){const c={M:2,L:2,Q:4,C:6,Z:0},f={C:"18g,ca,368,1kz",D:"17k,6,2,2+4,5+c,2+6,2+1,10+1,9+f,j+11,2+1,a,2,2+1,15+2,3,j+2,6+3,2+8,2,2,2+1,w+a,4+e,3+3,2,3+2,3+5,23+w,2f+4,3,2+9,2,b,2+3,3,1k+9,6+1,3+1,2+2,2+d,30g,p+y,1,1+1g,f+x,2,sd2+1d,jf3+4,f+3,2+4,2+2,b+3,42,2,4+2,2+1,2,3,t+1,9f+w,2,el+2,2+g,d+2,2l,2+1,5,3+1,2+1,2,3,6,16wm+1v",R:"17m+3,2,2,6+3,m,15+2,2+2,h+h,13,3+8,2,2,3+1,2,p+1,x,5+4,5,a,2,2,3,u,c+2,g+1,5,2+1,4+1,5j,6+1,2,b,2+2,f,2+1,1s+2,2,3+1,7,1ez0,2,2+1,4+4,b,4,3,b,42,2+2,4,3,2+1,2,o+3,ae,ep,x,2o+2,3+1,3,5+1,6",L:"x9u,jff,a,fd,jv",T:"4t,gj+33,7o+4,1+1,7c+18,2,2+1,2+1,2,21+a,2,1b+k,h,2u+6,3+5,3+1,2+3,y,2,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,3,7,6+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+d,1,1+1,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,ek,3+1,r+4,1e+4,6+5,2p+c,1+3,1,1+2,1+b,2db+2,3y,2p+v,ff+3,30+1,n9x,1+2,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,5s,6y+2,ea,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+9,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2,2b+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,470+8,at4+4,1o+6,t5,1s+3,2a,f5l+1,2+3,43o+2,a+7,1+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,1,gzau,v+2n,3l+6n"},r=1,e=2,a=4,i=8,n=16,o=32;let s;function h(M){if(!s){const _={R:e,L:r,D:a,C:n,U:o,T:i};s=new Map;for(let T in f){let O=0;f[T].split(",").forEach(q=>{let[b,D]=q.split("+");b=parseInt(b,36),D=D?parseInt(D,36):0,s.set(O+=b,_[T]);for(let U=D;U--;)s.set(++O,_[T])})}}return s.get(M)||o}const d=1,p=2,m=3,S=4,w=[null,"isol","init","fina","medi"];function W(M){const _=new Uint8Array(M.length);let T=o,O=d,q=-1;for(let b=0;b<M.length;b++){const D=M.codePointAt(b);let U=h(D)|0,K=d;U&i||(T&(r|a|n)?U&(e|a|n)?(K=m,(O===d||O===m)&&_[q]++):U&(r|o)&&(O===p||O===S)&&_[q]--:T&(e|o)&&(O===p||O===S)&&_[q]--,O=_[b]=K,T=U,q=b,D>65535&&b++)}return _}function k(M,_){const T=[];for(let q=0;q<_.length;q++){const b=_.codePointAt(q);b>65535&&q++,T.push(u.U.codeToGlyph(M,b))}const O=M.GSUB;if(O){const{lookupList:q,featureList:b}=O;let D;const U=/^(rlig|liga|mset|isol|init|fina|medi|half|pres|blws|ccmp)$/,K=[];b.forEach(H=>{if(U.test(H.tag))for(let ie=0;ie<H.tab.length;ie++){if(K[H.tab[ie]])continue;K[H.tab[ie]]=!0;const ue=q[H.tab[ie]],X=/^(isol|init|fina|medi)$/.test(H.tag);X&&!D&&(D=W(_));for(let L=0;L<T.length;L++)(!D||!X||w[D[L]]===H.tag)&&u.U._applySubs(T,L,ue,q)}})}return T}function I(M,_){const T=new Int16Array(_.length*3);let O=0;for(;O<_.length;O++){const U=_[O];if(U===-1)continue;T[O*3+2]=M.hmtx.aWidth[U];const K=M.GPOS;if(K){const H=K.lookupList;for(let ie=0;ie<H.length;ie++){const ue=H[ie];for(let X=0;X<ue.tabs.length;X++){const L=ue.tabs[X];if(ue.ltype===1){if(u._lctf.coverageIndex(L.coverage,U)!==-1&&L.pos){D(L.pos,O);break}}else if(ue.ltype===2){let y=null,x=q();if(x!==-1){const R=u._lctf.coverageIndex(L.coverage,_[x]);if(R!==-1){if(L.fmt===1){const P=L.pairsets[R];for(let G=0;G<P.length;G++)P[G].gid2===U&&(y=P[G])}else if(L.fmt===2){const P=u.U._getGlyphClass(_[x],L.classDef1),G=u.U._getGlyphClass(U,L.classDef2);y=L.matrix[P][G]}if(y){y.val1&&D(y.val1,x),y.val2&&D(y.val2,O);break}}}}else if(ue.ltype===4){const y=u._lctf.coverageIndex(L.markCoverage,U);if(y!==-1){const x=q(b),R=x===-1?-1:u._lctf.coverageIndex(L.baseCoverage,_[x]);if(R!==-1){const P=L.markArray[y],G=L.baseArray[R][P.markClass];T[O*3]=G.x-P.x+T[x*3]-T[x*3+2],T[O*3+1]=G.y-P.y+T[x*3+1];break}}}else if(ue.ltype===6){const y=u._lctf.coverageIndex(L.mark1Coverage,U);if(y!==-1){const x=q();if(x!==-1){const R=_[x];if(E(M,R)===3){const P=u._lctf.coverageIndex(L.mark2Coverage,R);if(P!==-1){const G=L.mark1Array[y],V=L.mark2Array[P][G.markClass];T[O*3]=V.x-G.x+T[x*3]-T[x*3+2],T[O*3+1]=V.y-G.y+T[x*3+1];break}}}}}}}}else if(M.kern&&!M.cff){const H=q();if(H!==-1){const ie=M.kern.glyph1.indexOf(_[H]);if(ie!==-1){const ue=M.kern.rval[ie].glyph2.indexOf(U);ue!==-1&&(T[H*3+2]+=M.kern.rval[ie].vals[ue])}}}}return T;function q(U){for(let K=O-1;K>=0;K--)if(_[K]!==-1&&(!U||U(_[K])))return K;return-1}function b(U){return E(M,U)===1}function D(U,K){for(let H=0;H<3;H++)T[K*3+H]+=U[H]||0}}function E(M,_){const T=M.GDEF&&M.GDEF.glyphClassDef;return T?u.U._getGlyphClass(_,T):0}function C(...M){for(let _=0;_<M.length;_++)if(typeof M[_]=="number")return M[_]}function A(M){const _=Object.create(null),T=M["OS/2"],O=M.hhea,q=M.head.unitsPerEm,b=C(T&&T.sTypoAscender,O&&O.ascender,q),D={unitsPerEm:q,ascender:b,descender:C(T&&T.sTypoDescender,O&&O.descender,0),capHeight:C(T&&T.sCapHeight,b),xHeight:C(T&&T.sxHeight,b),lineGap:C(T&&T.sTypoLineGap,O&&O.lineGap),supportsCodePoint(U){return u.U.codeToGlyph(M,U)>0},forEachGlyph(U,K,H,ie){let ue=0;const X=1/D.unitsPerEm*K,L=k(M,U);let y=0;const x=I(M,L);return L.forEach((R,P)=>{if(R!==-1){let G=_[R];if(!G){const{cmds:V,crds:j}=u.U.glyphToPath(M,R);let Y="",le=0;for(let Te=0,ce=V.length;Te<ce;Te++){const pe=c[V[Te]];Y+=V[Te];for(let Ue=1;Ue<=pe;Ue++)Y+=(Ue>1?",":"")+j[le++]}let de,ae,$,Fe;if(j.length){de=ae=1/0,$=Fe=-1/0;for(let Te=0,ce=j.length;Te<ce;Te+=2){let pe=j[Te],Ue=j[Te+1];pe<de&&(de=pe),Ue<ae&&(ae=Ue),pe>$&&($=pe),Ue>Fe&&(Fe=Ue)}}else de=$=ae=Fe=0;G=_[R]={index:R,advanceWidth:M.hmtx.aWidth[R],xMin:de,yMin:ae,xMax:$,yMax:Fe,path:Y}}ie.call(null,G,ue+x[P*3]*X,x[P*3+1]*X,y),ue+=x[P*3+2]*X,H&&(ue+=H*K)}y+=U.codePointAt(y)>65535?2:1}),ue}};return D}return function(_){const T=new Uint8Array(_,0,4),O=u._bin.readASCII(T,0,4);if(O==="wOFF")_=t(_);else if(O==="wOF2")throw new Error("woff2 fonts not supported");return A(u.parse(_)[0])}}const Vo=et({name:"Typr Font Parser",dependencies:[zo,Wo,Ho],init(u,t,c){const f=u(),r=t();return c(f,r)}});function jo(){return(function(u){var t=function(){this.buckets=new Map};t.prototype.add=function(I){var E=I>>5;this.buckets.set(E,(this.buckets.get(E)||0)|1<<(31&I))},t.prototype.has=function(I){var E=this.buckets.get(I>>5);return E!==void 0&&(E&1<<(31&I))!=0},t.prototype.serialize=function(){var I=[];return this.buckets.forEach((function(E,C){I.push((+C).toString(36)+":"+E.toString(36))})),I.join(",")},t.prototype.deserialize=function(I){var E=this;this.buckets.clear(),I.split(",").forEach((function(C){var A=C.split(":");E.buckets.set(parseInt(A[0],36),parseInt(A[1],36))}))};var c=Math.pow(2,8),f=c-1,r=~f;function e(I){var E=(function(A){return A&r})(I).toString(16),C=(function(A){return(A&r)+c-1})(I).toString(16);return"codepoint-index/plane"+(I>>16)+"/"+E+"-"+C+".json"}function a(I,E){var C=I&f,A=E.codePointAt(C/6|0);return((A=(A||48)-48)&1<<C%6)!=0}function i(I,E){var C;(C=I,C.replace(/U\+/gi,"").replace(/^,+|,+$/g,"").split(/,+/).map((function(A){return A.split("-").map((function(M){return parseInt(M.trim(),16)}))}))).forEach((function(A){var M=A[0],_=A[1];_===void 0&&(_=M),E(M,_)}))}function n(I,E){i(I,(function(C,A){for(var M=C;M<=A;M++)E(M)}))}var o={},s={},h=new WeakMap,d="https://cdn.jsdelivr.net/gh/lojjic/unicode-font-resolver@v1.0.1/packages/data";function p(I){var E=h.get(I);return E||(E=new t,n(I.ranges,(function(C){return E.add(C)})),h.set(I,E)),E}var m,S=new Map;function w(I,E,C){return I[E]?E:I[C]?C:(function(A){for(var M in A)return M})(I)}function W(I,E){var C=E;if(!I.includes(C)){C=1/0;for(var A=0;A<I.length;A++)Math.abs(I[A]-E)<Math.abs(C-E)&&(C=I[A])}return C}function k(I){return m||(m=new Set,n("9-D,20,85,A0,1680,2000-200A,2028-202F,205F,3000",(function(E){m.add(E)}))),m.has(I)}return u.CodePointSet=t,u.clearCache=function(){o={},s={}},u.getFontsForString=function(I,E){E===void 0&&(E={});var C,A=E.lang;A===void 0&&(A=new RegExp("\\p{Script=Hangul}","u").test(C=I)?"ko":new RegExp("\\p{Script=Hiragana}|\\p{Script=Katakana}","u").test(C)?"ja":"en");var M=E.category;M===void 0&&(M="sans-serif");var _=E.style;_===void 0&&(_="normal");var T=E.weight;T===void 0&&(T=400);var O=(E.dataUrl||d).replace(/\/$/g,""),q=new Map,b=new Uint8Array(I.length),D={},U={},K=new Array(I.length),H=new Map,ie=!1;function ue(y){var x=S.get(y);return x||(x=fetch(O+"/"+y).then((function(R){if(!R.ok)throw new Error(R.statusText);return R.json().then((function(P){if(!Array.isArray(P)||P[0]!==1)throw new Error("Incorrect schema version; need 1, got "+P[0]);return P[1]}))})).catch((function(R){if(O!==d)return ie||(console.error('unicode-font-resolver: Failed loading from dataUrl "'+O+'", trying default CDN. '+R.message),ie=!0),O=d,S.delete(y),ue(y);throw R})),S.set(y,x)),x}for(var X=function(y){var x=I.codePointAt(y),R=e(x);K[y]=R,o[R]||H.has(R)||H.set(R,ue(R).then((function(P){o[R]=P}))),x>65535&&(y++,L=y)},L=0;L<I.length;L++)X(L);return Promise.all(H.values()).then((function(){H.clear();for(var y=function(R){var P=I.codePointAt(R),G=null,V=o[K[R]],j=void 0;for(var Y in V){var le=U[Y];if(le===void 0&&(le=U[Y]=new RegExp(Y).test(A||"en")),le){for(var de in j=Y,V[Y])if(a(P,V[Y][de])){G=de;break}break}}if(!G){e:for(var ae in V)if(ae!==j){for(var $ in V[ae])if(a(P,V[ae][$])){G=$;break e}}}G||(console.debug("No font coverage for U+"+P.toString(16)),G="latin"),K[R]=G,s[G]||H.has(G)||H.set(G,ue("font-meta/"+G+".json").then((function(Fe){s[G]=Fe}))),P>65535&&(R++,x=R)},x=0;x<I.length;x++)y(x);return Promise.all(H.values())})).then((function(){for(var y,x=null,R=0;R<I.length;R++){var P=I.codePointAt(R);if(x&&(k(P)||p(x).has(P)))b[R]=b[R-1];else{x=s[K[R]];var G=D[x.id];if(!G){var V=x.typeforms,j=w(V,M,"sans-serif"),Y=w(V[j],_,"normal"),le=W((y=V[j])===null||y===void 0?void 0:y[Y],T);G=D[x.id]=O+"/font-files/"+x.id+"/"+j+"."+Y+"."+le+".woff"}var de=q.get(G);de==null&&(de=q.size,q.set(G,de)),b[R]=de}P>65535&&(R++,b[R]=b[R-1])}return{fontUrls:Array.from(q.keys()),chars:b}}))},Object.defineProperty(u,"__esModule",{value:!0}),u})({})}function Xo(u,t){const c=Object.create(null),f=Object.create(null);function r(a,i){const n=o=>{console.error(`Failure loading font ${a}`,o)};try{const o=new XMLHttpRequest;o.open("get",a,!0),o.responseType="arraybuffer",o.onload=function(){if(o.status>=400)n(new Error(o.statusText));else if(o.status>0)try{const s=u(o.response);s.src=a,i(s)}catch(s){n(s)}},o.onerror=n,o.send()}catch(o){n(o)}}function e(a,i){let n=c[a];n?i(n):f[a]?f[a].push(i):(f[a]=[i],r(a,o=>{o.src=a,c[a]=o,f[a].forEach(s=>s(o)),delete f[a]}))}return function(a,i,{lang:n,fonts:o=[],style:s="normal",weight:h="normal",unicodeFontsURL:d}={}){const p=new Uint8Array(a.length),m=[];a.length||k();const S=new Map,w=[];if(s!=="italic"&&(s="normal"),typeof h!="number"&&(h=h==="bold"?700:400),o&&!Array.isArray(o)&&(o=[o]),o=o.slice().filter(E=>!E.lang||E.lang.test(n)).reverse(),o.length){let M=0;(function _(T=0){for(let O=T,q=a.length;O<q;O++){const b=a.codePointAt(O);if(M===1&&m[p[O-1]].supportsCodePoint(b)||O>0&&/\s/.test(a[O]))p[O]=p[O-1],M===2&&(w[w.length-1][1]=O);else for(let D=p[O],U=o.length;D<=U;D++)if(D===U){const K=M===2?w[w.length-1]:w[w.length]=[O,O];K[1]=O,M=2}else{p[O]=D;const{src:K,unicodeRange:H}=o[D];if(!H||I(b,H)){const ie=c[K];if(!ie){e(K,()=>{_(O)});return}if(ie.supportsCodePoint(b)){let ue=S.get(ie);typeof ue!="number"&&(ue=m.length,m.push(ie),S.set(ie,ue)),p[O]=ue,M=1;break}}}b>65535&&O+1<q&&(p[O+1]=p[O],O++,M===2&&(w[w.length-1][1]=O))}W()})()}else w.push([0,a.length-1]),W();function W(){if(w.length){const E=w.map(C=>a.substring(C[0],C[1]+1)).join(`
`);t.getFontsForString(E,{lang:n||void 0,style:s,weight:h,dataUrl:d}).then(({fontUrls:C,chars:A})=>{const M=m.length;let _=0;w.forEach(O=>{for(let q=0,b=O[1]-O[0];q<=b;q++)p[O[0]+q]=A[_++]+M;_++});let T=0;C.forEach((O,q)=>{e(O,b=>{m[q+M]=b,++T===C.length&&k()})})})}else k()}function k(){i({chars:p,fonts:m})}function I(E,C){for(let A=0;A<C.length;A++){const[M,_=M]=C[A];if(M<=E&&E<=_)return!0}return!1}}}const Zo=et({name:"FontResolver",dependencies:[Xo,Vo,jo],init(u,t,c){return u(t,c())}});function Yo(u,t){const f=/[\u00AD\u034F\u061C\u115F-\u1160\u17B4-\u17B5\u180B-\u180E\u200B-\u200F\u202A-\u202E\u2060-\u206F\u3164\uFE00-\uFE0F\uFEFF\uFFA0\uFFF0-\uFFF8]/,r="[^\\S\\u00A0]",e=new RegExp(`${r}|[\\-\\u007C\\u00AD\\u2010\\u2012-\\u2014\\u2027\\u2056\\u2E17\\u2E40]`);function a({text:m,lang:S,fonts:w,style:W,weight:k,preResolvedFonts:I,unicodeFontsURL:E},C){const A=({chars:M,fonts:_})=>{let T,O;const q=[];for(let b=0;b<M.length;b++)M[b]!==O?(O=M[b],q.push(T={start:b,end:b,fontObj:_[M[b]]})):T.end=b;C(q)};I?A(I):u(m,A,{lang:S,fonts:w,style:W,weight:k,unicodeFontsURL:E})}function i({text:m="",font:S,lang:w,sdfGlyphSize:W=64,fontSize:k=400,fontWeight:I=1,fontStyle:E="normal",letterSpacing:C=0,lineHeight:A="normal",maxWidth:M=1/0,direction:_,textAlign:T="left",textIndent:O=0,whiteSpace:q="normal",overflowWrap:b="normal",anchorX:D=0,anchorY:U=0,metricsOnly:K=!1,unicodeFontsURL:H,preResolvedFonts:ie=null,includeCaretPositions:ue=!1,chunkedBoundsSize:X=8192,colorRanges:L=null},y){const x=h(),R={fontLoad:0,typesetting:0};m.indexOf("\r")>-1&&(console.info("Typesetter: got text with \\r chars; normalizing to \\n"),m=m.replace(/\r\n/g,`
`).replace(/\r/g,`
`)),k=+k,C=+C,M=+M,A=A||"normal",O=+O,a({text:m,lang:w,style:E,weight:I,fonts:typeof S=="string"?[{src:S}]:S,unicodeFontsURL:H,preResolvedFonts:ie},P=>{R.fontLoad=h()-x;const G=isFinite(M);let V=null,j=null,Y=null,le=null,de=null,ae=null,$=null,Fe=null,Te=0,ce=0,pe=q!=="nowrap";const Ue=new Map,re=h();let ge=O,he=0,J=new d;const ke=[J];P.forEach(me=>{const{fontObj:ye}=me,{ascender:be,descender:Ae,unitsPerEm:Ke,lineGap:er,capHeight:De,xHeight:xe}=ye;let Se=Ue.get(ye);if(!Se){const Z=k/Ke,Ge=A==="normal"?(be-Ae+er)*Z:A*k,Ir=(Ge-(be-Ae)*Z)/2,je=Math.min(Ge,(be-Ae)*Z),Be=(be+Ae)/2*Z+je/2;Se={index:Ue.size,src:ye.src,fontObj:ye,fontSizeMult:Z,unitsPerEm:Ke,ascender:be*Z,descender:Ae*Z,capHeight:De*Z,xHeight:xe*Z,lineHeight:Ge,baseline:-Ir-be*Z,caretTop:Be,caretBottom:Be-je},Ue.set(ye,Se)}const{fontSizeMult:Xe}=Se,Le=m.slice(me.start,me.end+1);let Ne,Je;ye.forEachGlyph(Le,k,C,(Z,Ge,Ir,je)=>{Ge+=he,je+=me.start,Ne=Ge,Je=Z;const Be=m.charAt(je),nr=Z.advanceWidth*Xe,qe=J.count;let Ie;if("isEmpty"in Z||(Z.isWhitespace=!!Be&&new RegExp(r).test(Be),Z.canBreakAfter=!!Be&&e.test(Be),Z.isEmpty=Z.xMin===Z.xMax||Z.yMin===Z.yMax||f.test(Be)),!Z.isWhitespace&&!Z.isEmpty&&ce++,pe&&G&&!Z.isWhitespace&&Ge+nr+ge>M&&qe){if(J.glyphAt(qe-1).glyphObj.canBreakAfter)Ie=new d,ge=-Ge;else for(let hr=qe;hr--;)if(hr===0&&b==="break-word"){Ie=new d,ge=-Ge;break}else if(J.glyphAt(hr).glyphObj.canBreakAfter){Ie=J.splitAt(hr+1);const ur=Ie.glyphAt(0).x;ge-=ur;for(let ar=Ie.count;ar--;)Ie.glyphAt(ar).x-=ur;break}Ie&&(J.isSoftWrapped=!0,J=Ie,ke.push(J),Te=M)}let $e=J.glyphAt(J.count);$e.glyphObj=Z,$e.x=Ge+ge,$e.y=Ir,$e.width=nr,$e.charIndex=je,$e.fontData=Se,Be===`
`&&(J=new d,ke.push(J),ge=-(Ge+nr+C*k)+O)}),he=Ne+Je.advanceWidth*Xe+C*k});let fe=0;ke.forEach(me=>{let ye=!0;for(let be=me.count;be--;){const Ae=me.glyphAt(be);ye&&!Ae.glyphObj.isWhitespace&&(me.width=Ae.x+Ae.width,me.width>Te&&(Te=me.width),ye=!1);let{lineHeight:Ke,capHeight:er,xHeight:De,baseline:xe}=Ae.fontData;Ke>me.lineHeight&&(me.lineHeight=Ke);const Se=xe-me.baseline;Se<0&&(me.baseline+=Se,me.cap+=Se,me.ex+=Se),me.cap=Math.max(me.cap,me.baseline+er),me.ex=Math.max(me.ex,me.baseline+De)}me.baseline-=fe,me.cap-=fe,me.ex-=fe,fe+=me.lineHeight});let we=0,se=0;if(D&&(typeof D=="number"?we=-D:typeof D=="string"&&(we=-Te*(D==="left"?0:D==="center"?.5:D==="right"?1:o(D)))),U&&(typeof U=="number"?se=-U:typeof U=="string"&&(se=U==="top"?0:U==="top-baseline"?-ke[0].baseline:U==="top-cap"?-ke[0].cap:U==="top-ex"?-ke[0].ex:U==="middle"?fe/2:U==="bottom"?fe:U==="bottom-baseline"?-ke[ke.length-1].baseline:o(U)*fe)),!K){const me=t.getEmbeddingLevels(m,_);V=new Uint16Array(ce),j=new Uint8Array(ce),Y=new Float32Array(ce*2),le={},$=[1/0,1/0,-1/0,-1/0],Fe=[],ue&&(ae=new Float32Array(m.length*4)),L&&(de=new Uint8Array(ce*3));let ye=0,be=-1,Ae=-1,Ke,er;if(ke.forEach((De,xe)=>{let{count:Se,width:Xe}=De;if(Se>0){let Le=0;for(let je=Se;je--&&De.glyphAt(je).glyphObj.isWhitespace;)Le++;let Ne=0,Je=0;if(T==="center")Ne=(Te-Xe)/2;else if(T==="right")Ne=Te-Xe;else if(T==="justify"&&De.isSoftWrapped){let je=0;for(let Be=Se-Le;Be--;)De.glyphAt(Be).glyphObj.isWhitespace&&je++;Je=(Te-Xe)/je}if(Je||Ne){let je=0;for(let Be=0;Be<Se;Be++){let nr=De.glyphAt(Be);const qe=nr.glyphObj;nr.x+=Ne+je,Je!==0&&qe.isWhitespace&&Be<Se-Le&&(je+=Je,nr.width+=Je)}}const Z=t.getReorderSegments(m,me,De.glyphAt(0).charIndex,De.glyphAt(De.count-1).charIndex);for(let je=0;je<Z.length;je++){const[Be,nr]=Z[je];let qe=1/0,Ie=-1/0;for(let $e=0;$e<Se;$e++)if(De.glyphAt($e).charIndex>=Be){let hr=$e,ur=$e;for(;ur<Se;ur++){let ar=De.glyphAt(ur);if(ar.charIndex>nr)break;ur<Se-Le&&(qe=Math.min(qe,ar.x),Ie=Math.max(Ie,ar.x+ar.width))}for(let ar=hr;ar<ur;ar++){const _r=De.glyphAt(ar);_r.x=Ie-(_r.x+_r.width-qe)}break}}let Ge;const Ir=je=>Ge=je;for(let je=0;je<Se;je++){const Be=De.glyphAt(je);Ge=Be.glyphObj;const nr=Ge.index,qe=me.levels[Be.charIndex]&1;if(qe){const Ie=t.getMirroredCharacter(m[Be.charIndex]);Ie&&Be.fontData.fontObj.forEachGlyph(Ie,0,0,Ir)}if(ue){const{charIndex:Ie,fontData:$e}=Be,hr=Be.x+we,ur=Be.x+Be.width+we;ae[Ie*4]=qe?ur:hr,ae[Ie*4+1]=qe?hr:ur,ae[Ie*4+2]=De.baseline+$e.caretBottom+se,ae[Ie*4+3]=De.baseline+$e.caretTop+se;const ar=Ie-be;ar>1&&s(ae,be,ar),be=Ie}if(L){const{charIndex:Ie}=Be;for(;Ie>Ae;)Ae++,L.hasOwnProperty(Ae)&&(er=L[Ae])}if(!Ge.isWhitespace&&!Ge.isEmpty){const Ie=ye++,{fontSizeMult:$e,src:hr,index:ur}=Be.fontData,ar=le[hr]||(le[hr]={});ar[nr]||(ar[nr]={path:Ge.path,pathBounds:[Ge.xMin,Ge.yMin,Ge.xMax,Ge.yMax]});const _r=Be.x+we,wr=Be.y+De.baseline+se;Y[Ie*2]=_r,Y[Ie*2+1]=wr;const Cr=_r+Ge.xMin*$e,pr=wr+Ge.yMin*$e,br=_r+Ge.xMax*$e,Ce=wr+Ge.yMax*$e;Cr<$[0]&&($[0]=Cr),pr<$[1]&&($[1]=pr),br>$[2]&&($[2]=br),Ce>$[3]&&($[3]=Ce),Ie%X===0&&(Ke={start:Ie,end:Ie,rect:[1/0,1/0,-1/0,-1/0]},Fe.push(Ke)),Ke.end++;const fr=Ke.rect;if(Cr<fr[0]&&(fr[0]=Cr),pr<fr[1]&&(fr[1]=pr),br>fr[2]&&(fr[2]=br),Ce>fr[3]&&(fr[3]=Ce),V[Ie]=nr,j[Ie]=ur,L){const Rr=Ie*3;de[Rr]=er>>16&255,de[Rr+1]=er>>8&255,de[Rr+2]=er&255}}}}}),ae){const De=m.length-be;De>1&&s(ae,be,De)}}const Pe=[];Ue.forEach(({index:me,src:ye,unitsPerEm:be,ascender:Ae,descender:Ke,lineHeight:er,capHeight:De,xHeight:xe})=>{Pe[me]={src:ye,unitsPerEm:be,ascender:Ae,descender:Ke,lineHeight:er,capHeight:De,xHeight:xe}}),R.typesetting=h()-re,y({glyphIds:V,glyphFontIndices:j,glyphPositions:Y,glyphData:le,fontData:Pe,caretPositions:ae,glyphColors:de,chunkedBounds:Fe,fontSize:k,topBaseline:se+ke[0].baseline,blockBounds:[we,se-fe,we+Te,se],visibleBounds:$,timings:R})})}function n(m,S){i({...m,metricsOnly:!0},w=>{const[W,k,I,E]=w.blockBounds;S({width:I-W,height:E-k})})}function o(m){let S=m.match(/^([\d.]+)%$/),w=S?parseFloat(S[1]):NaN;return isNaN(w)?0:w/100}function s(m,S,w){const W=m[S*4],k=m[S*4+1],I=m[S*4+2],E=m[S*4+3],C=(k-W)/w;for(let A=0;A<w;A++){const M=(S+A)*4;m[M]=W+C*A,m[M+1]=W+C*(A+1),m[M+2]=I,m[M+3]=E}}function h(){return(self.performance||Date).now()}function d(){this.data=[]}const p=["glyphObj","x","y","width","charIndex","fontData"];return d.prototype={width:0,lineHeight:0,baseline:0,cap:0,ex:0,isSoftWrapped:!1,get count(){return Math.ceil(this.data.length/p.length)},glyphAt(m){let S=d.flyweight;return S.data=this.data,S.index=m,S},splitAt(m){let S=new d;return S.data=this.data.splice(m*p.length),S}},d.flyweight=p.reduce((m,S,w,W)=>(Object.defineProperty(m,S,{get(){return this.data[this.index*p.length+w]},set(k){this.data[this.index*p.length+w]=k}}),m),{data:null,index:0}),{typeset:i,measure:n}}const Xr=()=>(self.performance||Date).now(),Gt=ha();let zn;function Ko(u,t,c,f,r,e,a,i,n,o,s=!0){return s?Qo(u,t,c,f,r,e,a,i,n,o).then(null,h=>(zn||(console.warn("WebGL SDF generation failed, falling back to JS",h),zn=!0),Hn(u,t,c,f,r,e,a,i,n,o))):Hn(u,t,c,f,r,e,a,i,n,o)}const Dt=[],Jo=5;let fn=0;function va(){const u=Xr();for(;Dt.length&&Xr()-u<Jo;)Dt.shift()();fn=Dt.length?setTimeout(va,0):0}const Qo=(...u)=>new Promise((t,c)=>{Dt.push(()=>{const f=Xr();try{Gt.webgl.generateIntoCanvas(...u),t({timing:Xr()-f})}catch(r){c(r)}}),fn||(fn=setTimeout(va,0))}),qo=4,$o=2e3,Wn={};let ei=0;function Hn(u,t,c,f,r,e,a,i,n,o){const s="TroikaTextSDFGenerator_JS_"+ei++%qo;let h=Wn[s];return h||(h=Wn[s]={workerModule:et({name:s,workerId:s,dependencies:[ha,Xr],init(d,p){const m=d().javascript.generate;return function(...S){const w=p();return{textureData:m(...S),timing:p()-w}}},getTransferables(d){return[d.textureData.buffer]}}),requests:0,idleTimer:null}),h.requests++,clearTimeout(h.idleTimer),h.workerModule(u,t,c,f,r,e).then(({textureData:d,timing:p})=>{const m=Xr(),S=new Uint8Array(d.length*4);for(let w=0;w<d.length;w++)S[w*4+o]=d[w];return Gt.webglUtils.renderImageData(a,S,i,n,u,t,1<<3-o),p+=Xr()-m,--h.requests===0&&(h.idleTimer=setTimeout(()=>{Ao(s)},$o)),{timing:p}})}function ri(u){u._warm||(Gt.webgl.isSupported(u),u._warm=!0)}const ti=Gt.webglUtils.resizeWebGLCanvasWithoutClearing,ct={unicodeFontsURL:null,sdfGlyphSize:64,sdfMargin:1/16,sdfExponent:9,textureWidth:2048},ni=new yt;function Jr(){return(self.performance||Date).now()}const Vn=Object.create(null);function pa(u,t){u=ii({},u);const c=Jr(),f=[];if(u.font&&f.push({label:"user",src:si(u.font)}),u.font=f,u.text=""+u.text,u.sdfGlyphSize=u.sdfGlyphSize||ct.sdfGlyphSize,u.unicodeFontsURL=u.unicodeFontsURL||ct.unicodeFontsURL,u.colorRanges!=null){let d={};for(let p in u.colorRanges)if(u.colorRanges.hasOwnProperty(p)){let m=u.colorRanges[p];typeof m!="number"&&(m=ni.set(m).getHex()),d[p]=m}u.colorRanges=d}Object.freeze(u);const{textureWidth:r,sdfExponent:e}=ct,{sdfGlyphSize:a}=u,i=r/a*4;let n=Vn[a];if(!n){const d=document.createElement("canvas");d.width=r,d.height=a*256/i,n=Vn[a]={glyphCount:0,sdfGlyphSize:a,sdfCanvas:d,sdfTexture:new jr(d,void 0,void 0,void 0,Mr,Mr),contextLost:!1,glyphsByFont:new Map},n.sdfTexture.generateMipmaps=!1,ai(n)}const{sdfTexture:o,sdfCanvas:s}=n;ya(u).then(d=>{const{glyphIds:p,glyphFontIndices:m,fontData:S,glyphPositions:w,fontSize:W,timings:k}=d,I=[],E=new Float32Array(p.length*4);let C=0,A=0;const M=Jr(),_=S.map(D=>{let U=n.glyphsByFont.get(D.src);return U||n.glyphsByFont.set(D.src,U=new Map),U});p.forEach((D,U)=>{const K=m[U],{src:H,unitsPerEm:ie}=S[K];let ue=_[K].get(D);if(!ue){const{path:R,pathBounds:P}=d.glyphData[H][D],G=Math.max(P[2]-P[0],P[3]-P[1])/a*(ct.sdfMargin*a+.5),V=n.glyphCount++,j=[P[0]-G,P[1]-G,P[2]+G,P[3]+G];_[K].set(D,ue={path:R,atlasIndex:V,sdfViewBox:j}),I.push(ue)}const{sdfViewBox:X}=ue,L=w[A++],y=w[A++],x=W/ie;E[C++]=L+X[0]*x,E[C++]=y+X[1]*x,E[C++]=L+X[2]*x,E[C++]=y+X[3]*x,p[U]=ue.atlasIndex}),k.quads=(k.quads||0)+(Jr()-M);const T=Jr();k.sdf={};const O=s.height,q=Math.ceil(n.glyphCount/i),b=Math.pow(2,Math.ceil(Math.log2(q*a)));b>O&&(console.info(`Increasing SDF texture size ${O}->${b}`),ti(s,r,b),o.dispose()),Promise.all(I.map(D=>ga(D,n,u.gpuAccelerateSDF).then(({timing:U})=>{k.sdf[D.atlasIndex]=U}))).then(()=>{I.length&&!n.contextLost&&(ma(n),o.needsUpdate=!0),k.sdfTotal=Jr()-T,k.total=Jr()-c,t(Object.freeze({parameters:u,sdfTexture:o,sdfGlyphSize:a,sdfExponent:e,glyphBounds:E,glyphAtlasIndices:p,glyphColors:d.glyphColors,caretPositions:d.caretPositions,chunkedBounds:d.chunkedBounds,ascender:d.ascender,descender:d.descender,lineHeight:d.lineHeight,capHeight:d.capHeight,xHeight:d.xHeight,topBaseline:d.topBaseline,blockBounds:d.blockBounds,visibleBounds:d.visibleBounds,timings:d.timings}))})}),Promise.resolve().then(()=>{n.contextLost||ri(s)})}function ga({path:u,atlasIndex:t,sdfViewBox:c},{sdfGlyphSize:f,sdfCanvas:r,contextLost:e},a){if(e)return Promise.resolve({timing:-1});const{textureWidth:i,sdfExponent:n}=ct,o=Math.max(c[2]-c[0],c[3]-c[1]),s=Math.floor(t/4),h=s%(i/f)*f,d=Math.floor(s/(i/f))*f,p=t%4;return Ko(f,f,u,c,o,n,r,h,d,p,a)}function ai(u){const t=u.sdfCanvas;t.addEventListener("webglcontextlost",c=>{console.log("Context Lost",c),c.preventDefault(),u.contextLost=!0}),t.addEventListener("webglcontextrestored",c=>{console.log("Context Restored",c),u.contextLost=!1;const f=[];u.glyphsByFont.forEach(r=>{r.forEach(e=>{f.push(ga(e,u,!0))})}),Promise.all(f).then(()=>{ma(u),u.sdfTexture.needsUpdate=!0})})}function oi({font:u,characters:t,sdfGlyphSize:c},f){let r=Array.isArray(t)?t.join(`
`):""+t;pa({font:u,sdfGlyphSize:c,text:r},f)}function ii(u,t){for(let c in t)t.hasOwnProperty(c)&&(u[c]=t[c]);return u}let Mt;function si(u){return Mt||(Mt=typeof document>"u"?{}:document.createElement("a")),Mt.href=u,Mt.href}function ma(u){if(typeof createImageBitmap!="function"){console.info("Safari<15: applying SDF canvas workaround");const{sdfCanvas:t,sdfTexture:c}=u,{width:f,height:r}=t,e=u.sdfCanvas.getContext("webgl");let a=c.image.data;(!a||a.length!==f*r*4)&&(a=new Uint8Array(f*r*4),c.image={width:f,height:r,data:a},c.flipY=!1,c.isDataTexture=!0),e.readPixels(0,0,f,r,e.RGBA,e.UNSIGNED_BYTE,a)}}const li=et({name:"Typesetter",dependencies:[Yo,Zo,Io],init(u,t,c){return u(t,c())}}),ya=et({name:"Typesetter",dependencies:[li],init(u){return function(t){return new Promise(c=>{u.typeset(t,c)})}},getTransferables(u){const t=[];for(let c in u)u[c]&&u[c].buffer&&t.push(u[c].buffer);return t}});ya.onMainThread;const jn={};function ui(u){let t=jn[u];return t||(t=jn[u]=new $r(1,1,u,u).translate(.5,.5,0)),t}const fi="aTroikaGlyphBounds",Xn="aTroikaGlyphIndex",ci="aTroikaGlyphColor";class hi extends Wa{constructor(){super(),this.detail=1,this.curveRadius=0,this.groups=[{start:0,count:1/0,materialIndex:0},{start:0,count:1/0,materialIndex:1}],this.boundingSphere=new Ha,this.boundingBox=new ta}computeBoundingSphere(){}computeBoundingBox(){}set detail(t){if(t!==this._detail){this._detail=t,(typeof t!="number"||t<1)&&(t=1);let c=ui(t);["position","normal","uv"].forEach(f=>{this.attributes[f]=c.attributes[f].clone()}),this.setIndex(c.getIndex().clone())}}get detail(){return this._detail}set curveRadius(t){t!==this._curveRadius&&(this._curveRadius=t,this._updateBounds())}get curveRadius(){return this._curveRadius}updateGlyphs(t,c,f,r,e){this.updateAttributeData(fi,t,4),this.updateAttributeData(Xn,c,1),this.updateAttributeData(ci,e,3),this._blockBounds=f,this._chunkedBounds=r,this.instanceCount=c.length,this._updateBounds()}_updateBounds(){const t=this._blockBounds;if(t){const{curveRadius:c,boundingBox:f}=this;if(c){const{PI:r,floor:e,min:a,max:i,sin:n,cos:o}=Math,s=r/2,h=r*2,d=Math.abs(c),p=t[0]/d,m=t[2]/d,S=e((p+s)/h)!==e((m+s)/h)?-d:a(n(p)*d,n(m)*d),w=e((p-s)/h)!==e((m-s)/h)?d:i(n(p)*d,n(m)*d),W=e((p+r)/h)!==e((m+r)/h)?d*2:i(d-o(p)*d,d-o(m)*d);f.min.set(S,t[1],c<0?-W:0),f.max.set(w,t[3],c<0?0:W)}else f.min.set(t[0],t[1],0),f.max.set(t[2],t[3],0);f.getBoundingSphere(this.boundingSphere)}}applyClipRect(t){let c=this.getAttribute(Xn).count,f=this._chunkedBounds;if(f)for(let r=f.length;r--;){c=f[r].end;let e=f[r].rect;if(e[1]<t.w&&e[3]>t.y&&e[0]<t.z&&e[2]>t.x)break}this.instanceCount=c}updateAttributeData(t,c,f){const r=this.getAttribute(t);c?r&&r.array.length===c.length?(r.array.set(c),r.needsUpdate=!0):(this.setAttribute(t,new Va(c,f)),delete this._maxInstanceCount,this.dispose()):r&&this.deleteAttribute(t)}}const di=`
uniform vec2 uTroikaSDFTextureSize;
uniform float uTroikaSDFGlyphSize;
uniform vec4 uTroikaTotalBounds;
uniform vec4 uTroikaClipRect;
uniform mat3 uTroikaOrient;
uniform bool uTroikaUseGlyphColors;
uniform float uTroikaEdgeOffset;
uniform float uTroikaBlurRadius;
uniform vec2 uTroikaPositionOffset;
uniform float uTroikaCurveRadius;
attribute vec4 aTroikaGlyphBounds;
attribute float aTroikaGlyphIndex;
attribute vec3 aTroikaGlyphColor;
varying vec2 vTroikaGlyphUV;
varying vec4 vTroikaTextureUVBounds;
varying float vTroikaTextureChannel;
varying vec3 vTroikaGlyphColor;
varying vec2 vTroikaGlyphDimensions;
`,vi=`
vec4 bounds = aTroikaGlyphBounds;
bounds.xz += uTroikaPositionOffset.x;
bounds.yw -= uTroikaPositionOffset.y;

vec4 outlineBounds = vec4(
  bounds.xy - uTroikaEdgeOffset - uTroikaBlurRadius,
  bounds.zw + uTroikaEdgeOffset + uTroikaBlurRadius
);
vec4 clippedBounds = vec4(
  clamp(outlineBounds.xy, uTroikaClipRect.xy, uTroikaClipRect.zw),
  clamp(outlineBounds.zw, uTroikaClipRect.xy, uTroikaClipRect.zw)
);

vec2 clippedXY = (mix(clippedBounds.xy, clippedBounds.zw, position.xy) - bounds.xy) / (bounds.zw - bounds.xy);

position.xy = mix(bounds.xy, bounds.zw, clippedXY);

uv = (position.xy - uTroikaTotalBounds.xy) / (uTroikaTotalBounds.zw - uTroikaTotalBounds.xy);

float rad = uTroikaCurveRadius;
if (rad != 0.0) {
  float angle = position.x / rad;
  position.xz = vec2(sin(angle) * rad, rad - cos(angle) * rad);
  normal.xz = vec2(sin(angle), cos(angle));
}
  
position = uTroikaOrient * position;
normal = uTroikaOrient * normal;

vTroikaGlyphUV = clippedXY.xy;
vTroikaGlyphDimensions = vec2(bounds[2] - bounds[0], bounds[3] - bounds[1]);


float txCols = uTroikaSDFTextureSize.x / uTroikaSDFGlyphSize;
vec2 txUvPerSquare = uTroikaSDFGlyphSize / uTroikaSDFTextureSize;
vec2 txStartUV = txUvPerSquare * vec2(
  mod(floor(aTroikaGlyphIndex / 4.0), txCols),
  floor(floor(aTroikaGlyphIndex / 4.0) / txCols)
);
vTroikaTextureUVBounds = vec4(txStartUV, vec2(txStartUV) + txUvPerSquare);
vTroikaTextureChannel = mod(aTroikaGlyphIndex, 4.0);
`,pi=`
uniform sampler2D uTroikaSDFTexture;
uniform vec2 uTroikaSDFTextureSize;
uniform float uTroikaSDFGlyphSize;
uniform float uTroikaSDFExponent;
uniform float uTroikaEdgeOffset;
uniform float uTroikaFillOpacity;
uniform float uTroikaBlurRadius;
uniform vec3 uTroikaStrokeColor;
uniform float uTroikaStrokeWidth;
uniform float uTroikaStrokeOpacity;
uniform bool uTroikaSDFDebug;
varying vec2 vTroikaGlyphUV;
varying vec4 vTroikaTextureUVBounds;
varying float vTroikaTextureChannel;
varying vec2 vTroikaGlyphDimensions;

float troikaSdfValueToSignedDistance(float alpha) {
  // Inverse of exponential encoding in webgl-sdf-generator
  
  float maxDimension = max(vTroikaGlyphDimensions.x, vTroikaGlyphDimensions.y);
  float absDist = (1.0 - pow(2.0 * (alpha > 0.5 ? 1.0 - alpha : alpha), 1.0 / uTroikaSDFExponent)) * maxDimension;
  float signedDist = absDist * (alpha > 0.5 ? -1.0 : 1.0);
  return signedDist;
}

float troikaGlyphUvToSdfValue(vec2 glyphUV) {
  vec2 textureUV = mix(vTroikaTextureUVBounds.xy, vTroikaTextureUVBounds.zw, glyphUV);
  vec4 rgba = texture2D(uTroikaSDFTexture, textureUV);
  float ch = floor(vTroikaTextureChannel + 0.5); //NOTE: can't use round() in WebGL1
  return ch == 0.0 ? rgba.r : ch == 1.0 ? rgba.g : ch == 2.0 ? rgba.b : rgba.a;
}

float troikaGlyphUvToDistance(vec2 uv) {
  return troikaSdfValueToSignedDistance(troikaGlyphUvToSdfValue(uv));
}

float troikaGetAADist() {
  
  #if defined(GL_OES_standard_derivatives) || __VERSION__ >= 300
  return length(fwidth(vTroikaGlyphUV * vTroikaGlyphDimensions)) * 0.5;
  #else
  return vTroikaGlyphDimensions.x / 64.0;
  #endif
}

float troikaGetFragDistValue() {
  vec2 clampedGlyphUV = clamp(vTroikaGlyphUV, 0.5 / uTroikaSDFGlyphSize, 1.0 - 0.5 / uTroikaSDFGlyphSize);
  float distance = troikaGlyphUvToDistance(clampedGlyphUV);
 
  // Extrapolate distance when outside bounds:
  distance += clampedGlyphUV == vTroikaGlyphUV ? 0.0 : 
    length((vTroikaGlyphUV - clampedGlyphUV) * vTroikaGlyphDimensions);

  

  return distance;
}

float troikaGetEdgeAlpha(float distance, float distanceOffset, float aaDist) {
  #if defined(IS_DEPTH_MATERIAL) || defined(IS_DISTANCE_MATERIAL)
  float alpha = step(-distanceOffset, -distance);
  #else

  float alpha = smoothstep(
    distanceOffset + aaDist,
    distanceOffset - aaDist,
    distance
  );
  #endif

  return alpha;
}
`,gi=`
float aaDist = troikaGetAADist();
float fragDistance = troikaGetFragDistValue();
float edgeAlpha = uTroikaSDFDebug ?
  troikaGlyphUvToSdfValue(vTroikaGlyphUV) :
  troikaGetEdgeAlpha(fragDistance, uTroikaEdgeOffset, max(aaDist, uTroikaBlurRadius));

#if !defined(IS_DEPTH_MATERIAL) && !defined(IS_DISTANCE_MATERIAL)
vec4 fillRGBA = gl_FragColor;
fillRGBA.a *= uTroikaFillOpacity;
vec4 strokeRGBA = uTroikaStrokeWidth == 0.0 ? fillRGBA : vec4(uTroikaStrokeColor, uTroikaStrokeOpacity);
if (fillRGBA.a == 0.0) fillRGBA.rgb = strokeRGBA.rgb;
gl_FragColor = mix(fillRGBA, strokeRGBA, smoothstep(
  -uTroikaStrokeWidth - aaDist,
  -uTroikaStrokeWidth + aaDist,
  fragDistance
));
gl_FragColor.a *= edgeAlpha;
#endif

if (edgeAlpha == 0.0) {
  discard;
}
`;function mi(u){const t=un(u,{chained:!0,extensions:{derivatives:!0},uniforms:{uTroikaSDFTexture:{value:null},uTroikaSDFTextureSize:{value:new Rt},uTroikaSDFGlyphSize:{value:0},uTroikaSDFExponent:{value:0},uTroikaTotalBounds:{value:new Rn(0,0,0,0)},uTroikaClipRect:{value:new Rn(0,0,0,0)},uTroikaEdgeOffset:{value:0},uTroikaFillOpacity:{value:1},uTroikaPositionOffset:{value:new Rt},uTroikaCurveRadius:{value:0},uTroikaBlurRadius:{value:0},uTroikaStrokeWidth:{value:0},uTroikaStrokeColor:{value:new yt},uTroikaStrokeOpacity:{value:1},uTroikaOrient:{value:new ja},uTroikaUseGlyphColors:{value:!0},uTroikaSDFDebug:{value:!1}},vertexDefs:di,vertexTransform:vi,fragmentDefs:pi,fragmentColorTransform:gi,customRewriter({vertexShader:c,fragmentShader:f}){let r=/\buniform\s+vec3\s+diffuse\b/;return r.test(f)&&(f=f.replace(r,"varying vec3 vTroikaGlyphColor").replace(/\bdiffuse\b/g,"vTroikaGlyphColor"),r.test(c)||(c=c.replace(da,`uniform vec3 diffuse;
$&
vTroikaGlyphColor = uTroikaUseGlyphColors ? aTroikaGlyphColor / 255.0 : diffuse;
`))),{vertexShader:c,fragmentShader:f}}});return t.transparent=!0,t.forceSinglePass=!0,Object.defineProperties(t,{isTroikaTextMaterial:{value:!0},shadowSide:{get(){return this.side},set(){}}}),t}const cn=new ra({color:16777215,side:qn,transparent:!0}),Zn=8421504,Yn=new za,Ct=new Nr,en=new Nr,ut=[],yi=new Nr,rn="+x+y";function Kn(u){return Array.isArray(u)?u[0]:u}let _a=()=>{const u=new Zr(new $r(1,1),cn);return _a=()=>u,u},wa=()=>{const u=new Zr(new $r(1,1,32,1),cn);return wa=()=>u,u};const _i={type:"syncstart"},wi={type:"synccomplete"},ba=["font","fontSize","fontStyle","fontWeight","lang","letterSpacing","lineHeight","maxWidth","overflowWrap","text","direction","textAlign","textIndent","whiteSpace","anchorX","anchorY","colorRanges","sdfGlyphSize"],bi=ba.concat("material","color","depthOffset","clipRect","curveRadius","orientation","glyphGeometryDetail");let Sa=class extends Zr{constructor(){const t=new hi;super(t,null),this.text="",this.anchorX=0,this.anchorY=0,this.curveRadius=0,this.direction="auto",this.font=null,this.unicodeFontsURL=null,this.fontSize=.1,this.fontWeight="normal",this.fontStyle="normal",this.lang=null,this.letterSpacing=0,this.lineHeight="normal",this.maxWidth=1/0,this.overflowWrap="normal",this.textAlign="left",this.textIndent=0,this.whiteSpace="normal",this.material=null,this.color=null,this.colorRanges=null,this.outlineWidth=0,this.outlineColor=0,this.outlineOpacity=1,this.outlineBlur=0,this.outlineOffsetX=0,this.outlineOffsetY=0,this.strokeWidth=0,this.strokeColor=Zn,this.strokeOpacity=1,this.fillOpacity=1,this.depthOffset=0,this.clipRect=null,this.orientation=rn,this.glyphGeometryDetail=1,this.sdfGlyphSize=null,this.gpuAccelerateSDF=!0,this.debugSDF=!1}sync(t){this._needsSync&&(this._needsSync=!1,this._isSyncing?(this._queuedSyncs||(this._queuedSyncs=[])).push(t):(this._isSyncing=!0,this.dispatchEvent(_i),pa({text:this.text,font:this.font,lang:this.lang,fontSize:this.fontSize||.1,fontWeight:this.fontWeight||"normal",fontStyle:this.fontStyle||"normal",letterSpacing:this.letterSpacing||0,lineHeight:this.lineHeight||"normal",maxWidth:this.maxWidth,direction:this.direction||"auto",textAlign:this.textAlign,textIndent:this.textIndent,whiteSpace:this.whiteSpace,overflowWrap:this.overflowWrap,anchorX:this.anchorX,anchorY:this.anchorY,colorRanges:this.colorRanges,includeCaretPositions:!0,sdfGlyphSize:this.sdfGlyphSize,gpuAccelerateSDF:this.gpuAccelerateSDF,unicodeFontsURL:this.unicodeFontsURL},c=>{this._isSyncing=!1,this._textRenderInfo=c,this.geometry.updateGlyphs(c.glyphBounds,c.glyphAtlasIndices,c.blockBounds,c.chunkedBounds,c.glyphColors);const f=this._queuedSyncs;f&&(this._queuedSyncs=null,this._needsSync=!0,this.sync(()=>{f.forEach(r=>r&&r())})),this.dispatchEvent(wi),t&&t()})))}onBeforeRender(t,c,f,r,e,a){this.sync(),e.isTroikaTextMaterial&&this._prepareForRender(e)}dispose(){this.geometry.dispose()}get textRenderInfo(){return this._textRenderInfo||null}createDerivedMaterial(t){return mi(t)}get material(){let t=this._derivedMaterial;const c=this._baseMaterial||this._defaultMaterial||(this._defaultMaterial=cn.clone());if((!t||!t.isDerivedFrom(c))&&(t=this._derivedMaterial=this.createDerivedMaterial(c),c.addEventListener("dispose",function f(){c.removeEventListener("dispose",f),t.dispose()})),this.hasOutline()){let f=t._outlineMtl;return f||(f=t._outlineMtl=Object.create(t,{id:{value:t.id+.1}}),f.isTextOutlineMaterial=!0,f.depthWrite=!1,f.map=null,t.addEventListener("dispose",function r(){t.removeEventListener("dispose",r),f.dispose()})),[f,t]}else return t}set material(t){t&&t.isTroikaTextMaterial?(this._derivedMaterial=t,this._baseMaterial=t.baseMaterial):this._baseMaterial=t}hasOutline(){return!!(this.outlineWidth||this.outlineBlur||this.outlineOffsetX||this.outlineOffsetY)}get glyphGeometryDetail(){return this.geometry.detail}set glyphGeometryDetail(t){this.geometry.detail=t}get curveRadius(){return this.geometry.curveRadius}set curveRadius(t){this.geometry.curveRadius=t}get customDepthMaterial(){return Kn(this.material).getDepthMaterial()}set customDepthMaterial(t){}get customDistanceMaterial(){return Kn(this.material).getDistanceMaterial()}set customDistanceMaterial(t){}_prepareForRender(t){const c=t.isTextOutlineMaterial,f=t.uniforms,r=this.textRenderInfo;if(r){const{sdfTexture:i,blockBounds:n}=r;f.uTroikaSDFTexture.value=i,f.uTroikaSDFTextureSize.value.set(i.image.width,i.image.height),f.uTroikaSDFGlyphSize.value=r.sdfGlyphSize,f.uTroikaSDFExponent.value=r.sdfExponent,f.uTroikaTotalBounds.value.fromArray(n),f.uTroikaUseGlyphColors.value=!c&&!!r.glyphColors;let o=0,s=0,h=0,d,p,m,S=0,w=0;if(c){let{outlineWidth:k,outlineOffsetX:I,outlineOffsetY:E,outlineBlur:C,outlineOpacity:A}=this;o=this._parsePercent(k)||0,s=Math.max(0,this._parsePercent(C)||0),d=A,S=this._parsePercent(I)||0,w=this._parsePercent(E)||0}else h=Math.max(0,this._parsePercent(this.strokeWidth)||0),h&&(m=this.strokeColor,f.uTroikaStrokeColor.value.set(m??Zn),p=this.strokeOpacity,p==null&&(p=1)),d=this.fillOpacity;f.uTroikaEdgeOffset.value=o,f.uTroikaPositionOffset.value.set(S,w),f.uTroikaBlurRadius.value=s,f.uTroikaStrokeWidth.value=h,f.uTroikaStrokeOpacity.value=p,f.uTroikaFillOpacity.value=d??1,f.uTroikaCurveRadius.value=this.curveRadius||0;let W=this.clipRect;if(W&&Array.isArray(W)&&W.length===4)f.uTroikaClipRect.value.fromArray(W);else{const k=(this.fontSize||.1)*100;f.uTroikaClipRect.value.set(n[0]-k,n[1]-k,n[2]+k,n[3]+k)}this.geometry.applyClipRect(f.uTroikaClipRect.value)}f.uTroikaSDFDebug.value=!!this.debugSDF,t.polygonOffset=!!this.depthOffset,t.polygonOffsetFactor=t.polygonOffsetUnits=this.depthOffset||0;const e=c?this.outlineColor||0:this.color;if(e==null)delete t.color;else{const i=t.hasOwnProperty("color")?t.color:t.color=new yt;(e!==i._input||typeof e=="object")&&i.set(i._input=e)}let a=this.orientation||rn;if(a!==t._orientation){let i=f.uTroikaOrient.value;a=a.replace(/[^-+xyz]/g,"");let n=a!==rn&&a.match(/^([-+])([xyz])([-+])([xyz])$/);if(n){let[,o,s,h,d]=n;Ct.set(0,0,0)[s]=o==="-"?1:-1,en.set(0,0,0)[d]=h==="-"?-1:1,Yn.lookAt(yi,Ct.cross(en),en),i.setFromMatrix4(Yn)}else i.identity();t._orientation=a}}_parsePercent(t){if(typeof t=="string"){let c=t.match(/^(-?[\d.]+)%$/),f=c?parseFloat(c[1]):NaN;t=(isNaN(f)?0:f/100)*this.fontSize}return t}localPositionToTextCoords(t,c=new Rt){c.copy(t);const f=this.curveRadius;return f&&(c.x=Math.atan2(t.x,Math.abs(f)-Math.abs(t.z))*Math.abs(f)),c}worldPositionToTextCoords(t,c=new Rt){return Ct.copy(t),this.localPositionToTextCoords(this.worldToLocal(Ct),c)}raycast(t,c){const{textRenderInfo:f,curveRadius:r}=this;if(f){const e=f.blockBounds,a=r?wa():_a(),i=a.geometry,{position:n,uv:o}=i.attributes;for(let s=0;s<o.count;s++){let h=e[0]+o.getX(s)*(e[2]-e[0]);const d=e[1]+o.getY(s)*(e[3]-e[1]);let p=0;r&&(p=r-Math.cos(h/r)*r,h=Math.sin(h/r)*r),n.setXYZ(s,h,d,p)}i.boundingSphere=this.geometry.boundingSphere,i.boundingBox=this.geometry.boundingBox,a.matrixWorld=this.matrixWorld,a.material.side=this.material.side,ut.length=0,a.raycast(t,ut);for(let s=0;s<ut.length;s++)ut[s].object=this,c.push(ut[s])}}copy(t){const c=this.geometry;return super.copy(t),this.geometry=c,bi.forEach(f=>{this[f]=t[f]}),this}clone(){return new this.constructor().copy(this)}};ba.forEach(u=>{const t="_private_"+u;Object.defineProperty(Sa.prototype,u,{get(){return this[t]},set(c){c!==this[t]&&(this[t]=c,this._needsSync=!0)}})});new ta;new yt;const Vi=Ee.forwardRef(({sdfGlyphSize:u=64,anchorX:t="center",anchorY:c="middle",font:f,fontSize:r=1,children:e,characters:a,onSync:i,...n},o)=>{const s=Hr(({invalidate:m})=>m),[h]=Ee.useState(()=>new Sa),[d,p]=Ee.useMemo(()=>{const m=[];let S="";return Ee.Children.forEach(e,w=>{typeof w=="string"||typeof w=="number"?S+=w:m.push(w)}),[m,S]},[e]);return Aa(()=>new Promise(m=>oi({font:f,characters:a},m)),["troika-text",f,a]),Ee.useLayoutEffect(()=>{h.sync(()=>{s(),i&&i(h)})}),Ee.useEffect(()=>()=>h.dispose(),[h]),Ee.createElement("primitive",Lt({object:h,ref:o,font:f,text:p,anchorX:t,anchorY:c,fontSize:r,sdfGlyphSize:u},n),d)}),Si=3e3,Ui=3001;function Pt(u,t){const c=u+"Geometry";return Ee.forwardRef(({args:f,children:r,...e},a)=>{const i=Ee.useRef(null);return Ee.useImperativeHandle(a,()=>i.current),Ee.useLayoutEffect(()=>{t?.(i.current)}),Ee.createElement("mesh",Lt({ref:i},e),Ee.createElement(c,{attach:"geometry",args:f}),r)})}const ji=Pt("box"),Xi=Pt("cylinder"),Zi=Pt("sphere"),Yi=Pt("plane"),Ua=(u,t,c)=>{let f;switch(u){case nn:f=new Uint8ClampedArray(t*c*4);break;case Er:f=new Uint16Array(t*c*4);break;case qa:f=new Uint32Array(t*c*4);break;case Qa:f=new Int8Array(t*c*4);break;case Ja:f=new Int16Array(t*c*4);break;case Ka:f=new Int32Array(t*c*4);break;case Br:f=new Float32Array(t*c*4);break;default:throw new Error("Unsupported data type")}return f};let kt;const xi=(u,t,c,f)=>{if(kt!==void 0)return kt;const r=new Ot(1,1,f);t.setRenderTarget(r);const e=new Zr(new $r,new ra({color:16777215}));t.render(e,c),t.setRenderTarget(null);const a=Ua(u,r.width,r.height);return t.readRenderTargetPixels(r,0,0,r.width,r.height,a),r.dispose(),e.geometry.dispose(),e.material.dispose(),kt=a[0]!==0,kt};class hn{_renderer;_rendererIsDisposable=!1;_material;_scene;_camera;_quad;_renderTarget;_width;_height;_type;_colorSpace;_supportsReadPixels=!0;constructor(t){this._width=t.width,this._height=t.height,this._type=t.type,this._colorSpace=t.colorSpace;const c={format:gt,depthBuffer:!1,stencilBuffer:!1,type:this._type,colorSpace:this._colorSpace,anisotropy:t.renderTargetOptions?.anisotropy!==void 0?t.renderTargetOptions?.anisotropy:1,generateMipmaps:t.renderTargetOptions?.generateMipmaps!==void 0?t.renderTargetOptions?.generateMipmaps:!1,magFilter:t.renderTargetOptions?.magFilter!==void 0?t.renderTargetOptions?.magFilter:Mr,minFilter:t.renderTargetOptions?.minFilter!==void 0?t.renderTargetOptions?.minFilter:Mr,samples:t.renderTargetOptions?.samples!==void 0?t.renderTargetOptions?.samples:void 0,wrapS:t.renderTargetOptions?.wrapS!==void 0?t.renderTargetOptions?.wrapS:zr,wrapT:t.renderTargetOptions?.wrapT!==void 0?t.renderTargetOptions?.wrapT:zr};if(this._material=t.material,t.renderer?this._renderer=t.renderer:(this._renderer=hn.instantiateRenderer(),this._rendererIsDisposable=!0),this._scene=new na,this._camera=new Xa,this._camera.position.set(0,0,10),this._camera.left=-.5,this._camera.right=.5,this._camera.top=.5,this._camera.bottom=-.5,this._camera.updateProjectionMatrix(),!xi(this._type,this._renderer,this._camera,c)){let f;this._type===Er&&(f=this._renderer.extensions.has("EXT_color_buffer_float")?Br:void 0),f!==void 0?(console.warn(`This browser does not support reading pixels from ${this._type} RenderTargets, switching to ${Br}`),this._type=f):(this._supportsReadPixels=!1,console.warn("This browser dos not support toArray or toDataTexture, calls to those methods will result in an error thrown"))}this._quad=new Zr(new $r,this._material),this._quad.geometry.computeBoundingBox(),this._scene.add(this._quad),this._renderTarget=new Ot(this.width,this.height,c),this._renderTarget.texture.mapping=t.renderTargetOptions?.mapping!==void 0?t.renderTargetOptions?.mapping:Bt}static instantiateRenderer(){const t=new Za;return t.setSize(128,128),t}render=()=>{this._renderer.setRenderTarget(this._renderTarget);try{this._renderer.render(this._scene,this._camera)}catch(t){throw this._renderer.setRenderTarget(null),t}this._renderer.setRenderTarget(null)};toArray(){if(!this._supportsReadPixels)throw new Error("Can't read pixels in this browser");const t=Ua(this._type,this._width,this._height);return this._renderer.readRenderTargetPixels(this._renderTarget,0,0,this._width,this._height,t),t}toDataTexture(t){const c=new Ya(this.toArray(),this.width,this.height,gt,this._type,t?.mapping||Bt,t?.wrapS||zr,t?.wrapT||zr,t?.magFilter||Mr,t?.minFilter||Mr,t?.anisotropy||1,tn);return c.generateMipmaps=t?.generateMipmaps!==void 0?t?.generateMipmaps:!1,c}disposeOnDemandRenderer(){this._renderer.setRenderTarget(null),this._rendererIsDisposable&&(this._renderer.dispose(),this._renderer.forceContextLoss())}dispose(t){this.disposeOnDemandRenderer(),t&&this.renderTarget.dispose(),this.material instanceof pt&&Object.values(this.material.uniforms).forEach(c=>{c.value instanceof jr&&c.value.dispose()}),Object.values(this.material).forEach(c=>{c instanceof jr&&c.dispose()}),this.material.dispose(),this._quad.geometry.dispose()}get width(){return this._width}set width(t){this._width=t,this._renderTarget.setSize(this._width,this._height)}get height(){return this._height}set height(t){this._height=t,this._renderTarget.setSize(this._width,this._height)}get renderer(){return this._renderer}get renderTarget(){return this._renderTarget}set renderTarget(t){this._renderTarget=t,this._width=t.width,this._height=t.height}get material(){return this._material}get type(){return this._type}get colorSpace(){return this._colorSpace}}class xa extends Error{}class Ta extends Error{}const ft=(u,t,c)=>{const f=new RegExp(`${t}="([^"]*)"`,"i").exec(u);if(f)return f[1];const r=new RegExp(`<${t}[^>]*>([\\s\\S]*?)</${t}>`,"i").exec(u);if(r){const e=r[1].match(/<rdf:li>([^<]*)<\/rdf:li>/g);return e&&e.length===3?e.map(a=>a.replace(/<\/?rdf:li>/g,"")):r[1].trim()}if(c!==void 0)return c;throw new Error(`Can't find ${t} in gainmap metadata`)},Ti=u=>{let t;typeof TextDecoder<"u"?t=new TextDecoder().decode(u):t=u.toString();let c=t.indexOf("<x:xmpmeta");for(;c!==-1;){const f=t.indexOf("x:xmpmeta>",c),r=t.slice(c,f+10);try{const e=ft(r,"hdrgm:GainMapMin","0"),a=ft(r,"hdrgm:GainMapMax"),i=ft(r,"hdrgm:Gamma","1"),n=ft(r,"hdrgm:OffsetSDR","0.015625"),o=ft(r,"hdrgm:OffsetHDR","0.015625"),s=/hdrgm:HDRCapacityMin="([^"]*)"/.exec(r),h=s?s[1]:"0",d=/hdrgm:HDRCapacityMax="([^"]*)"/.exec(r);if(!d)throw new Error("Incomplete gainmap metadata");const p=d[1];return{gainMapMin:Array.isArray(e)?e.map(m=>parseFloat(m)):[parseFloat(e),parseFloat(e),parseFloat(e)],gainMapMax:Array.isArray(a)?a.map(m=>parseFloat(m)):[parseFloat(a),parseFloat(a),parseFloat(a)],gamma:Array.isArray(i)?i.map(m=>parseFloat(m)):[parseFloat(i),parseFloat(i),parseFloat(i)],offsetSdr:Array.isArray(n)?n.map(m=>parseFloat(m)):[parseFloat(n),parseFloat(n),parseFloat(n)],offsetHdr:Array.isArray(o)?o.map(m=>parseFloat(m)):[parseFloat(o),parseFloat(o),parseFloat(o)],hdrCapacityMin:parseFloat(h),hdrCapacityMax:parseFloat(p)}}catch{}c=t.indexOf("<x:xmpmeta",f)}};class Ei{options;constructor(t){this.options={debug:t&&t.debug!==void 0?t.debug:!1,extractFII:t&&t.extractFII!==void 0?t.extractFII:!0,extractNonFII:t&&t.extractNonFII!==void 0?t.extractNonFII:!0}}extract(t){return new Promise((c,f)=>{const r=this.options.debug,e=new DataView(t.buffer);if(e.getUint16(0)!==65496){f(new Error("Not a valid jpeg"));return}const a=e.byteLength;let i=2,n=0,o;for(;i<a;){if(++n>250){f(new Error(`Found no marker after ${n} loops `));return}if(e.getUint8(i)!==255){f(new Error(`Not a valid marker at offset 0x${i.toString(16)}, found: 0x${e.getUint8(i).toString(16)}`));return}if(o=e.getUint8(i+1),r&&console.log(`Marker: ${o.toString(16)}`),o===226){r&&console.log("Found APP2 marker (0xffe2)");const s=i+4;if(e.getUint32(s)===1297106432){const h=s+4;let d;if(e.getUint16(h)===18761)d=!1;else if(e.getUint16(h)===19789)d=!0;else{f(new Error("No valid endianness marker found in TIFF header"));return}if(e.getUint16(h+2,!d)!==42){f(new Error("Not valid TIFF data! (no 0x002A marker)"));return}const p=e.getUint32(h+4,!d);if(p<8){f(new Error("Not valid TIFF data! (First offset less than 8)"));return}const m=h+p,S=e.getUint16(m,!d),w=m+2;let W=0;for(let C=w;C<w+12*S;C+=12)e.getUint16(C,!d)===45057&&(W=e.getUint32(C+8,!d));const I=m+2+S*12+4,E=[];for(let C=I;C<I+W*16;C+=16){const A={MPType:e.getUint32(C,!d),size:e.getUint32(C+4,!d),dataOffset:e.getUint32(C+8,!d),dependantImages:e.getUint32(C+12,!d),start:-1,end:-1,isFII:!1};A.dataOffset?(A.start=h+A.dataOffset,A.isFII=!1):(A.start=0,A.isFII=!0),A.end=A.start+A.size,E.push(A)}if(this.options.extractNonFII&&E.length){const C=new Blob([e]),A=[];for(const M of E){if(M.isFII&&!this.options.extractFII)continue;const _=C.slice(M.start,M.end+1,"image/jpeg");A.push(_)}c(A)}}}i+=2+e.getUint16(i+2)}})}}const Mi=async u=>{const t=Ti(u);if(!t)throw new Ta("Gain map XMP metadata not found");const f=await new Ei({extractFII:!0,extractNonFII:!0}).extract(u);if(f.length!==2)throw new xa("Gain map recovery image not found");return{sdr:new Uint8Array(await f[0].arrayBuffer()),gainMap:new Uint8Array(await f[1].arrayBuffer()),metadata:t}},Jn=u=>new Promise((t,c)=>{const f=document.createElement("img");f.onload=()=>{t(f)},f.onerror=r=>{c(r)},f.src=URL.createObjectURL(u)});class Ci extends $a{_renderer;_renderTargetOptions;_internalLoadingManager;_config;constructor(t,c){super(c),this._config=t,t.renderer&&(this._renderer=t.renderer),this._internalLoadingManager=new eo}setRenderer(t){return this._renderer=t,this}setRenderTargetOptions(t){return this._renderTargetOptions=t,this}prepareQuadRenderer(){this._renderer||console.warn("WARNING: A Renderer was not passed to this Loader constructor or in setRenderer, the result of this Loader will need to be converted to a Data Texture with toDataTexture() before you can use it in your renderer.");const t=this._config.createMaterial({gainMapMax:[1,1,1],gainMapMin:[0,0,0],gamma:[1,1,1],offsetHdr:[1,1,1],offsetSdr:[1,1,1],hdrCapacityMax:1,hdrCapacityMin:0,maxDisplayBoost:1,gainMap:new jr,sdr:new jr});return this._config.createQuadRenderer({width:16,height:16,type:Er,colorSpace:tn,material:t,renderer:this._renderer,renderTargetOptions:this._renderTargetOptions})}async processImages(t,c,f){const r=c?new Blob([c],{type:"image/jpeg"}):void 0,e=new Blob([t],{type:"image/jpeg"});let a,i,n=!1;if(typeof createImageBitmap>"u"){const o=await Promise.all([r?Jn(r):Promise.resolve(void 0),Jn(e)]);i=o[0],a=o[1],n=f==="flipY"}else{const o=await Promise.all([r?createImageBitmap(r,{imageOrientation:f||"flipY"}):Promise.resolve(void 0),createImageBitmap(e,{imageOrientation:f||"flipY"})]);i=o[0],a=o[1]}return{sdrImage:a,gainMapImage:i,needsFlip:n}}createTextures(t,c,f){const r=new jr(c||new ImageData(2,2),Bt,zr,zr,Mr,On,gt,nn,1,tn);r.flipY=f,r.needsUpdate=!0;const e=new jr(t,Bt,zr,zr,Mr,On,gt,nn,1,ro);return e.flipY=f,e.needsUpdate=!0,{gainMap:r,sdr:e}}updateQuadRenderer(t,c,f,r,e){t.width=c.width,t.height=c.height,t.material.gainMap=f,t.material.sdr=r,t.material.gainMapMin=e.gainMapMin,t.material.gainMapMax=e.gainMapMax,t.material.offsetHdr=e.offsetHdr,t.material.offsetSdr=e.offsetSdr,t.material.gamma=e.gamma,t.material.hdrCapacityMin=e.hdrCapacityMin,t.material.hdrCapacityMax=e.hdrCapacityMax,t.material.maxDisplayBoost=Math.pow(2,e.hdrCapacityMax),t.material.needsUpdate=!0}}const ki=`
varying vec2 vUv;

void main() {
  vUv = uv;
  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}
`,Fi=`
// min half float value
#define HALF_FLOAT_MIN vec3( -65504, -65504, -65504 )
// max half float value
#define HALF_FLOAT_MAX vec3( 65504, 65504, 65504 )

uniform sampler2D sdr;
uniform sampler2D gainMap;
uniform vec3 gamma;
uniform vec3 offsetHdr;
uniform vec3 offsetSdr;
uniform vec3 gainMapMin;
uniform vec3 gainMapMax;
uniform float weightFactor;

varying vec2 vUv;

void main() {
  vec3 rgb = texture2D( sdr, vUv ).rgb;
  vec3 recovery = texture2D( gainMap, vUv ).rgb;
  vec3 logRecovery = pow( recovery, gamma );
  vec3 logBoost = gainMapMin * ( 1.0 - logRecovery ) + gainMapMax * logRecovery;
  vec3 hdrColor = (rgb + offsetSdr) * exp2( logBoost * weightFactor ) - offsetHdr;
  vec3 clampedHdrColor = max( HALF_FLOAT_MIN, min( HALF_FLOAT_MAX, hdrColor ));
  gl_FragColor = vec4( clampedHdrColor , 1.0 );
}
`;class Ai extends pt{_maxDisplayBoost;_hdrCapacityMin;_hdrCapacityMax;constructor({gamma:t,offsetHdr:c,offsetSdr:f,gainMapMin:r,gainMapMax:e,maxDisplayBoost:a,hdrCapacityMin:i,hdrCapacityMax:n,sdr:o,gainMap:s}){super({name:"GainMapDecoderMaterial",vertexShader:ki,fragmentShader:Fi,uniforms:{sdr:{value:o},gainMap:{value:s},gamma:{value:new Nr(1/t[0],1/t[1],1/t[2])},offsetHdr:{value:new Nr().fromArray(c)},offsetSdr:{value:new Nr().fromArray(f)},gainMapMin:{value:new Nr().fromArray(r)},gainMapMax:{value:new Nr().fromArray(e)},weightFactor:{value:(Math.log2(a)-i)/(n-i)}},blending:to,depthTest:!1,depthWrite:!1}),this._maxDisplayBoost=a,this._hdrCapacityMin=i,this._hdrCapacityMax=n,this.needsUpdate=!0,this.uniformsNeedUpdate=!0}get sdr(){return this.uniforms.sdr.value}set sdr(t){this.uniforms.sdr.value=t}get gainMap(){return this.uniforms.gainMap.value}set gainMap(t){this.uniforms.gainMap.value=t}get offsetHdr(){return this.uniforms.offsetHdr.value.toArray()}set offsetHdr(t){this.uniforms.offsetHdr.value.fromArray(t)}get offsetSdr(){return this.uniforms.offsetSdr.value.toArray()}set offsetSdr(t){this.uniforms.offsetSdr.value.fromArray(t)}get gainMapMin(){return this.uniforms.gainMapMin.value.toArray()}set gainMapMin(t){this.uniforms.gainMapMin.value.fromArray(t)}get gainMapMax(){return this.uniforms.gainMapMax.value.toArray()}set gainMapMax(t){this.uniforms.gainMapMax.value.fromArray(t)}get gamma(){const t=this.uniforms.gamma.value;return[1/t.x,1/t.y,1/t.z]}set gamma(t){const c=this.uniforms.gamma.value;c.x=1/t[0],c.y=1/t[1],c.z=1/t[2]}get hdrCapacityMin(){return this._hdrCapacityMin}set hdrCapacityMin(t){this._hdrCapacityMin=t,this.calculateWeight()}get hdrCapacityMax(){return this._hdrCapacityMax}set hdrCapacityMax(t){this._hdrCapacityMax=t,this.calculateWeight()}get maxDisplayBoost(){return this._maxDisplayBoost}set maxDisplayBoost(t){this._maxDisplayBoost=Math.max(1,Math.min(65504,t)),this.calculateWeight()}calculateWeight(){const t=(Math.log2(this._maxDisplayBoost)-this._hdrCapacityMin)/(this._hdrCapacityMax-this._hdrCapacityMin);this.uniforms.weightFactor.value=Math.max(0,Math.min(1,t))}}class Ea extends Ci{constructor(t,c){super({renderer:t,createMaterial:f=>new Ai(f),createQuadRenderer:f=>new hn(f)},c)}async render(t,c,f,r){const{sdrImage:e,gainMapImage:a,needsFlip:i}=await this.processImages(f,r,"flipY"),{gainMap:n,sdr:o}=this.createTextures(e,a,i);this.updateQuadRenderer(t,e,n,o,c),t.render()}}class Di extends Ea{load([t,c,f],r,e,a){const i=this.prepareQuadRenderer();let n,o,s;const h=async()=>{if(n&&o&&s){try{await this.render(i,s,n,o)}catch(T){this.manager.itemError(t),this.manager.itemError(c),this.manager.itemError(f),typeof a=="function"&&a(T),i.disposeOnDemandRenderer();return}typeof r=="function"&&r(i),this.manager.itemEnd(t),this.manager.itemEnd(c),this.manager.itemEnd(f),i.disposeOnDemandRenderer()}};let d=!0,p=0,m=0,S=!0,w=0,W=0,k=!0,I=0,E=0;const C=()=>{if(typeof e=="function"){const T=p+w+I,O=m+W+E,q=d&&S&&k;e(new ProgressEvent("progress",{lengthComputable:q,loaded:O,total:T}))}};this.manager.itemStart(t),this.manager.itemStart(c),this.manager.itemStart(f);const A=new Ft(this._internalLoadingManager);A.setResponseType("arraybuffer"),A.setRequestHeader(this.requestHeader),A.setPath(this.path),A.setWithCredentials(this.withCredentials),A.load(t,async T=>{if(typeof T=="string")throw new Error("Invalid sdr buffer");n=T,await h()},T=>{d=T.lengthComputable,m=T.loaded,p=T.total,C()},T=>{this.manager.itemError(t),typeof a=="function"&&a(T)});const M=new Ft(this._internalLoadingManager);M.setResponseType("arraybuffer"),M.setRequestHeader(this.requestHeader),M.setPath(this.path),M.setWithCredentials(this.withCredentials),M.load(c,async T=>{if(typeof T=="string")throw new Error("Invalid gainmap buffer");o=T,await h()},T=>{S=T.lengthComputable,W=T.loaded,w=T.total,C()},T=>{this.manager.itemError(c),typeof a=="function"&&a(T)});const _=new Ft(this._internalLoadingManager);return _.setRequestHeader(this.requestHeader),_.setPath(this.path),_.setWithCredentials(this.withCredentials),_.load(f,async T=>{if(typeof T!="string")throw new Error("Invalid metadata string");s=JSON.parse(T),await h()},T=>{k=T.lengthComputable,E=T.loaded,I=T.total,C()},T=>{this.manager.itemError(f),typeof a=="function"&&a(T)}),i}}class Ii extends Ea{load(t,c,f,r){const e=this.prepareQuadRenderer(),a=new Ft(this._internalLoadingManager);return a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setPath(this.path),a.setWithCredentials(this.withCredentials),this.manager.itemStart(t),a.load(t,async i=>{if(typeof i=="string")throw new Error("Invalid buffer, received [string], was expecting [ArrayBuffer]");const n=new Uint8Array(i);let o,s,h;try{const d=await Mi(n);o=d.sdr,s=d.gainMap,h=d.metadata}catch(d){if(d instanceof Ta||d instanceof xa)console.warn(`Failure to reconstruct an HDR image from ${t}: Gain map metadata not found in the file, HDRJPGLoader will render the SDR jpeg`),h={gainMapMin:[0,0,0],gainMapMax:[1,1,1],gamma:[1,1,1],hdrCapacityMin:0,hdrCapacityMax:1,offsetHdr:[0,0,0],offsetSdr:[0,0,0]},o=n;else throw d}try{await this.render(e,h,o.buffer,s?.buffer)}catch(d){this.manager.itemError(t),typeof r=="function"&&r(d),e.disposeOnDemandRenderer();return}typeof c=="function"&&c(e),this.manager.itemEnd(t),e.disposeOnDemandRenderer()},f,i=>{this.manager.itemError(t),typeof r=="function"&&r(i)}),e}}const mt={apartment:"lebombo_1k.hdr",city:"potsdamer_platz_1k.hdr",dawn:"kiara_1_dawn_1k.hdr",forest:"forest_slope_1k.hdr",lobby:"st_fagans_interior_1k.hdr",night:"dikhololo_night_1k.hdr",park:"rooitou_park_1k.hdr",studio:"studio_small_03_1k.hdr",sunset:"venice_sunset_1k.hdr",warehouse:"empty_warehouse_01_1k.hdr"},Ma="https://raw.githack.com/pmndrs/drei-assets/456060a26bbeb8fdf79326f224b6d99b8bcce736/hdri/",qr=u=>Array.isArray(u),dn=["/px.png","/nx.png","/py.png","/ny.png","/pz.png","/nz.png"];function Nt({files:u=dn,path:t="",preset:c=void 0,encoding:f=void 0,extensions:r}={}){let e=null,a=!1;c&&(vn(c),u=mt[c],t=Ma),a=qr(u);const{extension:i,isCubemap:n}=pn(u);if(e=gn(i),!e)throw new Error("useEnvironment: Unrecognized file extension: "+u);const o=Hr(p=>p.gl);Ee.useLayoutEffect(()=>{if(i!=="webp"&&i!=="jpg"&&i!=="jpeg")return;function p(){It.clear(e,a?[u]:u)}o.domElement.addEventListener("webglcontextlost",p,{once:!0})},[u,o.domElement]);const s=It(e,a?[u]:u,p=>{(i==="webp"||i==="jpg"||i==="jpeg")&&p.setRenderer(o),p.setPath==null||p.setPath(t),r&&r(p)});let h=a?s[0]:s;if(i==="jpg"||i==="jpeg"||i==="webp"){var d;h=(d=h.renderTarget)==null?void 0:d.texture}return h.mapping=n?no:ao,"colorSpace"in h?h.colorSpace=f??n?"srgb":"srgb-linear":h.encoding=f??n?Ui:Si,h}const Ri={files:dn,path:"",preset:void 0,extensions:void 0};Nt.preload=u=>{const t={...Ri,...u};let{files:c,path:f=""}=t;const{preset:r,extensions:e}=t;r&&(vn(r),c=mt[r],f=Ma);const{extension:a}=pn(c);if(a==="webp"||a==="jpg"||a==="jpeg")throw new Error("useEnvironment: Preloading gainmaps is not supported");const i=gn(a);if(!i)throw new Error("useEnvironment: Unrecognized file extension: "+c);It.preload(i,qr(c)?[c]:c,n=>{n.setPath==null||n.setPath(f),e&&e(n)})};const Oi={files:dn,preset:void 0};Nt.clear=u=>{const t={...Oi,...u};let{files:c}=t;const{preset:f}=t;f&&(vn(f),c=mt[f]);const{extension:r}=pn(c),e=gn(r);if(!e)throw new Error("useEnvironment: Unrecognized file extension: "+c);It.clear(e,qr(c)?[c]:c)};function vn(u){if(!(u in mt))throw new Error("Preset must be one of: "+Object.keys(mt).join(", "))}function pn(u){var t;const c=qr(u)&&u.length===6,f=qr(u)&&u.length===3&&u.some(a=>a.endsWith("json")),r=qr(u)?u[0]:u;return{extension:c?"cube":f?"webp":r.startsWith("data:application/exr")?"exr":r.startsWith("data:application/hdr")?"hdr":r.startsWith("data:image/jpeg")?"jpg":(t=r.split(".").pop())==null||(t=t.split("?"))==null||(t=t.shift())==null?void 0:t.toLowerCase(),isCubemap:c,isGainmap:f}}function gn(u){return u==="cube"?oo:u==="hdr"?To:u==="exr"?Eo:u==="jpg"||u==="jpeg"?Ii:u==="webp"?Di:null}const Bi=u=>u.current&&u.current.isScene,Li=u=>Bi(u)?u.current:u;function mn(u,t,c,f,r={}){var e,a,i,n;r={backgroundBlurriness:0,backgroundIntensity:1,backgroundRotation:[0,0,0],environmentIntensity:1,environmentRotation:[0,0,0],...r};const o=Li(t||c),s=o.background,h=o.environment,d={backgroundBlurriness:o.backgroundBlurriness,backgroundIntensity:o.backgroundIntensity,backgroundRotation:(e=(a=o.backgroundRotation)==null||a.clone==null?void 0:a.clone())!==null&&e!==void 0?e:[0,0,0],environmentIntensity:o.environmentIntensity,environmentRotation:(i=(n=o.environmentRotation)==null||n.clone==null?void 0:n.clone())!==null&&i!==void 0?i:[0,0,0]};return u!=="only"&&(o.environment=f),u&&(o.background=f),In(o,r),()=>{u!=="only"&&(o.environment=h),u&&(o.background=s),In(o,d)}}function yn({scene:u,background:t=!1,map:c,...f}){const r=Hr(e=>e.scene);return Ee.useLayoutEffect(()=>{if(c)return mn(t,u,r,c,f)}),null}function Ca({background:u=!1,scene:t,blur:c,backgroundBlurriness:f,backgroundIntensity:r,backgroundRotation:e,environmentIntensity:a,environmentRotation:i,...n}){const o=Nt(n),s=Hr(h=>h.scene);return Ee.useLayoutEffect(()=>mn(u,t,s,o,{backgroundBlurriness:c??f,backgroundIntensity:r,backgroundRotation:e,environmentIntensity:a,environmentRotation:i})),Ee.useEffect(()=>()=>{o.dispose()},[o]),null}function Gi({children:u,near:t=.1,far:c=1e3,resolution:f=256,frames:r=1,map:e,background:a=!1,blur:i,backgroundBlurriness:n,backgroundIntensity:o,backgroundRotation:s,environmentIntensity:h,environmentRotation:d,scene:p,files:m,path:S,preset:w=void 0,extensions:W}){const k=Hr(_=>_.gl),I=Hr(_=>_.scene),E=Ee.useRef(null),[C]=Ee.useState(()=>new na),A=Ee.useMemo(()=>{const _=new io(f);return _.texture.type=Er,_},[f]);Ee.useEffect(()=>()=>{A.dispose()},[A]),Ee.useLayoutEffect(()=>{if(r===1){const _=k.autoClear;k.autoClear=!0,E.current.update(k,C),k.autoClear=_}return mn(a,p,I,A.texture,{backgroundBlurriness:i??n,backgroundIntensity:o,backgroundRotation:s,environmentIntensity:h,environmentRotation:d})},[u,C,A.texture,p,I,a,r,k]);let M=1;return Qn(()=>{if(r===1/0||M<r){const _=k.autoClear;k.autoClear=!0,E.current.update(k,C),k.autoClear=_,M++}}),Ee.createElement(Ee.Fragment,null,Ia(Ee.createElement(Ee.Fragment,null,u,Ee.createElement("cubeCamera",{ref:E,args:[t,c,A]}),m||w?Ee.createElement(Ca,{background:!0,files:m,preset:w,path:S,extensions:W}):e?Ee.createElement(yn,{background:!0,map:e,extensions:W}):null),C))}function Pi(u){var t,c,f,r;const e=Nt(u),a=u.map||e;Ee.useMemo(()=>Da({GroundProjectedEnvImpl:So}),[]),Ee.useEffect(()=>()=>{e.dispose()},[e]);const i=Ee.useMemo(()=>[a],[a]),n=(t=u.ground)==null?void 0:t.height,o=(c=u.ground)==null?void 0:c.radius,s=(f=(r=u.ground)==null?void 0:r.scale)!==null&&f!==void 0?f:1e3;return Ee.createElement(Ee.Fragment,null,Ee.createElement(yn,Lt({},u,{map:a})),Ee.createElement("groundProjectedEnvImpl",{args:i,scale:s,height:n,radius:o}))}function Ki(u){return u.ground?Ee.createElement(Pi,u):u.map?Ee.createElement(yn,u):u.children?Ee.createElement(Gi,u):Ee.createElement(Ca,u)}const Ji=Ee.forwardRef(({scale:u=10,frames:t=1/0,opacity:c=1,width:f=1,height:r=1,blur:e=1,near:a=0,far:i=10,resolution:n=512,smooth:o=!0,color:s="#000000",depthWrite:h=!1,renderOrder:d,...p},m)=>{const S=Ee.useRef(null),w=Hr(U=>U.scene),W=Hr(U=>U.gl),k=Ee.useRef(null);f=f*(Array.isArray(u)?u[0]:u||1),r=r*(Array.isArray(u)?u[1]:u||1);const[I,E,C,A,M,_,T]=Ee.useMemo(()=>{const U=new Ot(n,n),K=new Ot(n,n);K.texture.generateMipmaps=U.texture.generateMipmaps=!1;const H=new $r(f,r).rotateX(Math.PI/2),ie=new Zr(H),ue=new ea;ue.depthTest=ue.depthWrite=!1,ue.onBeforeCompile=y=>{y.uniforms={...y.uniforms,ucolor:{value:new yt(s)}},y.fragmentShader=y.fragmentShader.replace("void main() {",`uniform vec3 ucolor;
           void main() {
          `),y.fragmentShader=y.fragmentShader.replace("vec4( vec3( 1.0 - fragCoordZ ), opacity );","vec4( ucolor * fragCoordZ * 2.0, ( 1.0 - fragCoordZ ) * 1.0 );")};const X=new pt(Uo),L=new pt(xo);return L.depthTest=X.depthTest=!1,[U,H,ue,ie,X,L,K]},[n,f,r,u,s]),O=U=>{A.visible=!0,A.material=M,M.uniforms.tDiffuse.value=I.texture,M.uniforms.h.value=U*1/256,W.setRenderTarget(T),W.render(A,k.current),A.material=_,_.uniforms.tDiffuse.value=T.texture,_.uniforms.v.value=U*1/256,W.setRenderTarget(I),W.render(A,k.current),A.visible=!1};let q=0,b,D;return Qn(()=>{k.current&&(t===1/0||q<t)&&(q++,b=w.background,D=w.overrideMaterial,S.current.visible=!1,w.background=null,w.overrideMaterial=C,W.setRenderTarget(I),W.render(w,k.current),O(e),o&&O(e*.4),W.setRenderTarget(null),S.current.visible=!0,w.overrideMaterial=D,w.background=b)}),Ee.useImperativeHandle(m,()=>S.current,[]),Ee.createElement("group",Lt({"rotation-x":Math.PI/2},p,{ref:S}),Ee.createElement("mesh",{renderOrder:d,geometry:E,scale:[1,-1,1],rotation:[-Math.PI/2,0,0]},Ee.createElement("meshBasicMaterial",{transparent:!0,map:I.texture,opacity:c,depthWrite:h})),Ee.createElement("orthographicCamera",{ref:k,args:[-f/2,f/2,r/2,-r/2,a,i]}))});export{ji as B,Ji as C,Ki as E,Yi as P,Zi as S,Vi as T,Xi as a};
