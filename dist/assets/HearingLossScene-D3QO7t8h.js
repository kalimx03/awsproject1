import{a,j as e}from"./charts-VUD2E1tl.js";import{l as F,A as q,n as L,C as _,O as H,k as I}from"./index-OIM89d1-.js";import{E as z,C as O,P as R,B as y,a as G,S as M,T as $}from"./ContactShadows-BCl5AC67.js";import"./tensorflow-Bdm-eNd5.js";import"./three-BxGoG16y.js";function U(){const t=a.useRef(null);a.useRef(null);const s=a.useRef(null),n=a.useRef(null),c=a.useRef(null),r=a.useRef(null),[l,p]=a.useState(!1);a.useEffect(()=>{if(typeof window<"u"&&!t.current){t.current=new(window.AudioContext||window.webkitAudioContext),s.current=t.current.createGain(),n.current=t.current.createBiquadFilter(),c.current=t.current.createConvolver();const i=t.current.sampleRate*.5,o=t.current.createBuffer(2,i,t.current.sampleRate);for(let m=0;m<2;m++){const x=o.getChannelData(m);for(let f=0;f<i;f++)x[f]=(Math.random()*2-1)*Math.pow(1-f/i,2)}c.current.buffer=o,s.current.connect(n.current),n.current.connect(t.current.destination),p(!0)}},[]);const u=i=>{if(!(!l||!n.current||!s.current))switch(r.current&&(r.current.stop(),r.current=null),i){case 1:n.current.type="highpass",n.current.frequency.value=3e3,s.current.gain.value=.7;break;case 2:n.current.type="lowpass",n.current.frequency.value=1500,s.current.gain.value=.5,n.current.disconnect(),n.current.connect(c.current),c.current.connect(t.current.destination);break;case 3:n.current.type="lowpass",n.current.frequency.value=800,s.current.gain.value=.3,r.current=t.current.createOscillator(),r.current.type="sine",r.current.frequency.value=6e3;const o=t.current.createGain();o.gain.value=.15,r.current.connect(o),o.connect(t.current.destination),r.current.start();break;case 4:n.current.type="lowpass",n.current.frequency.value=400,s.current.gain.value=.05;break;case 5:const m=t.current.createStereoPanner();m.pan.value=-1,s.current.gain.value=.7,n.current.disconnect(),n.current.connect(m),m.connect(t.current.destination);break}},d=()=>{if(!l||!t.current)return;const i=t.current.createOscillator(),o=t.current.createGain();i.type="square",i.frequency.value=1e3,o.gain.value=.3,i.connect(o),o.connect(n.current),i.start();const m=setInterval(()=>{o.gain.value=o.gain.value===0?.3:0},500);setTimeout(()=>{clearInterval(m),i.stop()},5e3)},h=()=>{if(!l||!t.current)return;const i=2*t.current.sampleRate,o=t.current.createBuffer(1,i,t.current.sampleRate),m=o.getChannelData(0);for(let g=0;g<i;g++)m[g]=Math.random()*2-1;const x=t.current.createBufferSource();x.buffer=o;const f=t.current.createGain();f.gain.value=.02;const b=t.current.createBiquadFilter();b.type="lowpass",b.frequency.value=200,x.connect(b),b.connect(f),f.connect(n.current),x.loop=!0,x.start()};return a.useEffect(()=>()=>{r.current&&r.current.stop(),t.current&&t.current.state!=="closed"&&t.current.close()},[]),{isInitialized:l,setHearingMode:u,playEmergencySound:d,playAmbientSounds:h}}function W(){return e.jsxs(e.Fragment,{children:[e.jsx("ambientLight",{intensity:.3}),e.jsx("directionalLight",{position:[0,10,0],intensity:.8,castShadow:!0,"shadow-mapSize":[2048,2048]}),e.jsx(R,{rotation:[-Math.PI/2,0,0],args:[20,15],position:[0,0,0],receiveShadow:!0,children:e.jsx("meshStandardMaterial",{color:"#8B7355",roughness:.9})}),e.jsx(y,{args:[20,8,.3],position:[0,4,-7.5],children:e.jsx("meshStandardMaterial",{color:"#F5F5DC"})}),e.jsx(y,{args:[15,8,.3],position:[-10,4,0],rotation:[0,Math.PI/2,0],children:e.jsx("meshStandardMaterial",{color:"#F5F5DC"})}),e.jsx(y,{args:[15,8,.3],position:[10,4,0],rotation:[0,Math.PI/2,0],children:e.jsx("meshStandardMaterial",{color:"#F5F5DC"})}),e.jsx(R,{rotation:[Math.PI/2,0,0],args:[20,15],position:[0,8,0],children:e.jsx("meshStandardMaterial",{color:"#FFFFFF"})}),e.jsx(y,{args:[4,1,2],position:[0,.5,-5],castShadow:!0,children:e.jsx("meshStandardMaterial",{color:"#8B4513",roughness:.8})}),e.jsx(y,{args:[8,4,.1],position:[0,4,-7.3],children:e.jsx("meshStandardMaterial",{color:"#FFFFFF"})}),Array.from({length:8},(t,s)=>{const n=Math.floor(s/4),c=s%4;return e.jsxs("group",{position:[-6+c*4,.5,2+n*3],children:[e.jsx(y,{args:[1.5,1,1],castShadow:!0,children:e.jsx("meshStandardMaterial",{color:"#654321",roughness:.8})}),e.jsx(y,{args:[1.5,.1,1],position:[0,1,0],children:e.jsx("meshStandardMaterial",{color:"#8B4513"})})]},s)}),e.jsx(y,{args:[3,4,.1],position:[-10,4,-2],children:e.jsx("meshStandardMaterial",{color:"#87CEEB",transparent:!0,opacity:.7})}),e.jsx(y,{args:[3,4,.1],position:[10,4,-2],children:e.jsx("meshStandardMaterial",{color:"#87CEEB",transparent:!0,opacity:.7})}),Array.from({length:4},(t,s)=>e.jsxs("group",{position:[-6+s*4,7.5,0],children:[e.jsx(G,{args:[.2,.2,.5],rotation:[Math.PI/2,0,0],children:e.jsx("meshStandardMaterial",{color:"#CCCCCC"})}),e.jsx(M,{args:[.3],position:[0,-.3,0],children:e.jsx("meshStandardMaterial",{color:"#FFFFE0",emissive:"#FFFFE0",emissiveIntensity:.5})})]},s))]})}function V({isSpeaking:t,onNameCall:s}){const n=a.useRef(),[c,r]=a.useState(0);return I(l=>{r(l.clock.elapsedTime),n.current&&t&&(n.current.rotation.y=Math.sin(c*2)*.05)}),e.jsxs("group",{ref:n,position:[0,1.6,-4],children:[e.jsx(Capsule,{args:[.3,1.2],position:[0,0,0],children:e.jsx("meshStandardMaterial",{color:"#4169E1"})}),e.jsx(M,{args:[.25],position:[0,.8,0],children:e.jsx("meshStandardMaterial",{color:"#FDBCB4"})}),t&&e.jsx($,{position:[0,1.5,0],fontSize:.2,color:"#00FF00",anchorX:"center",anchorY:"middle",children:"Speaking..."})]})}function X({position:t,isListening:s}){const n=a.useRef();return I(c=>{n.current&&s&&(n.current.rotation.y=Math.sin(c.clock.elapsedTime+t[0])*.1)}),e.jsxs("group",{ref:n,position:t,children:[e.jsx(Capsule,{args:[.25,1],position:[0,.5,0],children:e.jsx("meshStandardMaterial",{color:"#FF6347"})}),e.jsx(M,{args:[.2],position:[0,1.2,0],children:e.jsx("meshStandardMaterial",{color:"#FDBCB4"})})]})}function Y({text:t,accuracy:s=100,showCaptions:n}){if(!n||!t)return null;const r=((l,p)=>{if(p>=100)return l;const u=l.split(" "),d=(100-p)/100;return u.map(h=>{if(Math.random()<d)return"[inaudible]";if(Math.random()<d*.3){const i=h.split(""),o=Math.floor(Math.random()*i.length);return i[o]=String.fromCharCode(i[o].charCodeAt(0)+1),i.join("")}return h}).join(" ")})(t,s);return e.jsx("div",{className:"absolute bottom-8 left-1/2 transform -translate-x-1/2 z-50",children:e.jsxs("div",{className:"glass-morphism px-6 py-4 max-w-4xl",children:[e.jsx("div",{className:"text-white text-xl font-medium leading-relaxed",children:r}),s<100&&e.jsxs("div",{className:"text-xs text-yellow-400 mt-2",children:["Caption accuracy: ",s,"%"]})]})})}function Z({hearingMode:t,onModeChange:s,showCaptions:n,onCaptionsToggle:c,captionAccuracy:r}){const{scenarioData:l,sessionMetrics:p}=F(),{completedTasks:u}=l;return e.jsxs("div",{className:"fixed inset-0 pointer-events-none z-50",children:[e.jsxs("div",{className:"absolute top-4 left-4 glass-morphism p-4 pointer-events-auto",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Tasks"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:`flex items-center gap-2 ${u.includes("follow_lecture")?"text-green-400":"text-gray-400"}`,children:[e.jsx("span",{children:u.includes("follow_lecture")?"âœ“":"â—‹"}),e.jsx("span",{children:"Follow Lecture"})]}),e.jsxs("div",{className:`flex items-center gap-2 ${u.includes("name_called")?"text-green-400":"text-gray-400"}`,children:[e.jsx("span",{children:u.includes("name_called")?"âœ“":"â—‹"}),e.jsx("span",{children:"Respond to Name"})]}),e.jsxs("div",{className:`flex items-center gap-2 ${u.includes("emergency")?"text-green-400":"text-gray-400"}`,children:[e.jsx("span",{children:u.includes("emergency")?"âœ“":"â—‹"}),e.jsx("span",{children:"Emergency Response"})]})]})]}),e.jsxs("div",{className:"absolute top-4 right-4 glass-morphism p-4 pointer-events-auto",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Hearing Mode"}),e.jsxs("div",{className:"text-2xl font-bold gradient-text mb-2",children:[t,"/5"]}),e.jsxs("div",{className:"text-sm text-gray-400 mb-3",children:[t===1&&"Mild High Frequency Loss",t===2&&"Moderate Bilateral Loss",t===3&&"Severe + Tinnitus",t===4&&"Profound - Near Silence",t===5&&"Unilateral - One Side"]}),e.jsx("div",{className:"space-y-2",children:[1,2,3,4,5].map(d=>e.jsxs("button",{onClick:()=>s(d),className:`w-full px-3 py-1 rounded text-sm ${t===d?"bg-purple-accent text-white":"glass-morphism"}`,children:["Mode ",d]},d))})]}),e.jsxs("div",{className:"absolute top-4 right-80 glass-morphism p-4 pointer-events-auto",children:[e.jsx("h3",{className:"text-sm font-semibold mb-2",children:"Captions"}),e.jsx("button",{onClick:c,className:`w-full px-3 py-2 rounded text-sm mb-2 ${n?"bg-green-500 text-white":"glass-morphism"}`,children:n?"ON":"OFF"}),n&&e.jsxs("div",{children:[e.jsxs("label",{className:"text-xs text-gray-400",children:["Accuracy: ",r,"%"]}),e.jsx("input",{type:"range",min:"30",max:"100",value:r,onChange:d=>c&&c(parseInt(d.target.value)),className:"w-full mt-1"})]})]}),e.jsx("div",{className:"absolute bottom-4 left-4 glass-morphism p-4 pointer-events-auto",children:e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsx("div",{children:"Mouse - Look Around"}),e.jsx("div",{children:"Space - I heard that!"}),e.jsx("div",{children:"E - Emergency noticed"})]})}),e.jsx("div",{className:"absolute bottom-4 right-4 glass-morphism p-3 pointer-events-auto",children:e.jsx("div",{className:"text-xs text-cyan-accent",children:"ðŸŽ§ ADA Compliant"})})]})}function ne(){const{setCurrentScene:t,updateHearingMode:s,startSession:n,endSession:c,completeTask:r,recordError:l}=F(),{hearingMode:p}=F(v=>v.scenarioData),[u,d]=a.useState(!0),[h,i]=a.useState(!1),[o,m]=a.useState(!0),[x,f]=a.useState(100),[b,g]=a.useState(""),[N,k]=a.useState(0),[C,T]=a.useState(!1),S=U(),E=["Welcome to today's lecture on accessibility in design.","When we think about accessibility, we often focus on physical barriers.","But sensory accessibility is equally important.","Let's consider how hearing loss affects daily interactions.","Many public spaces lack proper visual alert systems.","This creates significant challenges for the deaf and hard of hearing community.","Visual alarms, captioning, and clear sight lines are essential.","Universal design benefits everyone, not just those with disabilities."];a.useEffect(()=>(n(),()=>c()),[n,c]),a.useEffect(()=>{S&&S.setHearingMode(p)},[p,S]),a.useEffect(()=>{if(!u){const v=setTimeout(()=>{i(!0);let j=0;const w=setInterval(()=>{j<E.length?(g(E[j]),j++):(i(!1),clearInterval(w),r("follow_lecture"))},3e3);return()=>clearInterval(w)},2e3);return()=>clearTimeout(v)}},[u,r]),a.useEffect(()=>{if(h&&N<3){const v=setTimeout(()=>{g("Hey [Username]! Are you paying attention?"),k(j=>j+1),setTimeout(()=>{l("name_called")},3e3)},8e3);return()=>clearTimeout(v)}},[h,N,l]),a.useEffect(()=>{if(h&&!C){const v=setTimeout(()=>{T(!0),g("ðŸš¨ FIRE ALARM - Please evacuate immediately!"),S&&S.playEmergencySound(),setTimeout(()=>{r("emergency")},5e3)},3e4);return()=>clearTimeout(v)}},[h,C,S,r]);const A=()=>{t("dashboard")},B=()=>{r("name_called"),g("Thank you for your attention!")},P=()=>{C&&(r("emergency"),g("Good job noticing the emergency!"))};return e.jsxs("div",{className:"relative w-full h-screen bg-deep-navy",children:[e.jsx(q,{children:u&&e.jsx(L.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 z-50 flex items-center justify-center bg-black/80",children:e.jsxs("div",{className:"glass-morphism p-8 max-w-2xl mx-4",children:[e.jsx("h2",{className:"text-3xl font-bold gradient-text mb-4",children:"Hearing Loss Simulation"}),e.jsxs("div",{className:"text-gray-300 space-y-4 mb-6",children:[e.jsx("p",{children:"Experience a classroom environment with varying degrees of hearing loss:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-2 ml-4",children:[e.jsx("li",{children:"Follow a lecture with degraded audio"}),e.jsx("li",{children:"Respond when your name is called"}),e.jsx("li",{children:"React to emergency alarms"})]}),e.jsx("p",{className:"text-sm text-cyan-accent",children:"Toggle captions to see how accuracy affects comprehension. Press SPACE when you hear your name, E when you notice the emergency."})]}),e.jsx("button",{onClick:()=>d(!1),className:"button-primary w-full",children:"Start Simulation"})]})})}),e.jsxs(_,{shadows:!0,camera:{position:[0,1.7,8],fov:75},className:"w-full h-full",children:[e.jsx(W,{}),e.jsx(V,{isSpeaking:h}),Array.from({length:8},(v,j)=>{const w=Math.floor(j/4),D=j%4;return e.jsx(X,{position:[-6+D*4,0,2+w*3],isListening:h},j)}),e.jsx(H,{enablePan:!1,enableZoom:!1,maxPolarAngle:Math.PI/2,minDistance:1,maxDistance:15}),e.jsx(z,{preset:"apartment"}),e.jsx(O,{position:[0,-.1,0],opacity:.3})]}),e.jsx(Z,{hearingMode:p,onModeChange:s,showCaptions:o,onCaptionsToggle:m,captionAccuracy:x}),e.jsx(Y,{text:b,accuracy:x,showCaptions:o}),e.jsxs("div",{className:"absolute bottom-20 left-1/2 transform -translate-x-1/2 flex gap-4",children:[N>0&&e.jsx("button",{onClick:B,className:"button-primary",children:"I heard that! (SPACE)"}),C&&e.jsx("button",{onClick:P,className:"button-primary bg-red-500",children:"Emergency noticed! (E)"})]}),e.jsx("button",{onClick:A,className:"absolute top-4 left-1/2 transform -translate-x-1/2 glass-morphism px-6 py-2 pointer-events-auto hover:bg-white/20 transition-colors",children:"Exit Simulation"})]})}export{ne as default};
